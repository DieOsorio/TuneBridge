import{a as f,w as _,A as g}from"./index-p55ST7R3.js";const w=async({myProfileId:o,otherProfile:a,findConversation:d,createConversation:l,addParticipant:c,navigate:r,setLoading:i=()=>{}})=>{try{i(!0);const n=await d({myProfileId:o,otherProfileId:a.id,all:!0});let s=null,e=null;if(Array.isArray(n)?(s=n.find(u=>!u.is_group)??null,e=n.find(u=>u.is_group)??null):n&&typeof n=="object"&&(n.is_group?e=n:s=n),s){r(`/chat/${s.id}`);return}if(e){r(`/chat/${e.id}`);return}const t=await l({created_by:o,avatar_url:a.avatar_url??void 0,title:a.username??""});await c({conversation_id:t.id,profile_id:o}),await c({conversation_id:t.id,profile_id:a.id}),r(`/chat/${t.id}`)}catch(n){console.error("Error starting conversation:",n)}finally{i(!1)}};function h(o){const{user:a}=f(),{privacyOthers:d}=_(),{data:l,isLoading:c}=d(o);if(!(a!=null&&a.id))return{canSend:!1,loading:!1,reason:"blocked"};const{connectionBetweenProfiles:r}=g(),{data:i,isLoading:n}=r(a==null?void 0:a.id,o),s=c||n;let e=!1,t="blocked";if(!s)switch(l==null?void 0:l.allow_messages){case"all":e=!0,t="ok";break;case"connections_only":e=(i==null?void 0:i.status)==="accepted",t=e?"ok":"not-connected";break;case"none":default:e=!1,t="blocked"}return{canSend:e,loading:s,reason:t}}export{w as h,h as u};
