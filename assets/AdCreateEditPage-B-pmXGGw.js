import{j as e}from"./mui-r_OKU3k3.js";import{u as C,a as I,c as P,H as T,S as z,I as f,T as B,L as O,B as A,A as R,G as H,h as W,i as q}from"./index-Lh6-Uiv0.js";import{r as S}from"./filepond-C4Y8_Bzv.js";import{i as G}from"./icons-C9PPhvnE.js";import"./reactPlayer-P4y7tfwb.js";import"./lottie-Qij33HW6.js";import"./gsap-Brfk6Bdo.js";const J=({defaultValues:s={},onSubmit:p,publisherId:d})=>{var N,_;const{t}=C("ads"),{user:b}=I(),{register:n,control:h,watch:c,handleSubmit:F,setValue:y,formState:{errors:i}}=P({defaultValues:{ad_type:s.ad_type||"",title:s.title||"",looking_for:s.looking_for||[],genres:s.genres||[],location:s.location||"",description:s.description||"",profile_id:d?null:b.id,group_id:d||null}}),r=T({control:h,name:"ad_type"}),[o,m]=S.useState(s.looking_for||[]),[g,j]=S.useState(s.genres||[]),v=(N=c("newLookingFor"))==null?void 0:N.trim(),k=(_=c("newGenre"))==null?void 0:_.trim(),L=(a,l,u,x)=>{a&&!l.includes(a)&&l.length<3&&(u([...l,a]),y(x,""))},w=(a,l,u)=>{u(l.filter(x=>x!==a))},E=a=>{const{newLookingFor:l,newGenre:u,...x}=a;p({...x,looking_for:o,genres:g})};return e.jsxs("form",{onSubmit:F(E),className:"space-y-4",children:[e.jsx(z,{id:"ad_type",name:"ad_type",label:t("adForm.labels.typeOfAd"),defaultOption:t("adForm.labels.default"),options:[{value:"looking",label:t("adForm.labels.looking")},{value:"offering",label:t("adForm.labels.offering")}],control:h,register:n,classForLabel:"text-gray-400",error:i.ad_type}),e.jsx(f,{id:"title",label:t("adForm.labels.title"),placeholder:t("adForm.placeholders.title"),type:"text",register:n,maxLength:30,validation:{maxLength:{value:30,message:t("adForm.validations.title")}},error:i.title,classForLabel:"!text-gray-400"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{id:"newLookingFor",label:t(r==="offering"?"adForm.labels.offering":"adForm.labels.looking"),placeholder:t(r==="offering"?"adForm.placeholders.offering":"adForm.placeholders.looking"),type:"text",maxLength:12,register:n,validation:{maxLength:{value:12,message:t("adForm.validations.looking")}},classForLabel:"!text-gray-400",className:"!flex-1",error:i.looking_for}),e.jsx("button",{type:"button",onClick:()=>L(v,o,m,"newLookingFor"),disabled:!v||o.length>=3,className:"text-emerald-500 mt-6 cursor-pointer hover:text-emerald-700 p-2 rounded-full focus:outline-none focus:ring-2 focus:ring-green-400 transition-colors disabled:opacity-40 disabled:cursor-not-allowed",children:e.jsx(G,{size:22})})]}),o.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:o.map((a,l)=>e.jsxs("span",{className:"px-2 py-1 text-sm rounded bg-emerald-800 text-white flex items-center gap-2",children:[a,e.jsx("button",{type:"button",onClick:()=>w(a,o,m),className:"text-red-400 hover:text-red-600 font-bold",children:"×"})]},l))})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{id:"newGenre",label:t("adForm.labels.genres"),placeholder:t("adForm.placeholders.genres"),type:"text",register:n,maxLength:12,validation:{maxLength:{value:12,message:t("adForm.validations.genre")}},classForLabel:"!text-gray-400",className:"!flex-1",error:i.genres}),e.jsx("button",{type:"button",onClick:()=>L(k,g,j,"newGenre"),disabled:!k||g.length>=3,className:"text-emerald-500 mt-6 cursor-pointer hover:text-emerald-700 p-2 rounded-full focus:outline-none focus:ring-2 focus:ring-green-400 transition-colors disabled:opacity-40 disabled:cursor-not-allowed",children:e.jsx(G,{size:22})})]}),g.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:g.map((a,l)=>e.jsxs("span",{className:"px-2 py-1 text-sm rounded bg-emerald-800 text-white flex items-center gap-2",children:[a,e.jsx("button",{type:"button",onClick:()=>w(a,g,j),className:"text-red-400 hover:text-red-600 font-bold",children:"×"})]},l))})]}),e.jsx(f,{id:"location",label:t("adForm.labels.location"),placeholder:t("adForm.placeholders.location"),type:"text",register:n,classForLabel:"!text-gray-400",error:i.location}),e.jsx(B,{id:"description",label:t("adForm.labels.description"),placeholder:t("adForm.placeholders.description"),register:n,validation:{maxLength:{value:200,message:t("adForm.validations.description")}},error:i.description,maxLength:200,watchValue:c("description"),classForLabel:"text-gray-400"}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx(O,{to:"/ads",children:e.jsx(A,{className:"!bg-gray-600 hover:!bg-gray-700",children:t("adForm.buttons.cancel")})}),e.jsx(A,{className:"!bg-emerald-600 hover:!bg-emerald-700",type:"submit",children:t("adForm.buttons.save")})]})]})},$=({publisherId:s})=>{const{t:p}=C("ads"),{id:d}=R(),t=!!d,{fetchAd:b,createAd:n,updateAd:h}=H(),{data:c,isLoading:F}=b(d,{enabled:t}),y=W(),i=async r=>{try{const o={...r,genres:typeof r.genres=="string"?r.genres.split(",").map(m=>m.trim()):r.genres,looking_for:typeof r.looking_for=="string"?r.looking_for.split(",").map(m=>m.trim()):r.looking_for};t?await h({ad:c,updates:o}):await n(o),y("/ads")}catch(o){console.error("Error saving ad:",o)}};return t&&F?e.jsx(q,{}):e.jsxs("div",{className:"max-w-3xl mx-auto p-6",children:[e.jsx("h1",{className:"text-2xl text-yellow-600 font-semibold text-center mb-4",children:p(t?"adCreateEditPage.title.edit":"adCreateEditPage.title.create")}),e.jsx(J,{defaultValues:c,onSubmit:i,publisherId:s})]})};export{$ as default};
