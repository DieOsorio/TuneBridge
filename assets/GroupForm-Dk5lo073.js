import{j as e}from"./mui-B-xP7mtj.js";import{r as o}from"./filepond-C4Y8_Bzv.js";import{u as K}from"./index.esm-B1e87uze.js";import{D as Q,z as W}from"./icons-r1d5ly4y.js";import{u as X,y as Y,a as Z,d as ee}from"./index-CRsfiaS_.js";import{I as x}from"./Input-DJlOEIMy.js";import{T as ae}from"./Textarea-CvGz1H1U.js";import{B as k}from"./Button-CbZ7oUI_.js";import{P as te}from"./ProfileAvatar-c1RuMNn7.js";import{I as se}from"./ImageUploader-Cu2Tp4EI.js";import{u as A}from"./avatarUtils-DV1apmFs.js";import"./reactPlayer-xbeEqQf7.js";import"./lottie-Qij33HW6.js";const ye=({group:a=null,onSave:u,onCancel:b})=>{var P,U,I,R;const n=!!a,{t}=X("profileGroup"),{createProfileGroup:B,updateProfileGroup:p}=Y(),{user:h}=Z(),y=ee(),{register:i,handleSubmit:E,reset:z,watch:v,setValue:M,formState:{errors:c,isSubmitting:j}}=K({defaultValues:{name:(a==null?void 0:a.name)||"",bio:(a==null?void 0:a.bio)||"",country:(a==null?void 0:a.country)||"",city:(a==null?void 0:a.city)||"",newGenre:""}}),[g,re]=o.useState((a==null?void 0:a.avatar_url)||""),[V,w]=o.useState(null),[m,N]=o.useState(null),[G,L]=o.useState(""),[r,F]=o.useState((a==null?void 0:a.genres)??[]),d=(P=v("newGenre"))==null?void 0:P.trim(),_=o.useRef(null),$=s=>{s.length?(N(s[0]),w(URL.createObjectURL(s[0]))):(N(null),w(null))},q=()=>{d&&!r.includes(d)&&r.length<5&&(F([...r,d]),M("newGenre",""))},D=s=>F(r.filter(l=>l!==s)),O=async s=>{L("");try{const{newGenre:l,...S}=s;let f=g;if(n)m&&(f=await A(m,"group-avatars",a.id,a.avatar_url,!0)),await p({id:a.id,updatedGroup:{...S,avatar_url:f,genres:r}}),u==null||u();else{const T=await B({...S,genres:r,avatar_url:"",created_by:h.id});m&&(f=await A(m,"group-avatars",T.id,"",!1),await p({id:T.id,updatedGroup:{avatar_url:f}})),y(`/profile/${h.id}`)}z()}catch(l){L(l.message||t("errors.default"))}},C=t(n?"form.titles.edit":"form.titles.create"),H=t(n?"form.buttons.save":"form.buttons.create"),J=()=>{n?b==null||b():y(`/profile/${h.id}`)};return e.jsxs("div",{className:"bg-gradient-to-l to-gray-900 p-6 rounded-b-lg shadow-lg max-w-4xl mx-auto",children:[e.jsx("h2",{className:"text-2xl font-semibold text-center mb-4",children:C}),G&&e.jsx("p",{className:"text-red-500 mb-4 text-center",children:G}),e.jsxs("div",{ref:_,className:"relative mx-auto w-fit cursor-pointer group",children:[e.jsx(te,{group:!0,className:"!bg-amber-700",avatar_url:V||g}),e.jsx("span",{className:"absolute bottom-1 right-1 bg-white rounded-full p-[2px] shadow-md",children:e.jsx(Q,{size:20,className:"text-gray-700"})})]}),e.jsx(se,{amount:1,triggerRef:_,onFilesUpdate:$,className:"my-4"}),e.jsxs("form",{onSubmit:E(O),className:"space-y-4 grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(x,{id:"name",label:t("form.labels.name"),placeholder:t("form.placeholders.name"),maxLength:20,register:i,validation:{required:t("form.validations.name")},error:(U=c.name)==null?void 0:U.message,classForLabel:"!text-gray-400"}),e.jsx(ae,{id:"bio",label:t("form.labels.bio"),placeholder:t("form.placeholders.bio"),maxLength:100,register:i,validation:{maxLength:{value:100,message:t("form.validations.bioMax")}},error:c.bio,watchValue:v("bio"),classForLabel:"text-gray-400"}),e.jsx(x,{id:"country",label:t("form.labels.country"),placeholder:t("form.placeholders.country"),register:i,error:(I=c.country)==null?void 0:I.message,classForLabel:"!text-gray-400"}),e.jsx(x,{id:"city",label:t("form.labels.city"),placeholder:t("form.placeholders.city"),register:i,error:(R=c.city)==null?void 0:R.message,classForLabel:"!text-gray-400"}),e.jsxs("div",{className:"sm:col-span-2 flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{id:"newGenre",label:t("form.labels.genres"),placeholder:t("form.placeholders.genres"),maxLength:12,register:i,className:"!flex-1",classForLabel:"!text-gray-400"}),e.jsx("button",{type:"button",onClick:q,disabled:!d||r.length>=5,className:"text-emerald-500 mt-6 p-2 rounded-full hover:text-emerald-700 disabled:opacity-40",children:e.jsx(W,{size:22})})]}),r.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:r.map((s,l)=>e.jsxs("span",{className:"px-2 py-1 text-sm rounded bg-emerald-800 text-white flex items-center gap-2",children:[s,e.jsx("button",{type:"button",onClick:()=>D(s),className:"text-red-300 hover:text-red-500",children:"Ã—"})]},l))})]}),e.jsxs("div",{className:"sm:col-span-2 flex justify-center gap-4 pt-4",children:[e.jsx(k,{type:"button",className:"!bg-gray-600 hover:!bg-gray-700",onClick:J,children:t("form.buttons.cancel")}),e.jsx(k,{type:"submit",disabled:j,children:j?t("form.buttons.saving"):H})]})]})]})};export{ye as default};
