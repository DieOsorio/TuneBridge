import{j as r,l as Q}from"./mui-DntPDMdt.js";import{r as l}from"./calendar-DXWKnWXk.js";import{u as X,a as Y,b as ee,c as te,d as ae,e as se,f as re,C as V,a5 as q,a6 as ne,P as oe,a7 as le,a0 as ie,U as de,I as C,n as S,S as x,B as M,a2 as ce}from"./index-CXxZbzPL.js";const w=a=>a.endsWith(" Department")?a.replace(/ Department$/,""):a,be=({profile:a,onSave:N,onCancel:P})=>{var E;const{t}=X("profile"),{user:o}=Y(),{updateProfile:W}=ee(),{register:b,handleSubmit:$,setValue:c,reset:D,watch:u,control:i,formState:{errors:n,isSubmitting:F}}=te({defaultValues:{bio:"",username:"",gender:"",country:"",state:"",birthdate:null,neighborhood:"",firstname:"",lastname:""}}),[v,L]=l.useState(""),[_,O]=l.useState(null),[Z,R]=l.useState(null),[A,I]=l.useState(""),[G,T]=l.useState(!1),[U,H]=l.useState(!1),k=l.useRef(null),{data:p=[]}=ae(),y=u("country"),{data:f=[]}=se(y),B=u("state"),{data:j=[]}=re(y,B);l.useEffect(()=>{var e,s,h;if(!U&&a&&p.length>0&&f.length>=0&&j.length>=0){const d=((e=V.getAllCountries().find(m=>m.name===a.country))==null?void 0:e.isoCode)||a.country||"",g=((s=q.getStatesOfCountry(d).find(m=>w(m.name)===a.state))==null?void 0:s.isoCode)||a.state||"",z=((h=ne.getCitiesOfState(d,g).find(m=>m.name===a.neighborhood))==null?void 0:h.name)||a.neighborhood||"";D({bio:a.bio||"",username:a.username||"",gender:a.gender||"",country:d,state:g,birthdate:a.birthdate?new Date(a.birthdate):"",neighborhood:z,firstname:a.firstname||"",lastname:a.lastname||""}),L(a.avatar_url===null||a.avatar_url===void 0?"":String(a.avatar_url)),H(!0)}},[a,p,f,j,D,U]);const J=e=>{if(e.length>0){const s=e[0];O(s),R(URL.createObjectURL(s))}else O(null),R(null)},K=async e=>{I("");try{let s=v??"";_&&(o!=null&&o.id)&&(s=await ce(_,"avatars",o.id,v??"",!0)??"",L(s));const h=V.getCountryByCode(e.country),d=q.getStateByCodeAndCountry(e.state,e.country),g={...e,country:(h==null?void 0:h.name)||e.country,state:w((d==null?void 0:d.name)||e.state),neighborhood:e.neighborhood,avatar_url:s,id:(o==null?void 0:o.id)||(a==null?void 0:a.id),birthdate:e.birthdate&&e.birthdate instanceof Date?e.birthdate.toISOString():e.birthdate||null,last_seen:(a==null?void 0:a.last_seen)??new Date().toISOString()};await W(g),N&&N(),T(!0),setTimeout(()=>{T(!1)},2500)}catch(s){console.error("Profile update error:",s),I(t("edit.errors.updateFailed"))}};return r.jsxs("div",{className:"bg-gradient-to-l to-gray-900 p-6 rounded-b-lg shadow-lg max-w-4xl mx-auto",children:[r.jsx("h2",{className:"text-2xl font-semibold text-yellow-600 text-center mb-4",children:t("edit.title")}),o&&r.jsxs("div",{ref:k,className:"relative w-fit mx-auto cursor-pointer group",children:[r.jsx(oe,{avatar_url:Z||v,gender:u("gender")}),r.jsx("div",{className:"absolute bottom-1 right-1 bg-white rounded-full p-1 shadow-md group-hover:opacity-100 opacity-80 transition-opacity",children:r.jsx(le,{className:"text-gray-700 w-6 h-6"})})]}),r.jsx("div",{className:"my-4",children:r.jsx(ie,{onFilesUpdate:J,amount:1,triggerRef:k,classForLabel:""})}),A&&r.jsx("p",{className:"text-red-500 text-sm text-center",children:A}),r.jsxs("form",{onSubmit:$(K),className:"space-y-4 grid grid-cols-1 sm:grid-cols-2 gap-4",children:[r.jsx(de,{id:"bio",label:t("edit.labels.bio"),placeholder:t("edit.placeholders.bio"),register:b,validation:{maxLength:{value:100,message:t("edit.validation.bioMaxLength")}},error:n.bio,maxLength:100,watchValue:u("bio")}),r.jsx(C,{id:"firstname",label:t("edit.labels.firstname"),placeholder:t("edit.placeholders.firstname"),register:b,error:n.firstname}),r.jsx(C,{id:"lastname",label:t("edit.labels.lastname"),placeholder:t("edit.placeholders.lastname"),register:b,error:n.lastname}),r.jsx(S,{name:"country",control:i,render:({field:e})=>r.jsx(x,{id:"country",control:i,defaultOption:t("edit.placeholders.country"),label:t("edit.labels.country"),options:p.map(s=>({value:s.isoCode,label:s.name})),onChange:s=>{e.onChange(s),c("state",""),c("neighborhood","")},error:n.country})}),r.jsx(S,{name:"state",control:i,render:({field:e})=>r.jsx(x,{id:"state",control:i,defaultOption:t("edit.placeholders.state"),label:t("edit.labels.state"),options:f.map(s=>({value:s.isoCode,label:w(s.name)||""})),onChange:s=>{e.onChange(s),c("neighborhood","")},disabled:!y,error:n.state})}),r.jsx(S,{name:"neighborhood",control:i,render:({field:e})=>r.jsx(x,{id:"neighborhood",control:i,defaultOption:t("edit.placeholders.neighborhood"),label:t("edit.labels.neighborhood"),options:j.map(s=>({value:s.name,label:s.name})),onChange:e.onChange,disabled:!B,error:n.neighborhood})}),r.jsx(C,{id:"username",label:t("edit.labels.username"),placeholder:t("edit.placeholders.username"),register:b,maxLength:12,watchValue:u("username"),validation:{required:t("edit.validation.usernameRequired"),maxLength:{value:12,message:t("edit.validation.usernameMaxLength")},pattern:{value:/^[a-zA-Z0-9_.-]+$/,message:t("edit.validation.usernamePattern")}},error:n.username}),r.jsx(x,{id:"gender",label:t("edit.labels.gender"),options:[{value:"male",label:t("edit.placeholders.genderOptions.male")},{value:"female",label:t("edit.placeholders.genderOptions.female")},{value:"other",label:t("edit.placeholders.genderOptions.other")}],control:i,search:!1,error:n.gender}),r.jsxs("div",{className:"sm:col-span-1",children:[r.jsx("label",{htmlFor:"birthdate",className:"block text-sm font-semibold mb-3 text-white",children:t("edit.labels.birthdate")}),r.jsx(Q,{value:(()=>{const e=u("birthdate");if(e instanceof Date)return e;if(typeof e=="string"&&e){const s=new Date(e);return isNaN(s.getTime())?null:s}return null})(),onChange:e=>{e&&typeof e.toDate=="function"?c("birthdate",e.toDate()):e instanceof Date?c("birthdate",e):c("birthdate",null)},slotProps:{textField:{variant:"outlined",size:"small",fullWidth:!0,error:!!n.birthdate,helperText:(E=n.birthdate)==null?void 0:E.message}}})]}),r.jsxs("div",{className:"sm:col-span-2 flex justify-center mt-10 gap-4",children:[r.jsx(M,{className:"!bg-emerald-600 hover:!bg-emerald-700 text-white",type:"submit",disabled:F,children:t(F?"edit.buttons.saving":G?"edit.labels.saved":"edit.buttons.save")}),P&&r.jsx(M,{className:"!bg-gray-600 hover:!bg-gray-700 text-white",type:"button",onClick:()=>{P()},children:t("edit.buttons.cancel")})]})]})]})};export{be as P};
