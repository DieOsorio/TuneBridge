import{j as e}from"./mui-B-xP7mtj.js";import{u as E,a as I,L as P,v as T,x as z,d as B,e as O}from"./index-cVJRNoKt.js";import{u as R,a as W}from"./index.esm-B1e87uze.js";import{B as S}from"./Button-CbZ7oUI_.js";import{S as q}from"./Select-DM_fTtaf.js";import{I as u}from"./Input-DJlOEIMy.js";import{T as H}from"./Textarea-XcKdjHuZ.js";import{r as A}from"./filepond-C4Y8_Bzv.js";import{z as C}from"./icons-r1d5ly4y.js";import"./reactPlayer-xbeEqQf7.js";import"./lottie-Qij33HW6.js";const J=({defaultValues:r={},onSubmit:p,publisherId:d})=>{var N,_;const{t}=E("ads"),{user:b}=I(),{register:n,control:f,watch:c,handleSubmit:F,setValue:y,formState:{errors:i}}=R({defaultValues:{ad_type:r.ad_type||"",title:r.title||"",looking_for:r.looking_for||[],genres:r.genres||[],location:r.location||"",description:r.description||"",profile_id:d?null:b.id,group_id:d||null}}),s=W({control:f,name:"ad_type"}),[a,m]=A.useState(r.looking_for||[]),[g,j]=A.useState(r.genres||[]),v=(N=c("newLookingFor"))==null?void 0:N.trim(),k=(_=c("newGenre"))==null?void 0:_.trim(),L=(o,l,h,x)=>{o&&!l.includes(o)&&l.length<3&&(h([...l,o]),y(x,""))},w=(o,l,h)=>{h(l.filter(x=>x!==o))},G=o=>{const{newLookingFor:l,newGenre:h,...x}=o;p({...x,looking_for:a,genres:g})};return e.jsxs("form",{onSubmit:F(G),className:"space-y-4",children:[e.jsx(q,{id:"ad_type",name:"ad_type",label:t("adForm.labels.typeOfAd"),defaultOption:t("adForm.labels.default"),options:[{value:"looking",label:t("adForm.labels.looking")},{value:"offering",label:t("adForm.labels.offering")}],control:f,register:n,classForLabel:"text-gray-400",error:i.ad_type}),e.jsx(u,{id:"title",label:t("adForm.labels.title"),placeholder:t("adForm.placeholders.title"),type:"text",register:n,maxLength:30,validation:{maxLength:{value:30,message:t("adForm.validations.title")}},error:i.title,classForLabel:"!text-gray-400"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{id:"newLookingFor",label:t(s==="offering"?"adForm.labels.offering":"adForm.labels.looking"),placeholder:t(s==="offering"?"adForm.placeholders.offering":"adForm.placeholders.looking"),type:"text",maxLength:12,register:n,validation:{maxLength:{value:12,message:t("adForm.validations.looking")}},classForLabel:"!text-gray-400",className:"!flex-1",error:i.looking_for}),e.jsx("button",{type:"button",onClick:()=>L(v,a,m,"newLookingFor"),disabled:!v||a.length>=3,className:"text-emerald-500 mt-6 cursor-pointer hover:text-emerald-700 p-2 rounded-full focus:outline-none focus:ring-2 focus:ring-green-400 transition-colors disabled:opacity-40 disabled:cursor-not-allowed",children:e.jsx(C,{size:22})})]}),a.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:a.map((o,l)=>e.jsxs("span",{className:"px-2 py-1 text-sm rounded bg-emerald-800 text-white flex items-center gap-2",children:[o,e.jsx("button",{type:"button",onClick:()=>w(o,a,m),className:"text-red-400 hover:text-red-600 font-bold",children:"×"})]},l))})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{id:"newGenre",label:t("adForm.labels.genres"),placeholder:t("adForm.placeholders.genres"),type:"text",register:n,maxLength:12,validation:{maxLength:{value:12,message:t("adForm.validations.genre")}},classForLabel:"!text-gray-400",className:"!flex-1",error:i.genres}),e.jsx("button",{type:"button",onClick:()=>L(k,g,j,"newGenre"),disabled:!k||g.length>=3,className:"text-emerald-500 mt-6 cursor-pointer hover:text-emerald-700 p-2 rounded-full focus:outline-none focus:ring-2 focus:ring-green-400 transition-colors disabled:opacity-40 disabled:cursor-not-allowed",children:e.jsx(C,{size:22})})]}),g.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:g.map((o,l)=>e.jsxs("span",{className:"px-2 py-1 text-sm rounded bg-emerald-800 text-white flex items-center gap-2",children:[o,e.jsx("button",{type:"button",onClick:()=>w(o,g,j),className:"text-red-400 hover:text-red-600 font-bold",children:"×"})]},l))})]}),e.jsx(u,{id:"location",label:t("adForm.labels.location"),placeholder:t("adForm.placeholders.location"),type:"text",register:n,classForLabel:"!text-gray-400",error:i.location}),e.jsx(H,{id:"description",label:t("adForm.labels.description"),placeholder:t("adForm.placeholders.description"),register:n,validation:{maxLength:{value:200,message:t("adForm.validations.description")}},error:i.description,maxLength:200,watchValue:c("description"),classForLabel:"text-gray-400"}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx(P,{to:"/ads",children:e.jsx(S,{className:"!bg-gray-600 hover:!bg-gray-700",children:t("adForm.buttons.cancel")})}),e.jsx(S,{className:"!bg-emerald-600 hover:!bg-emerald-700",type:"submit",children:t("adForm.buttons.save")})]})]})},te=({publisherId:r})=>{const{t:p}=E("ads"),{id:d}=T(),t=!!d,{fetchAd:b,createAd:n,updateAd:f}=z(),{data:c,isLoading:F}=b(d,{enabled:t}),y=B(),i=async s=>{try{const a={...s,genres:typeof s.genres=="string"?s.genres.split(",").map(m=>m.trim()):s.genres,looking_for:typeof s.looking_for=="string"?s.looking_for.split(",").map(m=>m.trim()):s.looking_for};t?await f({ad:c,updates:a}):await n(a),y("/ads")}catch(a){console.error("Error saving ad:",a)}};return t&&F?e.jsx(O,{}):e.jsxs("div",{className:"max-w-3xl mx-auto p-6",children:[e.jsx("h1",{className:"text-2xl text-yellow-600 font-semibold text-center mb-4",children:p(t?"adCreateEditPage.title.edit":"adCreateEditPage.title.create")}),e.jsx(J,{defaultValues:c,onSubmit:i,publisherId:r})]})};export{te as default};
