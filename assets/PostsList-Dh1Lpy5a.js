import{j as e,B as fe}from"./mui-DntPDMdt.js";import{u as R,ai as Ee,a as Z,j as te,c as se,U as Me,B as le,D as Re,G as $e,L as O,aj as pe,P as ae,b as je,ak as Fe,k as Ae,h as Be,g as Oe,ag as Ie,al as He,E as re,aa as Te,af as be}from"./index-DUDycYqK.js";import{r,U as Ue}from"./calendar-DXWKnWXk.js";import{M as X,G as Ve,L as Ze}from"./icons-Cf_ygVw3.js";import{u as De,h as Ge}from"./useCanSendDM-CAJH9hSQ.js";import{S as w}from"./index-BXOMkYts.js";/* empty css                 */import{m as ne}from"./proxy-Dy5uTOz-.js";import{M as we}from"./Modal-Bz-ouz36.js";import{F as We}from"./EllipsisVerticalIcon-C3aSX2lf.js";import{S as ce,N as qe,P as de,a as me,Z as xe,b as ue}from"./swiper-Bk_-ZTox.js";import{P as Y}from"./PlusButton-DVVuMSOv.js";function Qe({title:t,titleId:s,...a},n){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":s},a),t?r.createElement("title",{id:s},t):null,r.createElement("path",{d:"m11.645 20.91-.007-.003-.022-.012a15.247 15.247 0 0 1-.383-.218 25.18 25.18 0 0 1-4.244-3.17C4.688 15.36 2.25 12.174 2.25 8.25 2.25 5.322 4.714 3 7.688 3A5.5 5.5 0 0 1 12 5.052 5.5 5.5 0 0 1 16.313 3c2.973 0 5.437 2.322 5.437 5.25 0 3.925-2.438 7.111-4.739 9.256a25.175 25.175 0 0 1-4.244 3.17 15.247 15.247 0 0 1-.383.219l-.022.012-.007.004-.003.001a.752.752 0 0 1-.704 0l-.003-.001Z"}))}const he=r.forwardRef(Qe);function Je({title:t,titleId:s,...a},n){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":s},a),t?r.createElement("title",{id:s},t):null,r.createElement("path",{d:"M21.731 2.269a2.625 2.625 0 0 0-3.712 0l-1.157 1.157 3.712 3.712 1.157-1.157a2.625 2.625 0 0 0 0-3.712ZM19.513 8.199l-3.712-3.712-8.4 8.4a5.25 5.25 0 0 0-1.32 2.214l-.8 2.685a.75.75 0 0 0 .933.933l2.685-.8a5.25 5.25 0 0 0 2.214-1.32l8.4-8.4Z"}),r.createElement("path",{d:"M5.25 5.25a3 3 0 0 0-3 3v10.5a3 3 0 0 0 3 3h10.5a3 3 0 0 0 3-3V13.5a.75.75 0 0 0-1.5 0v5.25a1.5 1.5 0 0 1-1.5 1.5H5.25a1.5 1.5 0 0 1-1.5-1.5V8.25a1.5 1.5 0 0 1 1.5-1.5h5.25a.75.75 0 0 0 0-1.5H5.25Z"}))}const ve=r.forwardRef(Je);function Ke({title:t,titleId:s,...a},n){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":s},a),t?r.createElement("title",{id:s},t):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m9 12.75 3 3m0 0 3-3m-3 3v-7.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}const Xe=r.forwardRef(Ke);function Ye({title:t,titleId:s,...a},n){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":s},a),t?r.createElement("title",{id:s},t):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m15 11.25-3-3m0 0-3 3m3-3v7.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}const et=r.forwardRef(Ye);function tt({title:t,titleId:s,...a},n){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":s},a),t?r.createElement("title",{id:s},t):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 12.76c0 1.6 1.123 2.994 2.707 3.227 1.087.16 2.185.283 3.293.369V21l4.076-4.076a1.526 1.526 0 0 1 1.037-.443 48.282 48.282 0 0 0 5.68-.494c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0 0 12 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018Z"}))}const st=r.forwardRef(tt),at=()=>{const t="#a1a1aa",s="#e4e4e7";return e.jsxs(ne.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.2},className:"absolute z-50 p-4 rounded-lg shadow-md bg-neutral-100 dark:bg-neutral-900 w-64 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(w,{circle:!0,width:40,height:40,baseColor:t,highlightColor:s}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx(w,{width:80,height:10,baseColor:t,highlightColor:s}),e.jsx(w,{width:100,height:8,baseColor:t,highlightColor:s})]})]}),e.jsxs("div",{className:"space-y-1 mb-3",children:[e.jsx(w,{height:8,width:"100%",baseColor:t,highlightColor:s}),e.jsx(w,{height:8,width:"90%",baseColor:t,highlightColor:s}),e.jsx(w,{height:8,width:"80%",baseColor:t,highlightColor:s}),e.jsx(w,{height:8,width:"70%",baseColor:t,highlightColor:s})]}),e.jsxs("div",{className:"flex justify-end items-center gap-5 pt-2",children:[e.jsx(w,{width:30,height:30,baseColor:t,highlightColor:s}),e.jsx(w,{width:30,height:30,baseColor:t,highlightColor:s}),e.jsx(w,{width:30,height:30,baseColor:t,highlightColor:s})]})]})},Ne=({targetType:t,targetId:s,targetOwnerId:a,title:n,description:o,onClose:i})=>{const{t:c}=R("admin",{keyPrefix:"reports"}),{insertUserReport:h}=Ee(),{user:u}=Z(),g=te(),[k,d]=r.useState(null),[f,m]=r.useState(null),{register:j,handleSubmit:z,reset:x,watch:v,formState:{errors:y,isSubmitting:C}}=se();r.useEffect(()=>{(!t||!s||!a)&&d("Missing target information to report.")},[t,s,a]);const _=async E=>{if(d(null),m(null),!(u!=null&&u.id)){d(c("error"));return}if(!t||!s||!a){d("Missing target information to report.");return}try{await h({reporter_id:u.id,target_type:t,target_id:s,target_owner_id:a,reason:E.reason,status:"pending"}),m(c("success")),x(),i?i():setTimeout(()=>g(-1),1500)}catch($){d(c("error")),console.error($)}},p=()=>{i?i():g(-1)};return e.jsxs("form",{onSubmit:z(_),className:"space-y-6 bg-zinc-900 p-6 rounded-lg shadow full-width mx-auto",children:[e.jsx("h2",{className:"text-lg font-semibold text-white text-center mb-1",children:n||c("title")}),e.jsx("p",{className:"text-sm text-gray-400 text-center mb-4",children:o||c("description")}),k&&e.jsx("p",{className:"text-red-500 text-center",children:k}),f&&e.jsx("p",{className:"text-green-500 text-center",children:f}),e.jsx(Me,{id:"reason",placeholder:c("form.reason.placeholder"),maxLength:500,register:j,watchValue:v("reason"),validation:{required:c("form.reason.error")},error:y.reason}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(le,{type:"button",onClick:p,className:"!bg-gray-600 hover:!bg-gray-700",disabled:C,children:c("buttons.cancel")}),e.jsx(le,{type:"submit",disabled:C,children:C?`${c("buttons.submit")}...`:c("buttons.submit")})]})]})};function ge(t){return t.username!==void 0}const rt=({profile:t,isLoading:s,isGroup:a})=>{const{t:n}=R("profile",{keyPrefix:"reportUser"}),{user:o}=Z(),i=!!o,{findConversation:c,createConversation:h}=Re(),{addParticipant:u}=$e(),{canSend:g,loading:k}=De(t.id),[d,f]=r.useState(!1),[m,j]=r.useState(!1),z=s||k,x=te(),v=i&&(o==null?void 0:o.id)===t.id,y=async({conversation_id:B,profile_id:l})=>u({conversation_id:B,profile_id:l,role:"member"}),C=()=>{if(!d){if(!i||!o){x("/login");return}!a&&"username"in t&&Ge({myProfileId:o.id,otherProfile:t,findConversation:c,createConversation:h,addParticipant:y,navigate:x,setLoading:()=>f(!0)})}};if(z)return e.jsx(at,{});if(!t)return null;const{state:_,country:p,bio:E,avatar_url:$,id:L}=t,A=ge(t)?t.username:null,P=ge(t)?null:t.name;return e.jsxs(e.Fragment,{children:[e.jsxs(ne.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.2},className:"absolute z-50 p-4 rounded-lg shadow-md bg-neutral-100 dark:bg-neutral-900 w-64 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(O,{to:a?`/group/${L}`:`/profile/${L}`,children:e.jsx("img",{src:$??void 0,alt:`Avatar of ${A||P}`,className:"w-10 h-10 rounded-full object-cover"})}),e.jsxs("div",{className:"ml-6",children:[e.jsxs("p",{className:"font-semibold text-center text-neutral-900 dark:text-neutral-100 mb-2",children:["@",A||P]}),(_||p)&&e.jsxs("p",{className:"text-neutral-400 text-xs",children:[_,_&&p?", ":"",p]})]})]}),E&&e.jsx("p",{className:"text-neutral-600 dark:text-neutral-300 line-clamp-4",children:E.length>50?`${E.slice(0,100)}...`:E}),e.jsxs("div",{className:"flex justify-end items-center gap-5 pt-2",children:[i&&!v&&e.jsx("div",{className:"mt-1.5 mr-auto",children:e.jsx(X,{onClick:()=>{j(!0)},title:n("title"),className:"text-red-700/70 hover:text-red-600 cursor-pointer mx-auto",size:21})}),v&&e.jsx(O,{title:"Edit Profile",to:"/settings/profile",className:"text-neutral-400 cursor-pointer hover:text-neutral-900 dark:hover:text-neutral-100 transition",children:e.jsx(ve,{className:"w-7 h-7"})}),e.jsx(O,{title:"View Posts",to:a?`/group/${L}/posts`:`/profile/${L}/posts`,className:"text-neutral-400 cursor-pointer hover:text-neutral-900 dark:hover:text-neutral-100 transition",children:e.jsx(Ve,{size:28})}),g&&!a&&e.jsx("button",{title:"Send Message",className:"text-neutral-400 cursor-pointer hover:text-neutral-900 dark:hover:text-neutral-100 transition",onClick:C,children:e.jsx(st,{className:"w-7 h-7"})})]})]}),m&&e.jsx(we,{onClose:()=>j(!1),children:e.jsx(Ne,{targetType:"user",targetId:t.id,targetOwnerId:t.id,title:n("title"),description:n("description"),onClose:()=>j(!1)})})]})};function nt({onChange:t,onSubmit:s,onCancel:a,value:n}){const{t:o}=R("comments"),i=c=>{t(c.target.value)};return e.jsxs("div",{className:"flex-1 mt-2 w-full place-items-end",children:[e.jsx("textarea",{value:n,onChange:i,className:"bg-gray-100 dark:bg-zinc-700 p-3 rounded-lg shadow-sm w-150",rows:2,placeholder:o("card.placeholder")}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{onClick:s,className:"px-3 py-1 bg-sky-700 hover:bg-sky-800 text-white rounded text-sm",children:o("card.buttons.reply")}),e.jsx("button",{onClick:a,className:"px-3 py-1 bg-gray-600 hover:bg-gray-700 text-white rounded text-sm",children:o("card.buttons.cancel")})]})]})}function ot({value:t,onChange:s,onSave:a,onCancel:n}){const{t:o}=R("common"),i=c=>{s(c.target.value)};return e.jsxs("div",{className:"flex-1 mt-2 place-items-end",children:[e.jsx("textarea",{value:t,onChange:i,className:"w-100 p-2 rounded-md border border-zinc-300 dark:border-zinc-600 bg-white dark:bg-zinc-900 text-zinc-800 dark:text-zinc-100 resize-none",rows:2}),e.jsxs("div",{className:"flex gap-2 mt-2 justify-center",children:[e.jsx("button",{onClick:a,className:"px-3 py-1 w-18 bg-emerald-600 hover:bg-emerald-700 text-white rounded text-sm",children:o("generic.save")}),e.jsx("button",{onClick:n,className:"px-3 py-1 w-18 bg-gray-600 hover:bg-gray-700 text-white rounded text-sm",children:o("generic.cancel")})]})]})}const it=r.memo(ot);function lt({onMenu:t,onEdit:s,onDelete:a,isMenuOpen:n,menuRef:o}){const{t:i}=R("common");return e.jsxs("div",{className:"relative",ref:o,children:[e.jsx("button",{onClick:t,className:"cursor-pointer text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-300 text-xl px-2",children:e.jsx(We,{className:"w-6 h-6"})}),n&&e.jsxs("div",{className:"absolute right-4 top-7 w-32 bg-white dark:bg-zinc-900 border border-zinc-800 dark:border-zinc-700 rounded shadow-lg z-10",children:[e.jsx("button",{onClick:s,className:"block cursor-pointer w-full text-center px-4 py-2 text-sm hover:bg-zinc-100 dark:hover:bg-zinc-800",children:i("generic.edit")}),e.jsx("div",{className:"border-t border-zinc-300 dark:border-zinc-700"}),e.jsx("button",{onClick:a,className:"block cursor-pointer w-full text-center px-4 py-2 text-sm hover:bg-red-100 dark:hover:bg-red-950 text-red-600 dark:text-red-400",children:i("generic.delete")})]})]})}const ct=r.memo(lt),ke=({comment:t,profile:s,onDelete:a,onSaveEdit:n,replies:o=[],profilesMap:i,onReplySubmit:c,currentUserId:h})=>{const{t:u}=R("comments"),[g,k]=r.useState(!1),[d,f]=r.useState(!1),[m,j]=r.useState(""),[z,x]=r.useState(null),[v,y]=r.useState(!1),[C,_]=r.useState(t.content),{commentLikesQuery:p,insertLike:E,deleteLike:$}=pe(),{data:L=[],isLoading:A}=p(t.id),P=z===t.id,B=h===t.profile_id,l=r.useRef(null);r.useEffect(()=>{function b(J){P&&l.current&&!l.current.contains(J.target)&&x(null)}return document.addEventListener("mousedown",b),()=>{document.removeEventListener("mousedown",b)}},[P]);const S=()=>(L==null?void 0:L.filter(b=>b.comment_id===t.id))||[],F=()=>S().some(b=>b.profile_id===h),I=()=>S().find(b=>b.profile_id===h),D=async()=>{if(!h)return;const b=I();b?await $(b):await E({comment_id:t.id,profile_id:h})},T=r.useCallback(()=>{m.trim()!==""&&(c({content:m,parent_id:t.id}),j(""),f(!1))},[m,t.id,c]),G=r.useCallback(()=>{j(""),f(!1)},[]),W=r.useCallback(()=>{n(t.id,t.post_id,C),y(!1)},[t.id,t.post_id,C,n]),q=r.useCallback(()=>{y(!1),_(t.content)},[t.content]),H=r.useCallback(()=>{x(P?null:t.id)},[t.id,P]),Q=g?o.slice(-10):[];return e.jsxs("div",{className:"flex mb-4",children:[e.jsx(O,{to:`/profile/${s==null?void 0:s.id}`,children:e.jsx(ae,{avatar_url:s==null?void 0:s.avatar_url,className:"!w-8 !h-8 mr-3 flex-shrink-0",alt:`${s==null?void 0:s.username}'s avatar`,gender:s==null?void 0:s.gender})}),e.jsxs("div",{className:"flex flex-col w-full",children:[e.jsxs("div",{className:"bg-zinc-900 p-3 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"font-semibold text-zinc-700 dark:text-zinc-300",children:(s==null?void 0:s.username)||u("card.anonymous")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-xs text-zinc-500",children:new Date(t.updated_at||t.created_at).toLocaleString()}),B&&e.jsx(ct,{menuRef:l,onDelete:()=>a(t),onEdit:()=>y(!0),onMenu:H,isMenuOpen:P})]})]}),e.jsx("div",{className:"text-zinc-600 dark:text-zinc-300 mt-1",children:t.content}),e.jsxs("div",{className:"flex gap-4 mt-2 text-xs text-sky-700 dark:text-sky-500",children:[e.jsxs("button",{className:"flex items-center gap-1 hover:underline disabled:opacity-50",onClick:D,disabled:A,children:[e.jsx("span",{children:F()?u("card.liked"):u("card.like")}),e.jsx("span",{children:S().length})]}),e.jsx("button",{className:"hover:underline",onClick:()=>f(!d),children:u("card.reply")})]})]}),v&&e.jsx(it,{value:C,onChange:_,onSave:W,onCancel:q}),d&&e.jsx(nt,{value:m,onChange:j,onSubmit:T,onCancel:G}),o.length>0&&e.jsxs("div",{className:"mt-4 border-zinc-300 dark:border-zinc-700",children:[e.jsx("button",{onClick:()=>k(!g),className:"flex items-center gap-1 text-sm font-bold text-sky-600 mb-1.5 hover:underline",children:e.jsxs(e.Fragment,{children:[g?e.jsx(et,{className:"w-5 h-5 text-sky-500"}):e.jsx(Xe,{className:"w-5 h-5 text-sky-500"}),o.length===1?u("card.replies",{count:o.length}):u("card.repliesPlural",{count:o.length})]})}),g&&Q.map(b=>e.jsx(ke,{comment:b,profile:i[b.profile_id],onDelete:a,onSaveEdit:n,replies:b.replies||[],profilesMap:i,onReplySubmit:c,currentUserId:h},b.id))]})]})]})},dt=r.memo(ke);function mt({postId:t}){var B;const{t:s}=R("comments"),{user:a}=Z(),{fetchProfile:n,profilesMap:o}=je(),{data:i,isLoading:c}=n((a==null?void 0:a.id)??null),{fetchComments:h,insertComment:u,updateComment:g,deleteComment:k}=Fe(),{data:d,isLoading:f}=h(t),[m,j]=r.useState(!1),z=xt(d??[]),{data:x,isLoading:v}=o(z),{register:y,handleSubmit:C,reset:_,formState:{errors:p}}=se();if(v||f||c)return e.jsx(Ae,{});const $=async l=>{if(!(a!=null&&a.id))return;const S={post_id:t,profile_id:a.id,content:l.comment};try{await u(S),_()}catch(F){console.error("Couldn't insert comment",F)}},L=async l=>{try{await k(l)}catch(S){console.error("Error trying to delete comment",S)}},A=async(l,S,F)=>{try{await g({id:l,post_id:S,updatedComment:{content:F,updated_at:new Date().toISOString()}})}catch(I){console.error("Error updating comment",I)}},P=async l=>{if(!(a!=null&&a.id))return;const S={post_id:t,profile_id:a.id,content:l.content,parent_id:l.parent_id??null};try{await u(S)}catch(F){console.error("Could not insert reply",F)}};return e.jsxs("div",{className:"w-full mt-4 border-t pt-4 text-sm text-zinc-800 dark:text-zinc-100",children:[e.jsxs("div",{className:"mb-4",children:[(d==null?void 0:d.length)&&d.length>2&&!m&&e.jsx("button",{onClick:()=>j(!0),className:"mb-4 text-sky-700 dark:text-sky-400 text-sm hover:underline",children:s("box.loadMore")}),(B=m?d:d==null?void 0:d.slice(-2))==null?void 0:B.map(l=>e.jsx(dt,{comment:l,profile:x==null?void 0:x[l.profile_id],onDelete:L,onSaveEdit:A,replies:l.replies,profilesMap:x??{},onReplySubmit:P,currentUserId:(a==null?void 0:a.id)??null},l.id)),(d==null?void 0:d.length)===0&&e.jsx("p",{className:"italic text-zinc-600",children:s("box.noComments")})]}),e.jsxs("form",{onSubmit:C($),className:"flex items-start gap-3 mt-4",children:[e.jsx(O,{to:`/profile/${i==null?void 0:i.id}`,children:e.jsx(ae,{avatar_url:i==null?void 0:i.avatar_url,className:"!w-10 !h-10",gender:i==null?void 0:i.gender,alt:`${i==null?void 0:i.username}'s avatar`})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("textarea",{...y("comment",{required:!0}),placeholder:s("box.placeholder"),className:"w-full p-2 rounded-md border border-zinc-300 dark:border-zinc-600 bg-white dark:bg-zinc-950 text-zinc-800 dark:text-zinc-100 resize-none",rows:2}),e.jsx("button",{type:"submit",className:"mt-2 px-4 py-1 bg-sky-700 hover:bg-sky-800 text-white rounded-md text-sm",children:s("box.send")}),p.comment&&e.jsx("span",{className:"text-red-500 text-xs",children:s("box.error")})]})]})]})}function xt(t=[]){const s=new Set;function a(n){for(const o of n)o.profile_id&&s.add(o.profile_id),Array.isArray(o.replies)&&o.replies.length>0&&a(o.replies)}return a(t),Array.from(s)}const ut=({children:t})=>e.jsxs("div",{className:`pointer-events-none absolute left-1/2 top-full mt-2 -translate-x-1/2
               whitespace-nowrap rounded-md bg-gray-900/90 py-1 px-2 text-xs
               font-semibold text-sky-200 shadow-lg backdrop-blur`,children:[t,e.jsx("div",{className:"absolute -top-1 left-1/2 -translate-x-1/2 h-2 w-2 rotate-45 bg-gray-900/90"})]});function V({post:t}){const{t:s}=R("posts"),{user:a}=Z(),n=!!a,o=te(),[i,c]=r.useState(!1),[h,u]=r.useState(!1),[g,k]=r.useState(!1),[d,f]=r.useState(!1),[m,j]=r.useState(null),[z,x]=r.useState(!1),{fetchProfile:v}=je(),{data:y,error:C,isLoading:_}=v(t.profile_id),p=!!t.group_id,{fetchProfileGroup:E}=Be(),{data:$,isLoading:L}=E(t.group_id??""),{userGroupRole:A}=Oe(),{data:P,isLoading:B}=A({profileId:(a==null?void 0:a.id)??"",groupId:t.group_id??""}),l=p?$:y,{insertLike:S,deleteLike:F,userLikedPostQuery:I,postLikesQuery:D}=pe(),{data:T}=n?I(t.id,a.id):{data:void 0},{data:G=[]}=D(t.id),W=G.length,{getHashtagsByPostId:q}=Ie(),{data:H}=q(t.id),Q=s("likes.count",{count:W}),b=L||B||_,J=He(),ye=()=>{J(t.profile_id),u(!0)},oe=n?{profile_id:a==null?void 0:a.id,post_id:t.id}:null,U=!!T,Ce=()=>{if(!n){o("/login");return}U?F({...T,post_id:t.id,profile_id:(a==null?void 0:a.id)||""}):oe&&S(oe)},Pe=()=>{o(`/edit-post/${t.id}`)},K=N=>{j(N),f(!0)},ie=()=>{f(!1),j(null)},Se=()=>{if(!n){o("/login");return}k(N=>!N)};if(C)return e.jsx(re,{error:C.message});const _e=t.profile_id===(a==null?void 0:a.id),Le=n&&(!p&&_e||p&&(P==="admin"||P==="manager"));return e.jsxs("div",{className:"bg-gradient-to-l to-gray-800 p-4 rounded-lg shadow-md mb-4 mx-auto max-w-3xl w-full",children:[e.jsx("h3",{className:`text-xl mb-4 font-semibold rounded-lg bg-gradient-to-l ${p?"to-amber-700":"to-sky-600"} p-4 text-gray-100`,children:t.title}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"flex sm:flex-col flex-row items-center",children:[l&&e.jsxs("div",{onMouseEnter:ye,onMouseLeave:()=>u(!1),className:"relative mb-auto",children:[e.jsxs(O,{to:p?`/group/${l.id??""}`:`/profile/${l.id??""}`,children:[e.jsx("h2",{className:"font-bold text-lg text-gray-200",children:"username"in l?l.username:l.name}),e.jsx(ae,{avatar_url:l.avatar_url,className:"!w-15 !h-15 mx-auto",gender:"gender"in l?l.gender:void 0,alt:`${"username"in l?l.username:l.name}'s avatar`})]}),h&&e.jsx(rt,{profile:l,isLoading:b,isGroup:p})]}),e.jsxs("div",{className:"flex sm:h-full sm:justify-end sm:flex-col items-end ml-auto sm:ml-0 gap-3 sm:gap-8 mt-6",children:[e.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 flex items-center justify-center",children:Le&&e.jsx(ve,{title:s("titles.updatePost"),className:"text-yellow-600 w-8 h-8 hover:text-yellow-700 cursor-pointer",onClick:Pe})}),e.jsx("div",{onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),onClick:Ce,className:"relative cursor-pointer transition-transform duration-200 hover:scale-110",children:e.jsxs(ne.div,{initial:{scale:1},animate:{scale:U?[1,1.4,1]:1},transition:{duration:.4},children:[U||i?e.jsx(he,{className:"w-8 h-8 sm:w-10 sm:h-10 text-rose-600 transition-all"}):e.jsx(he,{className:"w-8 h-8 sm:w-10 sm:h-10 text-rose-300"}),i&&e.jsx(ut,{children:Q})]},U?"liked":"not-liked")}),e.jsx(Ze,{title:s("titles.comments"),onClick:Se,className:`text-gray-400 cursor-pointer w-8 h-8 transition-all ${p?"hover:text-amber-700":"hover:text-sky-600"} ${g&&!p?"text-sky-600":"text-amber-700"} sm:!w-10 sm:!h-10`})]})]}),e.jsxs("div",{className:"w-full max-w-[600px] flex-1 mx-auto bg-gradient-to-l from-gray-900 rounded-md hidden sm:flex",children:[n&&e.jsx("div",{className:"mt-1.5",children:e.jsx(X,{onClick:()=>{x(!0)},title:s("titles.report"),className:"text-red-700/70 hover:text-red-600 cursor-pointer mx-auto",size:21})}),t.images_urls&&t.images_urls.length>0?e.jsx(ce,{modules:[qe,de,me,xe],slidesPerView:1,navigation:!0,pagination:{clickable:!0},scrollbar:{draggable:!0},style:{width:"100%",height:"100%"},children:t.images_urls.map((N,M)=>e.jsx(ue,{children:e.jsx("img",{src:N,alt:`Post image ${M}`,className:"w-full max-h-[500px] object-contain rounded cursor-pointer",style:{maxWidth:"100%",height:"auto",display:"block",margin:"0 auto"},onClick:()=>K(N)})},M))}):e.jsx("p",{className:"font-semibold m-auto text-center text-gray-400",children:s("messages.noImages")})]}),e.jsxs("div",{className:"w-full mx-auto p-0 bg-gradient-to-l from-gray-900 rounded-md block sm:hidden",children:[n&&e.jsx("div",{className:"mt-1.5",children:e.jsx(X,{onClick:()=>{x(!0)},title:s("titles.report"),className:"text-red-700/70 hover:text-red-600 cursor-pointer mr-auto",size:21})}),t.images_urls&&t.images_urls.length>0?t.images_urls.length===1?e.jsx("img",{src:t.images_urls[0],alt:"Post image",className:"w-full h-[60vw] min-h-[180px] max-h-[70vh] object-contain rounded cursor-pointer",onClick:()=>t.images_urls&&K(t.images_urls[0])}):e.jsx(ce,{modules:[de,me,xe],slidesPerView:1,pagination:{clickable:!0},scrollbar:{draggable:!0},style:{minHeight:"60vw",maxHeight:"70vh"},children:t.images_urls.map((N,M)=>e.jsx(ue,{children:e.jsx("img",{src:N,alt:`Post image ${M}`,className:"w-full h-full min-h-[180px] max-h-[70vh] object-contain rounded cursor-pointer",onClick:()=>K(N)})},M))}):e.jsx("p",{className:"font-semibold text-center text-white",children:s("messages.noImages")})]})]}),d&&e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50",onClick:ie,children:e.jsxs("div",{className:"relative max-w-full max-h-full p-4",onClick:N=>N.stopPropagation(),children:[e.jsx("button",{className:"absolute top-1 right-1 text-white hover:text-red-100 cursor-pointer z-10",onClick:ie,children:e.jsx(Te,{className:"w-7 h-7"})}),e.jsx("img",{src:m??void 0,alt:"Full-size post image",className:"max-w-[90vw] max-h-[80vh] object-contain rounded-md shadow-lg"})]})}),H&&H.length>0&&H.filter(N=>N.hashtags!==void 0).map(N=>{const M=N.hashtags.name,ze=M.startsWith("#")?M.slice(1):M;return e.jsx(O,{to:`/hashtag/${ze}`,className:"text-sm mx-1 text-sky-500 hover:underline",children:M},N.hashtag_id)}),e.jsx("p",{className:`text-gray-300 mx-auto rounded-md bg-gray-900 font-semibold border-1 sm:ml-auto sm:w-140 p-4 my-4 ${p?"border-amber-700":"border-sky-700"}`,children:t.content}),g&&e.jsx(mt,{postId:t.id}),z&&e.jsx(we,{onClose:()=>x(!1),children:e.jsx(Ne,{targetType:"post",targetId:t.id,targetOwnerId:t.profile_id,title:s("reportPost.title"),description:s("reportPost.description"),onClose:()=>x(!1)})})]})}function ee(){const t="#a1a1aa",s="#e4e4e7";return e.jsxs("div",{className:"bg-gradient-to-l to-gray-800 p-4 rounded-lg shadow-md mb-4 mx-auto max-w-3xl w-full",children:[e.jsx(w,{height:60,baseColor:t,highlightColor:s,className:"mb-4 rounded-lg"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"flex sm:flex-col flex-row items-center sm:items-start gap-4 sm:gap-6 w-full sm:w-auto",children:[e.jsxs("div",{className:"flex flex-col items-center gap-2 sm:mb-auto",children:[e.jsx(w,{width:80,height:14,baseColor:t,highlightColor:s}),e.jsx(w,{circle:!0,width:60,height:60,baseColor:t,highlightColor:s})]}),e.jsx("div",{className:"flex sm:flex-col items-center justify-center gap-4 sm:gap-6 ml-auto sm:ml-5 sm:mt-6",children:[...Array(3)].map((a,n)=>e.jsx(w,{circle:!0,width:40,height:40,baseColor:t,highlightColor:s},n))})]}),e.jsx("div",{className:"w-full max-w-[600px] mx-auto p-4 bg-gradient-to-l from-gray-900 rounded-md",children:e.jsx(w,{height:300,className:"w-full rounded-md",baseColor:t,highlightColor:s})})]}),e.jsx("div",{className:"flex justify-center gap-3 mt-4 flex-wrap",children:[...Array(3)].map((a,n)=>e.jsx(w,{width:80,height:20,baseColor:t,highlightColor:s,className:"rounded"},n))}),e.jsx("div",{className:"max-w-[600px] mx-auto",children:e.jsx(w,{height:80,className:"rounded-md mt-6",baseColor:t,highlightColor:s})})]})}const ht=()=>{const{t}=R(["posts","common"]),{searchPosts:s,infinitePosts:a}=be(),{register:n,handleSubmit:o,watch:i}=se({defaultValues:{searchTerm:""}}),c=i("searchTerm"),{data:h,fetchNextPage:u,hasNextPage:g,isFetchingNextPage:k,isLoading:d,error:f}=a(),{data:m,isLoading:j}=s(c||""),z=()=>{};return d?e.jsx("div",{className:"flex flex-col gap-4 items-center",children:[...Array(7)].map((x,v)=>e.jsx(ee,{},v))}):f?e.jsx(re,{error:f.message}):e.jsxs("div",{className:"flex flex-col mx-auto text-center",children:[e.jsxs("form",{onSubmit:o(z),className:"mb-5 relative flex items-center justify-center",children:[e.jsx("input",{type:"text",...n("searchTerm"),placeholder:t("posts:placeholders.searchPosts"),className:"border rounded-lg p-2 focus:outline-none focus:ring w-full max-w-md"}),e.jsx("div",{className:"absolute right-0 top-9 -translate-y-1/2 hidden lg:flex items-center group",children:e.jsx(Y,{label:t("posts:buttons.createPost"),to:"/create-post",iconSize:28,showLabelOnMobile:!1})})]}),e.jsx("div",{className:"flex justify-center items-center lg:hidden mb-4 mr-6",children:e.jsx(Y,{label:t("posts:buttons.createPost"),to:"/create-post",iconSize:32,showLabelOnMobile:!0})}),j?e.jsx("div",{className:"flex flex-col gap-4 items-center",children:[...Array(2)].map((x,v)=>e.jsx(ee,{},v))}):c&&m&&m.length>0?m.map(x=>e.jsx(V,{post:x},x.id)):c?e.jsx("p",{className:"col-span-full text-center text-gray-500",children:t("posts:messages.noMatch")}):Array.isArray(h==null?void 0:h.pages)&&h.pages.length>0?h.pages.map((x,v)=>e.jsx(Ue.Fragment,{children:x.map(y=>e.jsx(V,{post:y},y.id))},v)):e.jsx("p",{className:"col-span-full text-center text-gray-500",children:t("posts:messages.empty")}),g&&e.jsx(fe,{className:"!w-1/2 md:!w-1/3 !font-bold mt-4 !mx-auto hover:!text-sky-600",onClick:()=>u(),disabled:k,children:t(k?"common:loading":"common:loadMore")})]})},_t=({profileId:t,posts:s,disableSearch:a=!1,isOwnProfile:n=!1})=>{const{t:o}=R(["posts","common"]),{infiniteUserPosts:i}=be(),{data:c,fetchNextPage:h,hasNextPage:u,isFetchingNextPage:g,isLoading:k,error:d}=i(t??"",10);if(!t&&!a)return e.jsx(ht,{});if(k)return e.jsx("div",{className:"flex flex-col gap-4 items-center",children:[...Array(3)].map((m,j)=>e.jsx(ee,{},j))});if(d)return e.jsx(re,{error:d.message});const f=c?c.pages.flat():[];return s?e.jsx("div",{className:"mx-auto text-center w-full",children:e.jsx("div",{className:"grid grid-cols-1 gap-4",children:s.length>0?s.map(m=>e.jsx(V,{post:m},m.id)):e.jsx("p",{className:"col-span-full text-center text-gray-400",children:o("posts:messages.empty")})})}):e.jsxs("div",{className:"mx-auto text-center w-full",children:[n&&e.jsx("div",{className:"w-full flex justify-end mb-4 relative",children:e.jsx("div",{className:"group flex items-center",children:e.jsx(Y,{label:o("posts:buttons.createPost"),to:"/create-post",iconSize:28,showLabelOnMobile:!0})})}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:f.length>0?f.map(m=>e.jsx(V,{post:m},m.id)):e.jsx("p",{className:"col-span-full text-center text-gray-500",children:o("posts:messages.empty")})}),u&&e.jsx(fe,{className:"!w-1/2 md:!w-1/3 !font-bold mt-4 !mx-auto hover:!text-sky-600",onClick:()=>h(),disabled:g,children:o(g?"common:loading":"common:loadMore")})]})};export{_t as P,Ne as R};
