import{j as e,P as A}from"./mui-B-xP7mtj.js";import{r}from"./filepond-C4Y8_Bzv.js";import{u as B,a as h,q as R,r as $,t as q,d as E,L as D,b as H,e as z}from"./index-cVJRNoKt.js";import{b as F,r as g,s as f,t as O,u as U,v as G,w as J}from"./icons-r1d5ly4y.js";import{L as K}from"./LoadingBadge-DZq2ie0-.js";import{u as Q,h as V}from"./useCanSendDM-L16iIdpx.js";import{P as W}from"./ProfileAvatar-c1RuMNn7.js";import"./reactPlayer-xbeEqQf7.js";import"./lottie-Qij33HW6.js";function b({profile:t,loading:x}){const{t:a}=B("profile"),{user:n}=h(),{addConnection:c,deleteConnection:l,updateConnection:d,userConnections:j}=R(),{findConversation:v,createConversation:_}=$(),{addParticipant:C}=q(),[o,Y]=r.useState(null),[w,y]=r.useState(!1),{canSend:N,loading:P}=Q(t.profile_id),S=E(),{data:p}=j(t.profile_id),i=p==null?void 0:p.find(m=>m.follower_profile_id===n.id&&m.following_profile_id===t.profile_id||m.follower_profile_id===t.profile_id&&m.following_profile_id===n.id),s=(i==null?void 0:i.status)??"connect",k=async()=>{s==="connect"?await c({follower_profile_id:n.id,following_profile_id:t.profile_id,status:"pending"}):s==="pending"||s==="accepted"?await l(i):s==="blocked"&&await d({connection:i,updatedConnection:{status:"accepted"}})},I=()=>{w||V({myProfileId:n.id,otherProfile:{id:t.profile_id,username:t.username,avatar_url:t.avatar_url},findConversation:v,createConversation:_,addParticipant:C,navigate:S,setLoading:y})},u=Math.round(t.match_score*100);if(!t||x||P)return e.jsx(K,{color:"amber",label:"Buscando mÃºsicos compatibles..."});const L=u>=70?"bg-amber-800 text-white":u>=40?"bg-sky-700 text-white":u>=10?"bg-gray-300 text-gray-900":"bg-gray-800 text-gray-100",M=()=>s==="pending"?a("connection.cancelRequest"):s==="accepted"?a("connection.disconnect"):s==="blocked"?a("connection.unblock"):null,T={connect:e.jsx(G,{}),pending:e.jsx(U,{}),accepted:e.jsx(f,{}),blocked:e.jsx(O,{})}[s];return e.jsxs("div",{className:`
      max-w-100 w-full mx-auto border border-gray-400 rounded-xl p-4 
      shadow-sm bg-gray-950 
      hover:shadow-md 
      transition-all duration-150 ease-in-out 
      will-change-transform
    `,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(D,{to:`/profile/${t.profile_id}`,children:e.jsx(W,{avatar_url:t.avatar_url,alt:t.username,className:"!w-13 !h-13"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-100",children:t.name||t.display_name||t.username}),e.jsxs("div",{className:"text-sm text-gray-400",children:["@",t.username]})]})]}),e.jsxs("div",{className:`absolute inline-flex items-center gap-2 cursor-help select-none px-3 py-1 rounded-full text-sm font-semibold ${L}`,title:a("matchScore.cardTitle"),children:[e.jsx(F,{className:"text-amber-500 text-lg"}),e.jsxs("span",{children:["Match: ",u,"%"]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2 text-sm",children:[N&&e.jsx("button",{onClick:I,className:"absolute top-4 right-4 text-amber-700 cursor-pointer hover:text-amber-800 transition",children:e.jsx(J,{size:30})}),e.jsx("button",{onClick:k,title:M()||"",className:"flex cursor-pointer items-center min-w-35 justify-center gap-1 px-3 py-1 rounded bg-gray-700 text-white hover:bg-gray-800 transition text-sm",children:e.jsxs("span",{className:"truncate flex items-center gap-1",children:[o&&s==="accepted"&&e.jsx(g,{}),o&&s==="pending"&&e.jsx(g,{}),o&&s==="blocked"&&e.jsx(f,{}),!o&&T,e.jsx("span",{children:o||a(`connection.${s}`)})]})})]})]})}b.propTypes={profile:A.object.isRequired};const X=r.memo(b);function ce(){const{user:t}=h(),{matchAll:x}=H(),[a,n]=r.useState([]),[c,l]=r.useState(!0);return r.useEffect(()=>{l(!0),x({profileId:t.id,limit:9}).then(n).catch(console.error).finally(()=>l(!1))},[t==null?void 0:t.id]),!a.length||c?e.jsx(z,{}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:a.map(d=>e.jsx(X,{profile:d,loading:c},d.profile_id))})}export{ce as default};
