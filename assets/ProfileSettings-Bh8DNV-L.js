import{j as a,o as Z}from"./mui-COfzhOQm.js";import{r as i}from"./filepond-C4Y8_Bzv.js";import{u as G,a as H,b as J,c as K,C as k,X as B,Y as Q,d as ee,e as te,f as ae,P as se,V as re,T as oe,I as v,S as h,B as D,W as le}from"./index--knYYYFr.js";import{I as ne}from"./icons-Cu9gFVBg.js";const y=s=>s.endsWith(" Department")?s.replace(/ Department$/,""):s,me=({profile:s,onSave:f,onCancel:j})=>{var T;const{t}=G("profile"),{user:b}=H(),{updateProfile:E}=J(),{register:c,handleSubmit:U,setValue:l,reset:C,watch:d,control:g,formState:{errors:r,isSubmitting:S}}=K({defaultValues:{bio:"",username:"",gender:"",country:"",state:"",birthdate:null,neighborhood:"",firstname:"",lastname:""}}),[x,w]=i.useState(""),[N,P]=i.useState(null),[V,L]=i.useState(null),[F,O]=i.useState(""),[z,A]=i.useState(!1),R=i.useRef(null);i.useEffect(()=>{var e,o,u;if(s){const n=((e=k.getAllCountries().find(m=>m.name===s.country))==null?void 0:e.isoCode)||s.country||"",_=((o=B.getStatesOfCountry(n).find(m=>y(m.name)===s.state))==null?void 0:o.isoCode)||s.state||"",Y=((u=Q.getCitiesOfState(n,_).find(m=>m.name===s.neighborhood))==null?void 0:u.name)||s.neighborhood||"";C({bio:s.bio||"",username:s.username||"",gender:s.gender||"",country:n,state:_,birthdate:s.birthdate?new Date(s.birthdate):"",neighborhood:Y,firstname:s.firstname||"",lastname:s.lastname||""}),w(s.avatar_url||"")}},[s,C]);const{data:W=[]}=ee(),p=d("country"),{data:q=[]}=te(p),I=d("state"),{data:M=[]}=ae(p,I),$=e=>{e.length>0?(P(e[0]),L(URL.createObjectURL(e[0]))):(P(null),L(null))},X=async e=>{O("");try{let o=x;N&&(o=await le(N,"avatars",b.id,x,!0),w(o));const u=k.getCountryByCode(e.country),n=B.getStateByCodeAndCountry(e.state,e.country);await E({...e,country:(u==null?void 0:u.name)||e.country,state:y((n==null?void 0:n.name)||e.state),neighborhood:e.neighborhood,avatar_url:o,id:b.id}),f&&f(),A(!0),setTimeout(()=>{A(!1)},2500)}catch(o){O(o.message||t("edit.errors.updateFailed"))}};return a.jsxs("div",{className:"bg-gradient-to-l to-gray-900 p-6 rounded-b-lg shadow-lg max-w-4xl mx-auto",children:[a.jsx("h2",{className:"text-2xl font-semibold text-yellow-600 text-center mb-4",children:t("edit.title")}),b&&a.jsxs("div",{ref:R,className:"relative w-fit mx-auto cursor-pointer group",children:[a.jsx(se,{avatar_url:V||x,gender:d("gender")}),a.jsx("div",{className:"absolute bottom-1 right-1 bg-white rounded-full p-1 shadow-md group-hover:opacity-100 opacity-80 transition-opacity",children:a.jsx(ne,{size:20,className:"text-gray-700"})})]}),a.jsx("div",{className:"my-4",children:a.jsx(re,{onFilesUpdate:$,amount:1,triggerRef:R})}),F&&a.jsx("p",{className:"text-red-500 text-sm text-center",children:F}),a.jsxs("form",{onSubmit:U(X),className:"space-y-4 grid grid-cols-1 sm:grid-cols-2 gap-4",children:[a.jsx(oe,{id:"bio",label:t("edit.labels.bio"),placeholder:t("edit.placeholders.bio"),register:c,validation:{maxLength:{value:100,message:t("edit.validation.bioMaxLength")}},error:r.bio,maxLength:100,watchValue:d("bio")}),a.jsx(v,{id:"firstname",label:t("edit.labels.firstname"),placeholder:t("edit.placeholders.firstname"),register:c,error:r.firstname}),a.jsx(v,{id:"lastname",label:t("edit.labels.lastname"),placeholder:t("edit.placeholders.lastname"),register:c,error:r.lastname}),a.jsx(h,{id:"country",label:t("edit.labels.country"),defaultOption:t("edit.placeholders.country"),options:W.map(e=>({value:e.isoCode,label:e.name})),control:g,error:r.country,onChange:e=>{l("country",e.target.value),l("state",""),l("neighborhood","")}}),a.jsx(h,{id:"state",label:t("edit.labels.state"),defaultOption:t("edit.placeholders.state"),options:q.map(e=>({value:e.isoCode,label:y(e.name)})),control:g,error:r.state,disabled:!p,onChange:e=>{l("state",e.target.value),l("neighborhood","")}}),a.jsx(h,{id:"neighborhood",label:t("edit.labels.neighborhood"),defaultOption:t("edit.placeholders.neighborhood"),options:M.map(e=>({value:e.name,label:e.name})),control:g,error:r.neighborhood,disabled:!I}),a.jsx(v,{id:"username",label:t("edit.labels.username"),placeholder:t("edit.placeholders.username"),register:c,maxLength:12,validation:{required:t("edit.validation.usernameRequired"),maxLength:{value:12,message:t("edit.validation.usernameMaxLength")},pattern:{value:/^[a-zA-Z0-9_.-]+$/,message:t("edit.validation.usernamePattern")}},error:r.username}),a.jsx(h,{id:"gender",label:t("edit.labels.gender"),defaultOption:t("edit.placeholders.genderDefault"),options:[{value:"male",label:t("edit.placeholders.genderOptions.male")},{value:"female",label:t("edit.placeholders.genderOptions.female")},{value:"other",label:t("edit.placeholders.genderOptions.other")}],value:d("gender"),onChange:e=>l("gender",e.target.value),register:c,error:r.gender}),a.jsxs("div",{className:"sm:col-span-1",children:[a.jsx("label",{htmlFor:"birthdate",className:"block text-sm font-medium mb-2 text-gray-200",children:t("edit.labels.birthdate")}),a.jsx(Z,{value:d("birthdate"),onChange:e=>l("birthdate",e),slotProps:{textField:{variant:"outlined",size:"small",fullWidth:!0,error:!!r.birthdate,helperText:(T=r.birthdate)==null?void 0:T.message}}})]}),a.jsxs("div",{className:"sm:col-span-2 flex justify-center mt-10 gap-4",children:[a.jsx(D,{className:"!bg-emerald-600 hover:!bg-emerald-700 text-white",type:"submit",disabled:S,children:t(S?"edit.buttons.saving":z?"edit.labels.saved":"edit.buttons.save")}),j&&a.jsx(D,{className:"!bg-gray-600 hover:!bg-gray-700 text-white",type:"button",onClick:()=>{j()},children:t("edit.buttons.cancel")})]})]})]})};export{me as P};
