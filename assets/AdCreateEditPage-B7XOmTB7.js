import{j as e}from"./mui-DntPDMdt.js";import{u as q,a as E,c as I,T as P,S as R,I as f,U as T,L as B,B as A,M as z,Q as O,j as M,k as Q}from"./index-DUDycYqK.js";import{r as S}from"./calendar-DXWKnWXk.js";import{u as G}from"./icons-Cf_ygVw3.js";import"./reactPlayer-CBmCIXQE.js";import"./lottie-FCmafNqs.js";import"./gsap-CH_iu5NA.js";import"./filepond-DvarZm2e.js";const U=({defaultValues:t={},onSubmit:x,publisherId:c})=>{var N,_;const{t:a}=q("ads"),{user:p}=E(),{register:d,control:m,watch:l,handleSubmit:b,setValue:F,formState:{errors:o}}=I({defaultValues:{ad_type:t.ad_type,title:t.title??"",looking_for:t.looking_for??[],genres:t.genres??[],location:t.location??"",description:t.description??"",profile_id:c?null:(p==null?void 0:p.id)??null,group_id:c??null}}),i=P({control:m,name:"ad_type"}),[s,v]=S.useState(Array.isArray(t.looking_for)?t.looking_for:[]),[g,y]=S.useState(Array.isArray(t.genres)?t.genres:[]),j=((N=l("newLookingFor"))==null?void 0:N.trim())??"",k=((_=l("newGenre"))==null?void 0:_.trim())??"",w=(r,n,u,h)=>{r&&!n.includes(r)&&n.length<3&&(u([...n,r]),F(h,""))},L=(r,n,u)=>{u(n.filter(h=>h!==r))},C=r=>{const{newLookingFor:n,newGenre:u,...h}=r;x({...h,looking_for:s,genres:g})};return e.jsxs("form",{onSubmit:b(C),className:"space-y-4",children:[e.jsx(R,{id:"ad_type",label:a("adForm.labels.typeOfAd"),options:[{value:"looking",label:a("adForm.labels.looking")},{value:"offering",label:a("adForm.labels.offering")}],control:m,classForLabel:"text-gray-400",error:o.ad_type,search:!1,validation:{required:a("adForm.validations.typeOfAd")}}),e.jsx(f,{id:"title",label:a("adForm.labels.title"),placeholder:a("adForm.placeholders.title"),type:"text",register:d,maxLength:30,watchValue:l("title"),validation:{required:a("adForm.validations.titleRequired"),maxLength:{value:30,message:a("adForm.validations.title")}},error:o.title,classForLabel:"!text-gray-400"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{id:"newLookingFor",label:a(i==="offering"?"adForm.labels.offering":"adForm.labels.looking"),placeholder:a(i==="offering"?"adForm.placeholders.offering":"adForm.placeholders.looking"),type:"text",maxLength:12,register:d,watchValue:l("newLookingFor"),validation:{maxLength:{value:12,message:a(i==="offering"?"adForm.validations.offering":"adForm.validations.looking")}},classForLabel:"!text-gray-400",className:"!flex-1",error:o.looking_for}),e.jsx("button",{type:"button",onClick:()=>w(j,s,v,"newLookingFor"),disabled:!j||s.length>=3,className:"text-emerald-500 mt-6 cursor-pointer hover:text-emerald-700 p-2 rounded-full focus:outline-none focus:ring-2 focus:ring-green-400 transition-colors disabled:opacity-40 disabled:cursor-not-allowed",children:e.jsx(G,{size:22})})]}),s.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:s.map((r,n)=>e.jsxs("span",{className:"px-2 py-1 text-sm rounded bg-emerald-800 text-white flex items-center gap-2",children:[r,e.jsx("button",{type:"button",onClick:()=>L(r,s,v),className:"text-red-400 hover:text-red-600 font-bold",children:"×"})]},n))})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{id:"newGenre",label:a("adForm.labels.genres"),placeholder:a("adForm.placeholders.genres"),type:"text",register:d,maxLength:12,watchValue:l("newGenre"),validation:{maxLength:{value:12,message:a("adForm.validations.genre")}},classForLabel:"!text-gray-400",className:"!flex-1",error:o.genres}),e.jsx("button",{type:"button",onClick:()=>w(k,g,y,"newGenre"),disabled:!k||g.length>=3,className:"text-emerald-500 mt-6 cursor-pointer hover:text-emerald-700 p-2 rounded-full focus:outline-none focus:ring-2 focus:ring-green-400 transition-colors disabled:opacity-40 disabled:cursor-not-allowed",children:e.jsx(G,{size:22})})]}),g.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:g.map((r,n)=>e.jsxs("span",{className:"px-2 py-1 text-sm rounded bg-emerald-800 text-white flex items-center gap-2",children:[r,e.jsx("button",{type:"button",onClick:()=>L(r,g,y),className:"text-red-400 hover:text-red-600 font-bold",children:"×"})]},n))})]}),e.jsx(f,{id:"location",label:a("adForm.labels.location"),placeholder:a("adForm.placeholders.location"),type:"text",register:d,validation:{required:a("adForm.validations.locationRequired")},classForLabel:"!text-gray-400",error:o.location}),e.jsx(T,{id:"description",label:a("adForm.labels.description"),placeholder:a("adForm.placeholders.description"),register:d,validation:{required:a("adForm.validations.descriptionRequired"),maxLength:{value:200,message:a("adForm.validations.description")}},error:o.description,maxLength:200,watchValue:l("description"),classForLabel:"text-gray-400"}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx(B,{to:"/ads",children:e.jsx(A,{className:"!bg-gray-600 hover:!bg-gray-700",children:a("adForm.buttons.cancel")})}),e.jsx(A,{className:"!bg-emerald-600 hover:!bg-emerald-700",type:"submit",children:a("adForm.buttons.save")})]})]})};function V(){const{t}=q("ads"),{id:x}=z(),c=!!x,{fetchAd:a,createAd:p,updateAd:d}=O(),{data:m,isLoading:l}=x?a(x):{data:void 0,isLoading:!1},b=M(),F=async o=>{try{const i={...o,genres:typeof o.genres=="string"?o.genres.split(",").map(s=>s.trim()):o.genres,looking_for:typeof o.looking_for=="string"?o.looking_for.split(",").map(s=>s.trim()):o.looking_for};c&&m?await d({ad:m,updates:i}):await p(i),b("/ads")}catch(i){console.error("Error saving ad:",i)}};return c&&l?e.jsx(Q,{}):e.jsxs("div",{className:"max-w-3xl mx-auto p-6",children:[e.jsx("h1",{className:"text-2xl text-yellow-600 font-semibold text-center mb-4",children:t(c?"adCreateEditPage.title.edit":"adCreateEditPage.title.create")}),e.jsx(U,{defaultValues:m??void 0,onSubmit:F})]})}export{V as default};
