import{j as e}from"./mui-B-xP7mtj.js";import{u as P,a as V,L as J,b as K,e as T,v as Q,y as W,z as X}from"./index-cVJRNoKt.js";import{E as Y}from"./ErrorMessage-B2u091H8.js";import{P as q}from"./ProfileAvatar-c1RuMNn7.js";import{B as w}from"./Button-CbZ7oUI_.js";import{r as f}from"./filepond-C4Y8_Bzv.js";import{u as A}from"./index.esm-B1e87uze.js";import{z as I}from"./icons-r1d5ly4y.js";import{I as O}from"./Input-DJlOEIMy.js";import{S as $}from"./Select-DM_fTtaf.js";import{C as Z}from"./ConfirmDialog-DxIiB_6a.js";import ee from"./GroupForm-DL_wMnm6.js";import"./reactPlayer-xbeEqQf7.js";import"./lottie-Qij33HW6.js";import"./Textarea-XcKdjHuZ.js";import"./ImageUploader-BOt4KSZ7.js";import"./avatarUtils-B9yui4Zj.js";const se=({groupData:t,isAdmin:i})=>e.jsxs("div",{className:"bg-gradient-to-l from-amber-950 to-amber-800 mb-4 p-4 rounded-b-lg",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(q,{avatar_url:t.avatar_url}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:t.name}),e.jsx("p",{className:"text-gray-300",children:t.bio})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-end mt-4",children:[e.jsxs("div",{children:[i&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"mb-4",children:e.jsx(w,{className:"!bg-sky-700 hover:!bg-sky-800",children:"Calendar"})})}),e.jsx("div",{className:"sm:mb-4",children:e.jsx(w,{className:"!bg-sky-700 hover:!bg-sky-800",children:"View Posts"})})]}),e.jsxs("div",{children:[i&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"mb-4",children:e.jsx(w,{className:"!bg-sky-700 hover:!bg-sky-800",children:"Edit Group"})})}),e.jsx("div",{className:"sm:mb-4",children:e.jsx(w,{className:"!bg-sky-700 hover:!bg-sky-800",children:"Members"})})]})]})]});function re({manageMember:t,register:i,errors:u,currentUserId:N,handleSubmit:M,onSubmit:h,handleCloseManage:o,handleRemoveClick:c,watch:s,setValue:j,customRoles:r,setCustomRoles:n}){var p;const{t:l}=P("profileGroup"),m=(p=s("newBandRole"))==null?void 0:p.trim();return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60",children:e.jsxs("div",{className:"bg-gray-900 gap-8 rounded-lg shadow-lg p-6 w-full max-w-md",children:[e.jsxs("form",{className:"flex flex-col gap-4",onSubmit:M(h),children:[e.jsx("div",{children:e.jsx($,{id:"editMemberRole",label:l("manageMembers.labels.role"),options:[{value:"member",label:l("manageMembers.labels.member")},{value:"admin",label:l("manageMembers.labels.admin")},{value:"musician",label:l("manageMembers.labels.musician")},{value:"manager",label:l("manageMembers.labels.manager")}],register:i,validation:{required:l("manageMembers.validations.role")},error:u.editMemberRole,classForLabel:"text-gray-200"})}),e.jsxs("div",{className:"flex flex-col gap-2 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{id:"newBandRole",label:l("groupMembers.labels.bandRole"),maxLength:12,placeholder:l("groupMembers.placeholders.bandRole"),register:i,error:u.newBandRole,className:"!flex-1"}),e.jsx("button",{type:"button",onClick:()=>{m&&!r.includes(m)&&r.length<3&&(n([...r,m]),j("newBandRole",""))},disabled:!m||r.length>=3,className:"text-emerald-500 hover:text-emerald-700 p-2 rounded-full focus:outline-none focus:ring-2 focus:ring-green-400 transition-colors disabled:opacity-40 disabled:cursor-not-allowed",children:e.jsx(I,{size:22})})]}),u.newBandRole&&e.jsx("span",{className:"text-red-500 text-sm",children:u.newBandRole.message}),r.length>0&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:r.map((d,g)=>e.jsxs("span",{className:"px-2 py-1 text-sm rounded bg-emerald-800 text-white flex items-center gap-2",children:[d,e.jsx("button",{type:"button",onClick:()=>n(r.filter(b=>b!==d)),className:"text-red-400 hover:text-red-600 font-bold",children:"×"})]},g))})]}),e.jsxs("div",{className:"flex gap-2 mb-4 mt-6",children:[e.jsx(w,{className:"!bg-emerald-600 hover:!bg-emerald-700",type:"submit",children:l("manageMembers.buttons.save")}),e.jsx(w,{className:"!bg-gray-600 hover:!bg-gray-700",onClick:o,type:"button",children:l("manageMembers.buttons.cancel")})]})]}),e.jsx("div",{className:"border-t border-gray-700 pt-4 mt-4",children:e.jsx("button",{className:"w-full px-3 py-2 bg-red-700 hover:bg-red-800 rounded text-white text-xs",onClick:()=>{c(t.profile_id),o()},children:t.profile_id===N?l("manageMembers.buttons.leaveGroup"):l("manageMembers.buttons.removeMember")})})]})})}const ae=({members:t,isAdmin:i,onRemoveMember:u,onUpdateMember:N,refetch:M})=>{const{user:h}=V(),{t:o}=P("profileGroup"),c=h==null?void 0:h.id,[s,j]=f.useState(!1),[r,n]=f.useState(null),[l,m]=f.useState([]),{register:p,handleSubmit:d,setValue:g,reset:b,watch:_,formState:{errors:D}}=A(),[C,y]=f.useState(!1),[v,R]=f.useState(null);if(!t||t.length===0)return e.jsx("p",{className:"text-gray-400",children:o("groupMembersList.messages.members")+": "+o("groupMembersList.messages.noMembers")});const U=a=>{R(a),y(!0),g("editMemberRole",a.role),m(a.roles_in_group||[])},S=async a=>{await N(v,{role:a.editMemberRole,roles_in_group:l}),y(!1),R(null),M(),b()},k=()=>{y(!1),R(null),b()},G=a=>{n(a),j(!0)},z=()=>{r&&u(r),j(!1),n(null)},L=()=>{j(!1),n(null)};return e.jsxs(e.Fragment,{children:[e.jsx("ul",{className:"space-y-4",children:t.map(a=>{var B;return e.jsxs("li",{className:"flex items-center gap-4",children:[e.jsx(J,{to:`/profile/${a.profile_id}`,children:e.jsx(q,{avatar_url:((B=a==null?void 0:a.profiles)==null?void 0:B.avatar_url)||"",className:"!w-16 !h-16"})}),e.jsxs("div",{className:"text-sm text-gray-400 flex flex-col gap-1",children:[e.jsx("p",{children:o(`groupMembersList.role.${a.role.toLowerCase()}`,a.role)}),a.roles_in_group&&a.roles_in_group.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1",children:a.roles_in_group.map((F,x)=>e.jsx("span",{className:"bg-emerald-800 text-white text-xs px-2 py-0.5 rounded-full",children:F},x))})]}),i&&e.jsx("button",{className:"ml-auto px-3 py-1 cursor-pointer bg-yellow-700 hover:bg-yellow-800 rounded text-white text-xs",onClick:()=>U(a),children:o("groupMembersList.buttons.manage")}),a.profile_id===c&&!i&&e.jsx("button",{className:"ml-auto px-3 py-1 cursor-pointer bg-red-700 hover:bg-red-800 rounded text-white text-xs",onClick:()=>G(a.profile_id),children:o("groupMembersList.buttons.leave")})]},a.id)})}),i&&C&&v&&e.jsx(re,{manageMember:v,register:p,errors:D,currentUserId:c,handleSubmit:d,onSubmit:S,handleCloseManage:k,handleRemoveClick:G,watch:_,setValue:g,customRoles:l,setCustomRoles:m}),e.jsx(Z,{isOpen:s,title:o(r===c?"groupMembersList.confirmDialog.titles.leaveGroup":"groupMembersList.confirmDialog.titles.removeMember"),message:o(r===c?"groupMembersList.confirmDialog.messages.confirmLeave":"groupMembersList.confirmDialog.messages.confirmRemove"),onConfirm:z,onCancel:L,confirmLabel:o(r===c?"groupMembersList.confirmDialog.labels.leaveGroup":"groupMembersList.confirmDialog.labels.removeMember"),cancelLabel:o("groupMembersList.confirmDialog.labels.cancel"),color:"error"})]})},le=({groupId:t,groupMembers:i,isAdmin:u,user:N,addGroupMember:M,removeGroupMember:h,updateGroupMember:o,refetch:c})=>{var F;const{t:s}=P("profileGroup"),[j,r]=f.useState(!1),[n,l]=f.useState(""),[m,p]=f.useState(""),[d,g]=f.useState([]),{register:b,handleSubmit:_,setValue:D,watch:C,reset:y,formState:{errors:v,isSubmitting:R}}=A(),{fetchProfile:U}=K(),{data:S,isLoading:k,error:G}=U(n),z=async x=>{p(""),l(x.newMemberUsername)},L=(F=C("newBandRole"))==null?void 0:F.trim();f.useEffect(()=>{if(n&&!k){if(G){p(s("groupMembers.errors.notFound"));return}S?(async()=>(await M({profile_group_id:t,profile_id:S.id,role:C("newMemberRole"),roles_in_group:d}),r(!1),y(),l("")))():p(s("groupMembers.errors.notFound"))}},[S,k,G,n,M,t,y,s,C,r]);const a=async(x,E)=>{await o({member:x,updates:E})},B=async x=>{await h({profileGroupId:t,profileId:x})};return k?e.jsx(T,{}):e.jsxs("div",{className:"bg-gradient-to-r from-gray-900 shadow-md rounded-lg p-6 flex flex-col gap-8 w-full min-w-0 sm:min-w-[320px] sm:w-auto",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-100",children:s("groupMembers.title")}),u&&e.jsx("div",{className:"mb-4",children:j?e.jsxs("form",{id:"add-member-form",onSubmit:_(z),className:"flex flex-col gap-2 mt-2",children:[e.jsx(O,{id:"newMemberUsername",label:s("groupMembers.labels.username"),maxLength:12,placeholder:s("groupMembers.placeholders.username"),register:b,validation:{required:s("groupMembers.validations.username")},error:v.newMemberUsername||m,classForLabel:"text-gray-200"}),e.jsx($,{id:"newMemberRole",label:s("groupMembers.labels.role"),options:[{value:"member",label:s("groupMembers.labels.member")},{value:"admin",label:s("groupMembers.labels.admin")},{value:"musician",label:s("groupMembers.labels.musician")},{value:"manager",label:s("groupMembers.labels.manager")}],register:b,error:v.newMemberRole,classForLabel:"text-gray-200"}),e.jsxs("div",{className:"flex flex-col gap-2 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{id:"newBandRole",label:s("groupMembers.labels.bandRole"),maxLength:12,placeholder:s("groupMembers.placeholders.bandRole"),register:b,error:v.newBandRole,className:"!flex-1"}),e.jsx("button",{type:"button",onClick:()=>{L&&!d.includes(L)&&d.length<3&&(g([...d,L]),D("newBandRole",""))},disabled:!L||d.length>=3,className:"text-emerald-500 hover:text-emerald-700 p-2 rounded-full focus:outline-none focus:ring-2 focus:ring-green-400 transition-colors disabled:opacity-40 disabled:cursor-not-allowed",children:e.jsx(I,{size:22})})]}),v.newBandRole&&e.jsx("span",{className:"text-red-500 text-sm",children:v.newBandRole.message}),d.length>0&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:d.map((x,E)=>e.jsxs("span",{className:"px-2 py-1 text-sm rounded bg-emerald-800 text-white flex items-center gap-2",children:[x,e.jsx("button",{type:"button",onClick:()=>g(d.filter(H=>H!==x)),className:"text-red-400 hover:text-red-600 font-bold",children:"×"})]},E))})]}),e.jsxs("div",{className:"flex gap-2 justify-center mb-5",children:[e.jsx(w,{onClick:()=>r(!1),className:"!bg-gray-600 hover:!bg-gray-700",children:s("groupMembers.buttons.cancel")}),e.jsx(w,{form:"add-member-form",type:"submit",className:"!bg-emerald-600 hover:!bg-emerald-700",disabled:R,children:s(R?"groupMembers.buttons.adding":"groupMembers.buttons.add")})]})]}):e.jsx("div",{className:"mb-4 flex items-center gap-2",children:e.jsxs("div",{className:"relative group flex items-center",children:[e.jsx("button",{type:"button",onClick:()=>r(!0),className:"text-emerald-600 hover:text-emerald-700 cursor-pointer p-2 rounded-full focus:outline-none focus:ring-2 focus:ring-green-400 transition-colors",children:e.jsx(I,{size:28})}),e.jsx("span",{className:"absolute left-10 whitespace-nowrap opacity-0 group-hover:opacity-100 group-hover:translate-x-2 transition-all duration-300 bg-gray-900 text-emerald-500 font-semibold text-base px-3 py-1 rounded-lg shadow pointer-events-none",style:{willChange:"opacity, transform"},children:s("groupMembers.buttons.addMember")})]})})}),e.jsx(ae,{members:i,isAdmin:u,onRemoveMember:B,onUpdateMember:a,currentUserId:N.id,refetch:c})]})},we=()=>{var b;const{groupId:t}=Q(),{user:i}=V(),{fetchProfileGroup:u}=W(),{fetchGroupMembers:N,addGroupMember:M,removeGroupMember:h,updateGroupMember:o}=X(),{t:c}=P("profileGroup"),{data:s,isLoading:j,error:r}=u(t),{data:n,isLoading:l,error:m,refetch:p}=N(t);if(j||l)return e.jsx(T,{});if(r||m)return e.jsx(Y,{error:(r==null?void 0:r.message)||(m==null?void 0:m.message)||c("errors.loading")});if(!s)return e.jsx("div",{children:c("errors.noData")});const g=((b=n==null?void 0:n.find(_=>_.profile_id===i.id))==null?void 0:b.role)==="admin";return e.jsx("div",{className:"flex flex-col md:flex-row min-h-screen bg-transparent text-white",children:e.jsxs("div",{className:"flex-1 p-4 md:p-8 max-w-4xl mx-auto gap-8",children:[e.jsx(se,{groupData:s,isAdmin:g}),"(",e.jsx(le,{groupId:t,groupMembers:n,isAdmin:g,user:i,addGroupMember:M,removeGroupMember:h,updateGroupMember:o,refetch:p}),"  )",e.jsx(ee,{group:s,onSave:()=>manageView("members","group"),onCancel:()=>manageView("members","group")})]})})};export{we as default};
