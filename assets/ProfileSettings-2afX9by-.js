import{j as n,l as G}from"./mui-DM0ppf3M.js";import{r as d}from"./calendar-BpW-aEGs.js";import{u as H,a as J,b as K,c as Q,d as ee,e as te,f as ae,C as z,Z as V,_ as se,P as ne,X as re,T as oe,I as C,n as S,S as x,B as q,Y as le}from"./index-BXNurRLk.js";import{I as ie}from"./icons-A8qOaPVA.js";const w=t=>t.endsWith(" Department")?t.replace(/ Department$/,""):t,he=({profile:t,onSave:N,onCancel:D})=>{var E;const{t:a}=H("profile"),{user:r}=J(),{updateProfile:M}=K(),{register:b,handleSubmit:W,setValue:c,reset:P,watch:m,control:l,formState:{errors:o,isSubmitting:_}}=Q({defaultValues:{bio:"",username:"",gender:"",country:"",state:"",birthdate:null,neighborhood:"",firstname:"",lastname:""}}),[v,L]=d.useState(""),[F,O]=d.useState(null),[Z,I]=d.useState(null),[A,R]=d.useState(""),[$,T]=d.useState(!1),k=d.useRef(null),{data:y=[]}=ee(),p=m("country"),{data:f=[]}=te(p),B=m("state"),{data:j=[]}=ae(p,B);d.useEffect(()=>{var e,s,u;if(t&&y.length>0&&f.length>=0&&j.length>=0){const i=((e=z.getAllCountries().find(h=>h.name===t.country))==null?void 0:e.isoCode)||t.country||"",g=((s=V.getStatesOfCountry(i).find(h=>w(h.name)===t.state))==null?void 0:s.isoCode)||t.state||"",U=((u=se.getCitiesOfState(i,g).find(h=>h.name===t.neighborhood))==null?void 0:u.name)||t.neighborhood||"";P({bio:t.bio||"",username:t.username||"",gender:t.gender||"",country:i,state:g,birthdate:t.birthdate?new Date(t.birthdate):"",neighborhood:U,firstname:t.firstname||"",lastname:t.lastname||""}),L(t.avatar_url===null||t.avatar_url===void 0?"":String(t.avatar_url))}},[t,y,f,j,P]);const X=e=>{if(e.length>0){const s=e[0];O(s),I(URL.createObjectURL(s))}else O(null),I(null)},Y=async e=>{R("");try{let s=v??"";F&&(r!=null&&r.id)&&(s=await le(F,"avatars",r.id,v??"",!0)??"",L(s));const u=z.getCountryByCode(e.country),i=V.getStateByCodeAndCountry(e.state,e.country),g={...e,country:(u==null?void 0:u.name)||e.country,state:w((i==null?void 0:i.name)||e.state),neighborhood:e.neighborhood,avatar_url:s,id:(r==null?void 0:r.id)||(t==null?void 0:t.id),email:(r==null?void 0:r.email)||(t==null?void 0:t.email)||"",birthdate:e.birthdate instanceof Date?e.birthdate.toISOString():typeof e.birthdate=="string"?e.birthdate:null,last_seen:(t==null?void 0:t.last_seen)??new Date().toISOString()};await M(g),N&&N(),T(!0),setTimeout(()=>{T(!1)},2500)}catch(s){R(s.message||a("edit.errors.updateFailed"))}};return n.jsxs("div",{className:"bg-gradient-to-l to-gray-900 p-6 rounded-b-lg shadow-lg max-w-4xl mx-auto",children:[n.jsx("h2",{className:"text-2xl font-semibold text-yellow-600 text-center mb-4",children:a("edit.title")}),r&&n.jsxs("div",{ref:k,className:"relative w-fit mx-auto cursor-pointer group",children:[n.jsx(ne,{avatar_url:Z||v,gender:m("gender")}),n.jsx("div",{className:"absolute bottom-1 right-1 bg-white rounded-full p-1 shadow-md group-hover:opacity-100 opacity-80 transition-opacity",children:n.jsx(ie,{size:20,className:"text-gray-700"})})]}),n.jsx("div",{className:"my-4",children:n.jsx(re,{onFilesUpdate:X,amount:1,triggerRef:k,classForLabel:""})}),A&&n.jsx("p",{className:"text-red-500 text-sm text-center",children:A}),n.jsxs("form",{onSubmit:W(Y),className:"space-y-4 grid grid-cols-1 sm:grid-cols-2 gap-4",children:[n.jsx(oe,{id:"bio",label:a("edit.labels.bio"),placeholder:a("edit.placeholders.bio"),register:b,validation:{maxLength:{value:100,message:a("edit.validation.bioMaxLength")}},error:o.bio,maxLength:100,watchValue:m("bio")}),n.jsx(C,{id:"firstname",label:a("edit.labels.firstname"),placeholder:a("edit.placeholders.firstname"),register:b,error:o.firstname}),n.jsx(C,{id:"lastname",label:a("edit.labels.lastname"),placeholder:a("edit.placeholders.lastname"),register:b,error:o.lastname}),n.jsx(S,{name:"country",control:l,render:({field:e})=>n.jsx(x,{id:"country",control:l,defaultOption:a("edit.placeholders.country"),label:a("edit.labels.country"),options:y.map(s=>({value:s.isoCode,label:s.name})),onChange:s=>{e.onChange(s),c("state",""),c("neighborhood","")},error:o.country})}),n.jsx(S,{name:"state",control:l,render:({field:e})=>n.jsx(x,{id:"state",control:l,defaultOption:a("edit.placeholders.state"),label:a("edit.labels.state"),options:f.map(s=>({value:s.isoCode,label:w(s.name)||""})),onChange:s=>{e.onChange(s),c("neighborhood","")},disabled:!p,error:o.state})}),n.jsx(S,{name:"neighborhood",control:l,render:({field:e})=>n.jsx(x,{id:"neighborhood",control:l,defaultOption:a("edit.placeholders.neighborhood"),label:a("edit.labels.neighborhood"),options:j.map(s=>({value:s.name,label:s.name})),onChange:e.onChange,disabled:!B,error:o.neighborhood})}),n.jsx(C,{id:"username",label:a("edit.labels.username"),placeholder:a("edit.placeholders.username"),register:b,maxLength:12,validation:{required:a("edit.validation.usernameRequired"),maxLength:{value:12,message:a("edit.validation.usernameMaxLength")},pattern:{value:/^[a-zA-Z0-9_.-]+$/,message:a("edit.validation.usernamePattern")}},error:o.username}),n.jsx(x,{id:"gender",label:a("edit.labels.gender"),options:[{value:"male",label:a("edit.placeholders.genderOptions.male")},{value:"female",label:a("edit.placeholders.genderOptions.female")},{value:"other",label:a("edit.placeholders.genderOptions.other")}],control:l,search:!1,error:o.gender}),n.jsxs("div",{className:"sm:col-span-1",children:[n.jsx("label",{htmlFor:"birthdate",className:"block text-sm font-semibold mb-3 text-white",children:a("edit.labels.birthdate")}),n.jsx(G,{value:(()=>{const e=m("birthdate");if(e instanceof Date)return e;if(typeof e=="string"&&e){const s=new Date(e);return isNaN(s.getTime())?null:s}return null})(),onChange:e=>{e&&typeof e.toDate=="function"?c("birthdate",e.toDate()):e instanceof Date?c("birthdate",e):c("birthdate",null)},slotProps:{textField:{variant:"outlined",size:"small",fullWidth:!0,error:!!o.birthdate,helperText:(E=o.birthdate)==null?void 0:E.message}}})]}),n.jsxs("div",{className:"sm:col-span-2 flex justify-center mt-10 gap-4",children:[n.jsx(q,{className:"!bg-emerald-600 hover:!bg-emerald-700 text-white",type:"submit",disabled:_,children:a(_?"edit.buttons.saving":$?"edit.labels.saved":"edit.buttons.save")}),D&&n.jsx(q,{className:"!bg-gray-600 hover:!bg-gray-700 text-white",type:"button",onClick:()=>{D()},children:a("edit.buttons.cancel")})]})]})]})};export{he as P};
