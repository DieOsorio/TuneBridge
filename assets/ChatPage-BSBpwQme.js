import{j as s}from"./mui-DntPDMdt.js";import{r as i,U as y,b as dr,t as fr,a as mr}from"./calendar-DXWKnWXk.js";import{a as Ee,G as _e,b as Le,_ as Re,E as st,u as ve,D as ot,M as At,j as it,$ as ut,c as pr,x as Se,P as Qe,a0 as hr,a1 as gr,a2 as _t,k as vr,a3 as xr,a4 as br}from"./index-BXZZvcoM.js";import{S as Fe}from"./index-BXOMkYts.js";/* empty css                 */import{F as wr}from"./PencilIcon-D1yNP24j.js";import{w as yr,l as jr,x as Er}from"./icons-DoyJ_9a6.js";import"./reactPlayer-CBmCIXQE.js";import"./lottie-FCmafNqs.js";import"./gsap-CH_iu5NA.js";import"./filepond-DvarZm2e.js";function Nr({title:e,titleId:t,...r},n){return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":t},r),e?i.createElement("title",{id:t},e):null,i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"}))}const gt=i.forwardRef(Nr);function Cr({title:e,titleId:t,...r},n){return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":t},r),e?i.createElement("title",{id:t},e):null,i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.827 6.175A2.31 2.31 0 0 1 5.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 0 0-1.134-.175 2.31 2.31 0 0 1-1.64-1.055l-.822-1.316a2.192 2.192 0 0 0-1.736-1.039 48.774 48.774 0 0 0-5.232 0 2.192 2.192 0 0 0-1.736 1.039l-.821 1.316Z"}),i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 12.75a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0ZM18.75 10.5h.008v.008h-.008V10.5Z"}))}const kr=i.forwardRef(Cr);function $r({title:e,titleId:t,...r},n){return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":t},r),e?i.createElement("title",{id:t},e):null,i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 12.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 18.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5Z"}))}const Te=i.forwardRef($r);function Sr({title:e,titleId:t,...r},n){return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":t},r),e?i.createElement("title",{id:t},e):null,i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"}))}const vt=i.forwardRef(Sr);function Fr({title:e,titleId:t,...r},n){return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":t},r),e?i.createElement("title",{id:t},e):null,i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M22 10.5h-6m-2.25-4.125a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0ZM4 19.235v-.11a6.375 6.375 0 0 1 12.75 0v.109A12.318 12.318 0 0 1 10.374 21c-2.331 0-4.512-.645-6.374-1.766Z"}))}const Or=i.forwardRef(Fr);function Pr({title:e,titleId:t,...r},n){return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":t},r),e?i.createElement("title",{id:t},e):null,i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18 18 6M6 6l12 12"}))}const ge=i.forwardRef(Pr),Lt=({isSelected:e=!1})=>{const t="#a1a1aa",r="#e4e4e7";return s.jsxs("div",{className:`flex items-center gap-3 px-4 py-2 ${e?"bg-sky-700":"bg-transparent"}`,children:[s.jsx(Fe,{circle:!0,width:40,height:40,baseColor:t,highlightColor:r}),s.jsx("div",{className:"flex flex-col grow",children:s.jsx(Fe,{height:15,width:"80%",baseColor:t,highlightColor:r})})]})},Ar=({conversation:e,isSelected:t,onClick:r})=>{const{user:n}=Ee(),{fetchParticipants:a}=_e(),{data:o=[],isLoading:c,error:u}=a(e.id),{fetchProfile:l}=Le(),d=o==null?void 0:o.find(w=>w.profile_id!==(n==null?void 0:n.id)),{data:f,isLoading:g,error:m}=l((d==null?void 0:d.profile_id)??""),{unreadMessages:p}=Re(),{data:h,isLoading:x}=p({conversationId:e.id,profileId:(n==null?void 0:n.id)||""});if(c||g)return s.jsx(Lt,{isSelected:t});if(u||m)return s.jsx(st,{error:(u==null?void 0:u.message)||(m==null?void 0:m.message)||"Unknown error"});const j=e.is_group?e.avatar_url:f==null?void 0:f.avatar_url,b=e.is_group?e.title:f==null?void 0:f.username;return s.jsxs("div",{onClick:()=>r(e.id),className:`flex items-center gap-3 px-4 py-2 cursor-pointer transition-colors ${t?"bg-sky-700":"hover:bg-sky-950 hover:text-white"}`,children:[s.jsxs("div",{className:"relative",children:[j?s.jsx("img",{src:j,alt:"Avatar",className:"w-10 h-10 rounded-full object-cover"}):s.jsx("div",{className:"w-10 h-10 rounded-full bg-neutral-600 flex items-center justify-center text-white text-sm",children:(b==null?void 0:b.charAt(0).toUpperCase())||"?"}),!x&&(h!=null&&h.length)?s.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full px-1.5",children:(h==null?void 0:h.length)??0}):null]}),s.jsxs("div",{className:"flex flex-col",children:[s.jsx("span",{className:`font-medium truncate ${t&&"text-white"}`,children:b||"Untitled"}),e.last_message&&s.jsx("span",{className:"text-sm text-neutral-400 truncate max-w-[180px]",children:e.last_message})]})]})},_r=({onSelectConversation:e})=>{const{t}=ve("chat"),{user:r}=Ee(),{fetchConversations:n}=ot(),{data:a,isLoading:o,error:c}=n((r==null?void 0:r.id)??""),{conversationId:u}=At(),l=it(),[d,f]=i.useState(u),{setIsConversationListVisible:g}=ut();i.useEffect(()=>{!u&&a&&a.length>0?f(a[0].id):f(u)},[u,a]);const m=p=>{f(p),l(`/chat/${p}`),g(!1),e==null||e()};return o?s.jsx(s.Fragment,{children:[...Array(3)].map((p,h)=>s.jsx(Lt,{},h))}):c?s.jsx(st,{error:c.message}):s.jsx("div",{className:"w-full overflow-y-auto h-full bg-gradient-to-l from-gray-900 border-r-2 border-sky-700",children:a!=null&&a.length?a.map(p=>s.jsx(Ar,{conversation:p,isSelected:d===p.id,onClick:()=>m(p.id)},p.id)):s.jsx("p",{className:"text-gray-400 p-4",children:t("list")})})};var Lr=Object.defineProperty,Rr=(e,t,r)=>t in e?Lr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Ke=(e,t,r)=>(Rr(e,typeof t!="symbol"?t+"":t,r),r);let Tr=class{constructor(){Ke(this,"current",this.detect()),Ke(this,"handoffState","pending"),Ke(this,"currentId",0)}set(t){this.current!==t&&(this.handoffState="pending",this.currentId=0,this.current=t)}reset(){this.set(this.detect())}nextId(){return++this.currentId}get isServer(){return this.current==="server"}get isClient(){return this.current==="client"}detect(){return typeof window>"u"||typeof document>"u"?"server":"client"}handoff(){this.handoffState==="pending"&&(this.handoffState="complete")}get isHandoffComplete(){return this.handoffState==="complete"}},q=new Tr;function Me(e){var t,r;return q.isServer?null:e?"ownerDocument"in e?e.ownerDocument:"current"in e?(r=(t=e.current)==null?void 0:t.ownerDocument)!=null?r:document:null:document}function De(e){typeof queueMicrotask=="function"?queueMicrotask(e):Promise.resolve().then(e).catch(t=>setTimeout(()=>{throw t}))}function re(){let e=[],t={addEventListener(r,n,a,o){return r.addEventListener(n,a,o),t.add(()=>r.removeEventListener(n,a,o))},requestAnimationFrame(...r){let n=requestAnimationFrame(...r);return t.add(()=>cancelAnimationFrame(n))},nextFrame(...r){return t.requestAnimationFrame(()=>t.requestAnimationFrame(...r))},setTimeout(...r){let n=setTimeout(...r);return t.add(()=>clearTimeout(n))},microTask(...r){let n={current:!0};return De(()=>{n.current&&r[0]()}),t.add(()=>{n.current=!1})},style(r,n,a){let o=r.style.getPropertyValue(n);return Object.assign(r.style,{[n]:a}),this.add(()=>{Object.assign(r.style,{[n]:o})})},group(r){let n=re();return r(n),this.add(()=>n.dispose())},add(r){return e.includes(r)||e.push(r),()=>{let n=e.indexOf(r);if(n>=0)for(let a of e.splice(n,1))a()}},dispose(){for(let r of e.splice(0))r()}};return t}function ct(){let[e]=i.useState(re);return i.useEffect(()=>()=>e.dispose(),[e]),e}let L=(e,t)=>{q.isServer?i.useEffect(e,t):i.useLayoutEffect(e,t)};function he(e){let t=i.useRef(e);return L(()=>{t.current=e},[e]),t}let F=function(e){let t=he(e);return y.useCallback((...r)=>t.current(...r),[t])},Mr=i.createContext(void 0);function Dr(){return i.useContext(Mr)}function et(...e){return Array.from(new Set(e.flatMap(t=>typeof t=="string"?t.split(" "):[]))).filter(Boolean).join(" ")}function te(e,t,...r){if(e in t){let a=t[e];return typeof a=="function"?a(...r):a}let n=new Error(`Tried to handle "${e}" but there is no handler defined. Only defined handlers are: ${Object.keys(t).map(a=>`"${a}"`).join(", ")}.`);throw Error.captureStackTrace&&Error.captureStackTrace(n,te),n}var Oe=(e=>(e[e.None=0]="None",e[e.RenderStrategy=1]="RenderStrategy",e[e.Static=2]="Static",e))(Oe||{}),se=(e=>(e[e.Unmount=0]="Unmount",e[e.Hidden=1]="Hidden",e))(se||{});function W(){let e=Ur();return i.useCallback(t=>Ir({mergeRefs:e,...t}),[e])}function Ir({ourProps:e,theirProps:t,slot:r,defaultTag:n,features:a,visible:o=!0,name:c,mergeRefs:u}){u=u??Wr;let l=Rt(t,e);if(o)return ke(l,r,n,c,u);let d=a??0;if(d&2){let{static:f=!1,...g}=l;if(f)return ke(g,r,n,c,u)}if(d&1){let{unmount:f=!0,...g}=l;return te(f?0:1,{0(){return null},1(){return ke({...g,hidden:!0,style:{display:"none"}},r,n,c,u)}})}return ke(l,r,n,c,u)}function ke(e,t={},r,n,a){let{as:o=r,children:c,refName:u="ref",...l}=qe(e,["unmount","static"]),d=e.ref!==void 0?{[u]:e.ref}:{},f=typeof c=="function"?c(t):c;"className"in l&&l.className&&typeof l.className=="function"&&(l.className=l.className(t)),l["aria-labelledby"]&&l["aria-labelledby"]===l.id&&(l["aria-labelledby"]=void 0);let g={};if(t){let m=!1,p=[];for(let[h,x]of Object.entries(t))typeof x=="boolean"&&(m=!0),x===!0&&p.push(h.replace(/([A-Z])/g,v=>`-${v.toLowerCase()}`));if(m){g["data-headlessui-state"]=p.join(" ");for(let h of p)g[`data-${h}`]=""}}if(o===i.Fragment&&(Object.keys(de(l)).length>0||Object.keys(de(g)).length>0))if(!i.isValidElement(f)||Array.isArray(f)&&f.length>1){if(Object.keys(de(l)).length>0)throw new Error(['Passing props on "Fragment"!',"",`The current component <${n} /> is rendering a "Fragment".`,"However we need to passthrough the following props:",Object.keys(de(l)).concat(Object.keys(de(g))).map(m=>`  - ${m}`).join(`
`),"","You can apply a few solutions:",['Add an `as="..."` prop, to ensure that we render an actual element instead of a "Fragment".',"Render a single element as the child so that we can forward the props onto that element."].map(m=>`  - ${m}`).join(`
`)].join(`
`))}else{let m=f.props,p=m==null?void 0:m.className,h=typeof p=="function"?(...j)=>et(p(...j),l.className):et(p,l.className),x=h?{className:h}:{},v=Rt(f.props,de(qe(l,["ref"])));for(let j in g)j in v&&delete g[j];return i.cloneElement(f,Object.assign({},v,g,d,{ref:a(Hr(f),d.ref)},x))}return i.createElement(o,Object.assign({},qe(l,["ref"]),o!==i.Fragment&&d,o!==i.Fragment&&g),f)}function Ur(){let e=i.useRef([]),t=i.useCallback(r=>{for(let n of e.current)n!=null&&(typeof n=="function"?n(r):n.current=r)},[]);return(...r)=>{if(!r.every(n=>n==null))return e.current=r,t}}function Wr(...e){return e.every(t=>t==null)?void 0:t=>{for(let r of e)r!=null&&(typeof r=="function"?r(t):r.current=t)}}function Rt(...e){if(e.length===0)return{};if(e.length===1)return e[0];let t={},r={};for(let n of e)for(let a in n)a.startsWith("on")&&typeof n[a]=="function"?(r[a]!=null||(r[a]=[]),r[a].push(n[a])):t[a]=n[a];if(t.disabled||t["aria-disabled"])for(let n in r)/^(on(?:Click|Pointer|Mouse|Key)(?:Down|Up|Press)?)$/.test(n)&&(r[n]=[a=>{var o;return(o=a==null?void 0:a.preventDefault)==null?void 0:o.call(a)}]);for(let n in r)Object.assign(t,{[n](a,...o){let c=r[n];for(let u of c){if((a instanceof Event||(a==null?void 0:a.nativeEvent)instanceof Event)&&a.defaultPrevented)return;u(a,...o)}}});return t}function T(e){var t;return Object.assign(i.forwardRef(e),{displayName:(t=e.displayName)!=null?t:e.name})}function de(e){let t=Object.assign({},e);for(let r in t)t[r]===void 0&&delete t[r];return t}function qe(e,t=[]){let r=Object.assign({},e);for(let n of t)n in r&&delete r[n];return r}function Hr(e){return y.version.split(".")[0]>="19"?e.props.ref:e.ref}let Br="span";var Pe=(e=>(e[e.None=1]="None",e[e.Focusable=2]="Focusable",e[e.Hidden=4]="Hidden",e))(Pe||{});function Vr(e,t){var r;let{features:n=1,...a}=e,o={ref:t,"aria-hidden":(n&2)===2?!0:(r=a["aria-hidden"])!=null?r:void 0,hidden:(n&4)===4?!0:void 0,style:{position:"fixed",top:1,left:1,width:1,height:0,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0",...(n&4)===4&&(n&2)!==2&&{display:"none"}}};return W()({ourProps:o,theirProps:a,slot:{},defaultTag:Br,name:"Hidden"})}let tt=T(Vr);function Tt(e){return typeof e!="object"||e===null?!1:"nodeType"in e}function ie(e){return Tt(e)&&"tagName"in e}function pe(e){return ie(e)&&"accessKey"in e}function oe(e){return ie(e)&&"tabIndex"in e}function Gr(e){return ie(e)&&"style"in e}function zr(e){return pe(e)&&e.nodeName==="IFRAME"}function Kr(e){return pe(e)&&e.nodeName==="INPUT"}let Mt=Symbol();function qr(e,t=!0){return Object.assign(e,{[Mt]:t})}function Y(...e){let t=i.useRef(e);i.useEffect(()=>{t.current=e},[e]);let r=F(n=>{for(let a of t.current)a!=null&&(typeof a=="function"?a(n):a.current=n)});return e.every(n=>n==null||(n==null?void 0:n[Mt]))?void 0:r}let dt=i.createContext(null);dt.displayName="DescriptionContext";function Dt(){let e=i.useContext(dt);if(e===null){let t=new Error("You used a <Description /> component, but it is not inside a relevant parent.");throw Error.captureStackTrace&&Error.captureStackTrace(t,Dt),t}return e}function Yr(){let[e,t]=i.useState([]);return[e.length>0?e.join(" "):void 0,i.useMemo(()=>function(r){let n=F(o=>(t(c=>[...c,o]),()=>t(c=>{let u=c.slice(),l=u.indexOf(o);return l!==-1&&u.splice(l,1),u}))),a=i.useMemo(()=>({register:n,slot:r.slot,name:r.name,props:r.props,value:r.value}),[n,r.slot,r.name,r.props,r.value]);return y.createElement(dt.Provider,{value:a},r.children)},[t])]}let Zr="p";function Xr(e,t){let r=i.useId(),n=Dr(),{id:a=`headlessui-description-${r}`,...o}=e,c=Dt(),u=Y(t);L(()=>c.register(a),[a,c.register]);let l=n||!1,d=i.useMemo(()=>({...c.slot,disabled:l}),[c.slot,l]),f={ref:u,...c.props,id:a};return W()({ourProps:f,theirProps:o,slot:d,defaultTag:Zr,name:c.name||"Description"})}let Jr=T(Xr),Qr=Object.assign(Jr,{});var It=(e=>(e.Space=" ",e.Enter="Enter",e.Escape="Escape",e.Backspace="Backspace",e.Delete="Delete",e.ArrowLeft="ArrowLeft",e.ArrowUp="ArrowUp",e.ArrowRight="ArrowRight",e.ArrowDown="ArrowDown",e.Home="Home",e.End="End",e.PageUp="PageUp",e.PageDown="PageDown",e.Tab="Tab",e))(It||{});let en=i.createContext(()=>{});function tn({value:e,children:t}){return y.createElement(en.Provider,{value:e},t)}let Ut=class extends Map{constructor(t){super(),this.factory=t}get(t){let r=super.get(t);return r===void 0&&(r=this.factory(t),this.set(t,r)),r}};var rn=Object.defineProperty,nn=(e,t,r)=>t in e?rn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,an=(e,t,r)=>(nn(e,t+"",r),r),Wt=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)},U=(e,t,r)=>(Wt(e,t,"read from private field"),r?r.call(e):t.get(e)),Ye=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},xt=(e,t,r,n)=>(Wt(e,t,"write to private field"),t.set(e,r),r),K,xe,be;let ln=class{constructor(t){Ye(this,K,{}),Ye(this,xe,new Ut(()=>new Set)),Ye(this,be,new Set),an(this,"disposables",re()),xt(this,K,t),q.isServer&&this.disposables.microTask(()=>{this.dispose()})}dispose(){this.disposables.dispose()}get state(){return U(this,K)}subscribe(t,r){if(q.isServer)return()=>{};let n={selector:t,callback:r,current:t(U(this,K))};return U(this,be).add(n),this.disposables.add(()=>{U(this,be).delete(n)})}on(t,r){return q.isServer?()=>{}:(U(this,xe).get(t).add(r),this.disposables.add(()=>{U(this,xe).get(t).delete(r)}))}send(t){let r=this.reduce(U(this,K),t);if(r!==U(this,K)){xt(this,K,r);for(let n of U(this,be)){let a=n.selector(U(this,K));Ht(n.current,a)||(n.current=a,n.callback(a))}for(let n of U(this,xe).get(t.type))n(U(this,K),t)}}};K=new WeakMap,xe=new WeakMap,be=new WeakMap;function Ht(e,t){return Object.is(e,t)?!0:typeof e!="object"||e===null||typeof t!="object"||t===null?!1:Array.isArray(e)&&Array.isArray(t)?e.length!==t.length?!1:Ze(e[Symbol.iterator](),t[Symbol.iterator]()):e instanceof Map&&t instanceof Map||e instanceof Set&&t instanceof Set?e.size!==t.size?!1:Ze(e.entries(),t.entries()):bt(e)&&bt(t)?Ze(Object.entries(e)[Symbol.iterator](),Object.entries(t)[Symbol.iterator]()):!1}function Ze(e,t){do{let r=e.next(),n=t.next();if(r.done&&n.done)return!0;if(r.done||n.done||!Object.is(r.value,n.value))return!1}while(!0)}function bt(e){if(Object.prototype.toString.call(e)!=="[object Object]")return!1;let t=Object.getPrototypeOf(e);return t===null||Object.getPrototypeOf(t)===null}var sn=Object.defineProperty,on=(e,t,r)=>t in e?sn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,wt=(e,t,r)=>(on(e,typeof t!="symbol"?t+"":t,r),r),un=(e=>(e[e.Push=0]="Push",e[e.Pop=1]="Pop",e))(un||{});let cn={0(e,t){let r=t.id,n=e.stack,a=e.stack.indexOf(r);if(a!==-1){let o=e.stack.slice();return o.splice(a,1),o.push(r),n=o,{...e,stack:n}}return{...e,stack:[...e.stack,r]}},1(e,t){let r=t.id,n=e.stack.indexOf(r);if(n===-1)return e;let a=e.stack.slice();return a.splice(n,1),{...e,stack:a}}},dn=class Bt extends ln{constructor(){super(...arguments),wt(this,"actions",{push:t=>this.send({type:0,id:t}),pop:t=>this.send({type:1,id:t})}),wt(this,"selectors",{isTop:(t,r)=>t.stack[t.stack.length-1]===r,inStack:(t,r)=>t.stack.includes(r)})}static new(){return new Bt({stack:[]})}reduce(t,r){return te(r.type,cn,t,r)}};const Vt=new Ut(()=>dn.new());var Xe={exports:{}},Je={};/**
 * @license React
 * use-sync-external-store-with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yt;function fn(){if(yt)return Je;yt=1;var e=dr();function t(l,d){return l===d&&(l!==0||1/l===1/d)||l!==l&&d!==d}var r=typeof Object.is=="function"?Object.is:t,n=e.useSyncExternalStore,a=e.useRef,o=e.useEffect,c=e.useMemo,u=e.useDebugValue;return Je.useSyncExternalStoreWithSelector=function(l,d,f,g,m){var p=a(null);if(p.current===null){var h={hasValue:!1,value:null};p.current=h}else h=p.current;p=c(function(){function v(C){if(!j){if(j=!0,b=C,C=g(C),m!==void 0&&h.hasValue){var O=h.value;if(m(O,C))return w=O}return w=C}if(O=w,r(b,C))return O;var k=g(C);return m!==void 0&&m(O,k)?(b=C,O):(b=C,w=k)}var j=!1,b,w,N=f===void 0?null:f;return[function(){return v(d())},N===null?void 0:function(){return v(N())}]},[d,f,g,m]);var x=n(l,p[0],p[1]);return o(function(){h.hasValue=!0,h.value=x},[x]),u(x),x},Je}var jt;function mn(){return jt||(jt=1,Xe.exports=fn()),Xe.exports}var pn=mn();function Gt(e,t,r=Ht){return pn.useSyncExternalStoreWithSelector(F(n=>e.subscribe(hn,n)),F(()=>e.state),F(()=>e.state),F(t),r)}function hn(e){return e}function Ne(e,t){let r=i.useId(),n=Vt.get(t),[a,o]=Gt(n,i.useCallback(c=>[n.selectors.isTop(c,r),n.selectors.inStack(c,r)],[n,r]));return L(()=>{if(e)return n.actions.push(r),()=>n.actions.pop(r)},[n,e,r]),e?o?a:!0:!1}let rt=new Map,ye=new Map;function Et(e){var t;let r=(t=ye.get(e))!=null?t:0;return ye.set(e,r+1),r!==0?()=>Nt(e):(rt.set(e,{"aria-hidden":e.getAttribute("aria-hidden"),inert:e.inert}),e.setAttribute("aria-hidden","true"),e.inert=!0,()=>Nt(e))}function Nt(e){var t;let r=(t=ye.get(e))!=null?t:1;if(r===1?ye.delete(e):ye.set(e,r-1),r!==1)return;let n=rt.get(e);n&&(n["aria-hidden"]===null?e.removeAttribute("aria-hidden"):e.setAttribute("aria-hidden",n["aria-hidden"]),e.inert=n.inert,rt.delete(e))}function gn(e,{allowed:t,disallowed:r}={}){let n=Ne(e,"inert-others");L(()=>{var a,o;if(!n)return;let c=re();for(let l of(a=r==null?void 0:r())!=null?a:[])l&&c.add(Et(l));let u=(o=t==null?void 0:t())!=null?o:[];for(let l of u){if(!l)continue;let d=Me(l);if(!d)continue;let f=l.parentElement;for(;f&&f!==d.body;){for(let g of f.children)u.some(m=>g.contains(m))||c.add(Et(g));f=f.parentElement}}return c.dispose},[n,t,r])}function vn(e,t,r){let n=he(a=>{let o=a.getBoundingClientRect();o.x===0&&o.y===0&&o.width===0&&o.height===0&&r()});i.useEffect(()=>{if(!e)return;let a=t===null?null:pe(t)?t:t.current;if(!a)return;let o=re();if(typeof ResizeObserver<"u"){let c=new ResizeObserver(()=>n.current(a));c.observe(a),o.add(()=>c.disconnect())}if(typeof IntersectionObserver<"u"){let c=new IntersectionObserver(()=>n.current(a));c.observe(a),o.add(()=>c.disconnect())}return()=>o.dispose()},[t,n,e])}let Ae=["[contentEditable=true]","[tabindex]","a[href]","area[href]","button:not([disabled])","iframe","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].map(e=>`${e}:not([tabindex='-1'])`).join(","),xn=["[data-autofocus]"].map(e=>`${e}:not([tabindex='-1'])`).join(",");var Q=(e=>(e[e.First=1]="First",e[e.Previous=2]="Previous",e[e.Next=4]="Next",e[e.Last=8]="Last",e[e.WrapAround=16]="WrapAround",e[e.NoScroll=32]="NoScroll",e[e.AutoFocus=64]="AutoFocus",e))(Q||{}),nt=(e=>(e[e.Error=0]="Error",e[e.Overflow=1]="Overflow",e[e.Success=2]="Success",e[e.Underflow=3]="Underflow",e))(nt||{}),bn=(e=>(e[e.Previous=-1]="Previous",e[e.Next=1]="Next",e))(bn||{});function wn(e=document.body){return e==null?[]:Array.from(e.querySelectorAll(Ae)).sort((t,r)=>Math.sign((t.tabIndex||Number.MAX_SAFE_INTEGER)-(r.tabIndex||Number.MAX_SAFE_INTEGER)))}function yn(e=document.body){return e==null?[]:Array.from(e.querySelectorAll(xn)).sort((t,r)=>Math.sign((t.tabIndex||Number.MAX_SAFE_INTEGER)-(r.tabIndex||Number.MAX_SAFE_INTEGER)))}var zt=(e=>(e[e.Strict=0]="Strict",e[e.Loose=1]="Loose",e))(zt||{});function jn(e,t=0){var r;return e===((r=Me(e))==null?void 0:r.body)?!1:te(t,{0(){return e.matches(Ae)},1(){let n=e;for(;n!==null;){if(n.matches(Ae))return!0;n=n.parentElement}return!1}})}var En=(e=>(e[e.Keyboard=0]="Keyboard",e[e.Mouse=1]="Mouse",e))(En||{});typeof window<"u"&&typeof document<"u"&&(document.addEventListener("keydown",e=>{e.metaKey||e.altKey||e.ctrlKey||(document.documentElement.dataset.headlessuiFocusVisible="")},!0),document.addEventListener("click",e=>{e.detail===1?delete document.documentElement.dataset.headlessuiFocusVisible:e.detail===0&&(document.documentElement.dataset.headlessuiFocusVisible="")},!0));function ee(e){e==null||e.focus({preventScroll:!0})}let Nn=["textarea","input"].join(",");function Cn(e){var t,r;return(r=(t=e==null?void 0:e.matches)==null?void 0:t.call(e,Nn))!=null?r:!1}function kn(e,t=r=>r){return e.slice().sort((r,n)=>{let a=t(r),o=t(n);if(a===null||o===null)return 0;let c=a.compareDocumentPosition(o);return c&Node.DOCUMENT_POSITION_FOLLOWING?-1:c&Node.DOCUMENT_POSITION_PRECEDING?1:0})}function je(e,t,{sorted:r=!0,relativeTo:n=null,skipElements:a=[]}={}){let o=Array.isArray(e)?e.length>0?e[0].ownerDocument:document:e.ownerDocument,c=Array.isArray(e)?r?kn(e):e:t&64?yn(e):wn(e);a.length>0&&c.length>1&&(c=c.filter(p=>!a.some(h=>h!=null&&"current"in h?(h==null?void 0:h.current)===p:h===p))),n=n??o.activeElement;let u=(()=>{if(t&5)return 1;if(t&10)return-1;throw new Error("Missing Focus.First, Focus.Previous, Focus.Next or Focus.Last")})(),l=(()=>{if(t&1)return 0;if(t&2)return Math.max(0,c.indexOf(n))-1;if(t&4)return Math.max(0,c.indexOf(n))+1;if(t&8)return c.length-1;throw new Error("Missing Focus.First, Focus.Previous, Focus.Next or Focus.Last")})(),d=t&32?{preventScroll:!0}:{},f=0,g=c.length,m;do{if(f>=g||f+g<=0)return 0;let p=l+f;if(t&16)p=(p+g)%g;else{if(p<0)return 3;if(p>=g)return 1}m=c[p],m==null||m.focus(d),f+=u}while(m!==o.activeElement);return t&6&&Cn(m)&&m.select(),2}function Kt(){return/iPhone/gi.test(window.navigator.platform)||/Mac/gi.test(window.navigator.platform)&&window.navigator.maxTouchPoints>0}function $n(){return/Android/gi.test(window.navigator.userAgent)}function Ct(){return Kt()||$n()}function $e(e,t,r,n){let a=he(r);i.useEffect(()=>{if(!e)return;function o(c){a.current(c)}return document.addEventListener(t,o,n),()=>document.removeEventListener(t,o,n)},[e,t,n])}function qt(e,t,r,n){let a=he(r);i.useEffect(()=>{if(!e)return;function o(c){a.current(c)}return window.addEventListener(t,o,n),()=>window.removeEventListener(t,o,n)},[e,t,n])}const kt=30;function Sn(e,t,r){let n=he(r),a=i.useCallback(function(u,l){if(u.defaultPrevented)return;let d=l(u);if(d===null||!d.getRootNode().contains(d)||!d.isConnected)return;let f=function g(m){return typeof m=="function"?g(m()):Array.isArray(m)||m instanceof Set?m:[m]}(t);for(let g of f)if(g!==null&&(g.contains(d)||u.composed&&u.composedPath().includes(g)))return;return!jn(d,zt.Loose)&&d.tabIndex!==-1&&u.preventDefault(),n.current(u,d)},[n,t]),o=i.useRef(null);$e(e,"pointerdown",u=>{var l,d;Ct()||(o.current=((d=(l=u.composedPath)==null?void 0:l.call(u))==null?void 0:d[0])||u.target)},!0),$e(e,"pointerup",u=>{if(Ct()||!o.current)return;let l=o.current;return o.current=null,a(u,()=>l)},!0);let c=i.useRef({x:0,y:0});$e(e,"touchstart",u=>{c.current.x=u.touches[0].clientX,c.current.y=u.touches[0].clientY},!0),$e(e,"touchend",u=>{let l={x:u.changedTouches[0].clientX,y:u.changedTouches[0].clientY};if(!(Math.abs(l.x-c.current.x)>=kt||Math.abs(l.y-c.current.y)>=kt))return a(u,()=>oe(u.target)?u.target:null)},!0),qt(e,"blur",u=>a(u,()=>zr(window.document.activeElement)?window.document.activeElement:null),!0)}function Ie(...e){return i.useMemo(()=>Me(...e),[...e])}function Yt(e,t,r,n){let a=he(r);i.useEffect(()=>{e=e??window;function o(c){a.current(c)}return e.addEventListener(t,o,n),()=>e.removeEventListener(t,o,n)},[e,t,n])}function Fn(e){return i.useSyncExternalStore(e.subscribe,e.getSnapshot,e.getSnapshot)}function On(e,t){let r=e(),n=new Set;return{getSnapshot(){return r},subscribe(a){return n.add(a),()=>n.delete(a)},dispatch(a,...o){let c=t[a].call(r,...o);c&&(r=c,n.forEach(u=>u()))}}}function Pn(){let e;return{before({doc:t}){var r;let n=t.documentElement,a=(r=t.defaultView)!=null?r:window;e=Math.max(0,a.innerWidth-n.clientWidth)},after({doc:t,d:r}){let n=t.documentElement,a=Math.max(0,n.clientWidth-n.offsetWidth),o=Math.max(0,e-a);r.style(n,"paddingRight",`${o}px`)}}}function An(){return Kt()?{before({doc:e,d:t,meta:r}){function n(a){return r.containers.flatMap(o=>o()).some(o=>o.contains(a))}t.microTask(()=>{var a;if(window.getComputedStyle(e.documentElement).scrollBehavior!=="auto"){let u=re();u.style(e.documentElement,"scrollBehavior","auto"),t.add(()=>t.microTask(()=>u.dispose()))}let o=(a=window.scrollY)!=null?a:window.pageYOffset,c=null;t.addEventListener(e,"click",u=>{if(oe(u.target))try{let l=u.target.closest("a");if(!l)return;let{hash:d}=new URL(l.href),f=e.querySelector(d);oe(f)&&!n(f)&&(c=f)}catch{}},!0),t.addEventListener(e,"touchstart",u=>{if(oe(u.target)&&Gr(u.target))if(n(u.target)){let l=u.target;for(;l.parentElement&&n(l.parentElement);)l=l.parentElement;t.style(l,"overscrollBehavior","contain")}else t.style(u.target,"touchAction","none")}),t.addEventListener(e,"touchmove",u=>{if(oe(u.target)){if(Kr(u.target))return;if(n(u.target)){let l=u.target;for(;l.parentElement&&l.dataset.headlessuiPortal!==""&&!(l.scrollHeight>l.clientHeight||l.scrollWidth>l.clientWidth);)l=l.parentElement;l.dataset.headlessuiPortal===""&&u.preventDefault()}else u.preventDefault()}},{passive:!1}),t.add(()=>{var u;let l=(u=window.scrollY)!=null?u:window.pageYOffset;o!==l&&window.scrollTo(0,o),c&&c.isConnected&&(c.scrollIntoView({block:"nearest"}),c=null)})})}}:{}}function _n(){return{before({doc:e,d:t}){t.style(e.documentElement,"overflow","hidden")}}}function Ln(e){let t={};for(let r of e)Object.assign(t,r(t));return t}let me=On(()=>new Map,{PUSH(e,t){var r;let n=(r=this.get(e))!=null?r:{doc:e,count:0,d:re(),meta:new Set};return n.count++,n.meta.add(t),this.set(e,n),this},POP(e,t){let r=this.get(e);return r&&(r.count--,r.meta.delete(t)),this},SCROLL_PREVENT({doc:e,d:t,meta:r}){let n={doc:e,d:t,meta:Ln(r)},a=[An(),Pn(),_n()];a.forEach(({before:o})=>o==null?void 0:o(n)),a.forEach(({after:o})=>o==null?void 0:o(n))},SCROLL_ALLOW({d:e}){e.dispose()},TEARDOWN({doc:e}){this.delete(e)}});me.subscribe(()=>{let e=me.getSnapshot(),t=new Map;for(let[r]of e)t.set(r,r.documentElement.style.overflow);for(let r of e.values()){let n=t.get(r.doc)==="hidden",a=r.count!==0;(a&&!n||!a&&n)&&me.dispatch(r.count>0?"SCROLL_PREVENT":"SCROLL_ALLOW",r),r.count===0&&me.dispatch("TEARDOWN",r)}});function Rn(e,t,r=()=>({containers:[]})){let n=Fn(me),a=t?n.get(t):void 0,o=a?a.count>0:!1;return L(()=>{if(!(!t||!e))return me.dispatch("PUSH",t,r),()=>me.dispatch("POP",t,r)},[e,t]),o}function Tn(e,t,r=()=>[document.body]){let n=Ne(e,"scroll-lock");Rn(n,t,a=>{var o;return{containers:[...(o=a.containers)!=null?o:[],r]}})}function Mn(e=0){let[t,r]=i.useState(e),n=i.useCallback(l=>r(l),[t]),a=i.useCallback(l=>r(d=>d|l),[t]),o=i.useCallback(l=>(t&l)===l,[t]),c=i.useCallback(l=>r(d=>d&~l),[r]),u=i.useCallback(l=>r(d=>d^l),[r]);return{flags:t,setFlag:n,addFlag:a,hasFlag:o,removeFlag:c,toggleFlag:u}}var Dn={},$t,St;typeof process<"u"&&typeof globalThis<"u"&&typeof Element<"u"&&(($t=process==null?void 0:Dn)==null?void 0:$t.NODE_ENV)==="test"&&typeof((St=Element==null?void 0:Element.prototype)==null?void 0:St.getAnimations)>"u"&&(Element.prototype.getAnimations=function(){return console.warn(["Headless UI has polyfilled `Element.prototype.getAnimations` for your tests.","Please install a proper polyfill e.g. `jsdom-testing-mocks`, to silence these warnings.","","Example usage:","```js","import { mockAnimationsApi } from 'jsdom-testing-mocks'","mockAnimationsApi()","```"].join(`
`)),[]});var In=(e=>(e[e.None=0]="None",e[e.Closed=1]="Closed",e[e.Enter=2]="Enter",e[e.Leave=4]="Leave",e))(In||{});function Un(e){let t={};for(let r in e)e[r]===!0&&(t[`data-${r}`]="");return t}function Wn(e,t,r,n){let[a,o]=i.useState(r),{hasFlag:c,addFlag:u,removeFlag:l}=Mn(e&&a?3:0),d=i.useRef(!1),f=i.useRef(!1),g=ct();return L(()=>{var m;if(e){if(r&&o(!0),!t){r&&u(3);return}return(m=n==null?void 0:n.start)==null||m.call(n,r),Hn(t,{inFlight:d,prepare(){f.current?f.current=!1:f.current=d.current,d.current=!0,!f.current&&(r?(u(3),l(4)):(u(4),l(2)))},run(){f.current?r?(l(3),u(4)):(l(4),u(3)):r?l(1):u(1)},done(){var p;f.current&&typeof t.getAnimations=="function"&&t.getAnimations().length>0||(d.current=!1,l(7),r||o(!1),(p=n==null?void 0:n.end)==null||p.call(n,r))}})}},[e,r,t,g]),e?[a,{closed:c(1),enter:c(2),leave:c(4),transition:c(2)||c(4)}]:[r,{closed:void 0,enter:void 0,leave:void 0,transition:void 0}]}function Hn(e,{prepare:t,run:r,done:n,inFlight:a}){let o=re();return Vn(e,{prepare:t,inFlight:a}),o.nextFrame(()=>{r(),o.requestAnimationFrame(()=>{o.add(Bn(e,n))})}),o.dispose}function Bn(e,t){var r,n;let a=re();if(!e)return a.dispose;let o=!1;a.add(()=>{o=!0});let c=(n=(r=e.getAnimations)==null?void 0:r.call(e).filter(u=>u instanceof CSSTransition))!=null?n:[];return c.length===0?(t(),a.dispose):(Promise.allSettled(c.map(u=>u.finished)).then(()=>{o||t()}),a.dispose)}function Vn(e,{inFlight:t,prepare:r}){if(t!=null&&t.current){r();return}let n=e.style.transition;e.style.transition="none",r(),e.offsetHeight,e.style.transition=n}function ft(e,t){let r=i.useRef([]),n=F(e);i.useEffect(()=>{let a=[...r.current];for(let[o,c]of t.entries())if(r.current[o]!==c){let u=n(t,a);return r.current=t,u}},[n,...t])}let Ue=i.createContext(null);Ue.displayName="OpenClosedContext";var B=(e=>(e[e.Open=1]="Open",e[e.Closed=2]="Closed",e[e.Closing=4]="Closing",e[e.Opening=8]="Opening",e))(B||{});function We(){return i.useContext(Ue)}function Gn({value:e,children:t}){return y.createElement(Ue.Provider,{value:e},t)}function zn({children:e}){return y.createElement(Ue.Provider,{value:null},e)}function Kn(e){function t(){document.readyState!=="loading"&&(e(),document.removeEventListener("DOMContentLoaded",t))}typeof window<"u"&&typeof document<"u"&&(document.addEventListener("DOMContentLoaded",t),t())}let le=[];Kn(()=>{function e(t){if(!oe(t.target)||t.target===document.body||le[0]===t.target)return;let r=t.target;r=r.closest(Ae),le.unshift(r??t.target),le=le.filter(n=>n!=null&&n.isConnected),le.splice(10)}window.addEventListener("click",e,{capture:!0}),window.addEventListener("mousedown",e,{capture:!0}),window.addEventListener("focus",e,{capture:!0}),document.body.addEventListener("click",e,{capture:!0}),document.body.addEventListener("mousedown",e,{capture:!0}),document.body.addEventListener("focus",e,{capture:!0})});function Zt(e){let t=F(e),r=i.useRef(!1);i.useEffect(()=>(r.current=!1,()=>{r.current=!0,De(()=>{r.current&&t()})}),[t])}function qn(){let e=typeof document>"u";return(t=>t.useSyncExternalStore)(fr)(()=>()=>{},()=>!1,()=>!e)}function Ce(){let e=qn(),[t,r]=i.useState(q.isHandoffComplete);return t&&q.isHandoffComplete===!1&&r(!1),i.useEffect(()=>{t!==!0&&r(!0)},[t]),i.useEffect(()=>q.handoff(),[]),e?!1:t}let Xt=i.createContext(!1);function Yn(){return i.useContext(Xt)}function Ft(e){return y.createElement(Xt.Provider,{value:e.force},e.children)}function Zn(e){let t=Yn(),r=i.useContext(Qt),[n,a]=i.useState(()=>{var o;if(!t&&r!==null)return(o=r.current)!=null?o:null;if(q.isServer)return null;let c=e==null?void 0:e.getElementById("headlessui-portal-root");if(c)return c;if(e===null)return null;let u=e.createElement("div");return u.setAttribute("id","headlessui-portal-root"),e.body.appendChild(u)});return i.useEffect(()=>{n!==null&&(e!=null&&e.body.contains(n)||e==null||e.body.appendChild(n))},[n,e]),i.useEffect(()=>{t||r!==null&&a(r.current)},[r,a,t]),n}let Jt=i.Fragment,Xn=T(function(e,t){let{ownerDocument:r=null,...n}=e,a=i.useRef(null),o=Y(qr(p=>{a.current=p}),t),c=Ie(a),u=r??c,l=Zn(u),[d]=i.useState(()=>{var p;return q.isServer?null:(p=u==null?void 0:u.createElement("div"))!=null?p:null}),f=i.useContext(at),g=Ce();L(()=>{!l||!d||l.contains(d)||(d.setAttribute("data-headlessui-portal",""),l.appendChild(d))},[l,d]),L(()=>{if(d&&f)return f.register(d)},[f,d]),Zt(()=>{var p;!l||!d||(Tt(d)&&l.contains(d)&&l.removeChild(d),l.childNodes.length<=0&&((p=l.parentElement)==null||p.removeChild(l)))});let m=W();return g?!l||!d?null:mr.createPortal(m({ourProps:{ref:o},theirProps:n,slot:{},defaultTag:Jt,name:"Portal"}),d):null});function Jn(e,t){let r=Y(t),{enabled:n=!0,ownerDocument:a,...o}=e,c=W();return n?y.createElement(Xn,{...o,ownerDocument:a,ref:r}):c({ourProps:{ref:r},theirProps:o,slot:{},defaultTag:Jt,name:"Portal"})}let Qn=i.Fragment,Qt=i.createContext(null);function ea(e,t){let{target:r,...n}=e,a={ref:Y(t)},o=W();return y.createElement(Qt.Provider,{value:r},o({ourProps:a,theirProps:n,defaultTag:Qn,name:"Popover.Group"}))}let at=i.createContext(null);function ta(){let e=i.useContext(at),t=i.useRef([]),r=F(o=>(t.current.push(o),e&&e.register(o),()=>n(o))),n=F(o=>{let c=t.current.indexOf(o);c!==-1&&t.current.splice(c,1),e&&e.unregister(o)}),a=i.useMemo(()=>({register:r,unregister:n,portals:t}),[r,n,t]);return[t,i.useMemo(()=>function({children:o}){return y.createElement(at.Provider,{value:a},o)},[a])]}let ra=T(Jn),er=T(ea),na=Object.assign(ra,{Group:er});function aa(e,t=typeof document<"u"?document.defaultView:null,r){let n=Ne(e,"escape");Yt(t,"keydown",a=>{n&&(a.defaultPrevented||a.key===It.Escape&&r(a))})}function la(){var e;let[t]=i.useState(()=>typeof window<"u"&&typeof window.matchMedia=="function"?window.matchMedia("(pointer: coarse)"):null),[r,n]=i.useState((e=t==null?void 0:t.matches)!=null?e:!1);return L(()=>{if(!t)return;function a(o){n(o.matches)}return t.addEventListener("change",a),()=>t.removeEventListener("change",a)},[t]),r}function sa({defaultContainers:e=[],portals:t,mainTreeNode:r}={}){let n=Ie(r),a=F(()=>{var o,c;let u=[];for(let l of e)l!==null&&(ie(l)?u.push(l):"current"in l&&ie(l.current)&&u.push(l.current));if(t!=null&&t.current)for(let l of t.current)u.push(l);for(let l of(o=n==null?void 0:n.querySelectorAll("html > *, body > *"))!=null?o:[])l!==document.body&&l!==document.head&&ie(l)&&l.id!=="headlessui-portal-root"&&(r&&(l.contains(r)||l.contains((c=r==null?void 0:r.getRootNode())==null?void 0:c.host))||u.some(d=>l.contains(d))||u.push(l));return u});return{resolveContainers:a,contains:F(o=>a().some(c=>c.contains(o)))}}let tr=i.createContext(null);function Ot({children:e,node:t}){let[r,n]=i.useState(null),a=rr(t??r);return y.createElement(tr.Provider,{value:a},e,a===null&&y.createElement(tt,{features:Pe.Hidden,ref:o=>{var c,u;if(o){for(let l of(u=(c=Me(o))==null?void 0:c.querySelectorAll("html > *, body > *"))!=null?u:[])if(l!==document.body&&l!==document.head&&ie(l)&&l!=null&&l.contains(o)){n(l);break}}}}))}function rr(e=null){var t;return(t=i.useContext(tr))!=null?t:e}function mt(){let e=i.useRef(!1);return L(()=>(e.current=!0,()=>{e.current=!1}),[]),e}var we=(e=>(e[e.Forwards=0]="Forwards",e[e.Backwards=1]="Backwards",e))(we||{});function oa(){let e=i.useRef(0);return qt(!0,"keydown",t=>{t.key==="Tab"&&(e.current=t.shiftKey?1:0)},!0),e}function nr(e){if(!e)return new Set;if(typeof e=="function")return new Set(e());let t=new Set;for(let r of e.current)ie(r.current)&&t.add(r.current);return t}let ia="div";var fe=(e=>(e[e.None=0]="None",e[e.InitialFocus=1]="InitialFocus",e[e.TabLock=2]="TabLock",e[e.FocusLock=4]="FocusLock",e[e.RestoreFocus=8]="RestoreFocus",e[e.AutoFocus=16]="AutoFocus",e))(fe||{});function ua(e,t){let r=i.useRef(null),n=Y(r,t),{initialFocus:a,initialFocusFallback:o,containers:c,features:u=15,...l}=e;Ce()||(u=0);let d=Ie(r);ma(u,{ownerDocument:d});let f=pa(u,{ownerDocument:d,container:r,initialFocus:a,initialFocusFallback:o});ha(u,{ownerDocument:d,container:r,containers:c,previousActiveElement:f});let g=oa(),m=F(b=>{if(!pe(r.current))return;let w=r.current;(N=>N())(()=>{te(g.current,{[we.Forwards]:()=>{je(w,Q.First,{skipElements:[b.relatedTarget,o]})},[we.Backwards]:()=>{je(w,Q.Last,{skipElements:[b.relatedTarget,o]})}})})}),p=Ne(!!(u&2),"focus-trap#tab-lock"),h=ct(),x=i.useRef(!1),v={ref:n,onKeyDown(b){b.key=="Tab"&&(x.current=!0,h.requestAnimationFrame(()=>{x.current=!1}))},onBlur(b){if(!(u&4))return;let w=nr(c);pe(r.current)&&w.add(r.current);let N=b.relatedTarget;oe(N)&&N.dataset.headlessuiFocusGuard!=="true"&&(ar(w,N)||(x.current?je(r.current,te(g.current,{[we.Forwards]:()=>Q.Next,[we.Backwards]:()=>Q.Previous})|Q.WrapAround,{relativeTo:b.target}):oe(b.target)&&ee(b.target)))}},j=W();return y.createElement(y.Fragment,null,p&&y.createElement(tt,{as:"button",type:"button","data-headlessui-focus-guard":!0,onFocus:m,features:Pe.Focusable}),j({ourProps:v,theirProps:l,defaultTag:ia,name:"FocusTrap"}),p&&y.createElement(tt,{as:"button",type:"button","data-headlessui-focus-guard":!0,onFocus:m,features:Pe.Focusable}))}let ca=T(ua),da=Object.assign(ca,{features:fe});function fa(e=!0){let t=i.useRef(le.slice());return ft(([r],[n])=>{n===!0&&r===!1&&De(()=>{t.current.splice(0)}),n===!1&&r===!0&&(t.current=le.slice())},[e,le,t]),F(()=>{var r;return(r=t.current.find(n=>n!=null&&n.isConnected))!=null?r:null})}function ma(e,{ownerDocument:t}){let r=!!(e&8),n=fa(r);ft(()=>{r||(t==null?void 0:t.activeElement)===(t==null?void 0:t.body)&&ee(n())},[r]),Zt(()=>{r&&ee(n())})}function pa(e,{ownerDocument:t,container:r,initialFocus:n,initialFocusFallback:a}){let o=i.useRef(null),c=Ne(!!(e&1),"focus-trap#initial-focus"),u=mt();return ft(()=>{if(e===0)return;if(!c){a!=null&&a.current&&ee(a.current);return}let l=r.current;l&&De(()=>{if(!u.current)return;let d=t==null?void 0:t.activeElement;if(n!=null&&n.current){if((n==null?void 0:n.current)===d){o.current=d;return}}else if(l.contains(d)){o.current=d;return}if(n!=null&&n.current)ee(n.current);else{if(e&16){if(je(l,Q.First|Q.AutoFocus)!==nt.Error)return}else if(je(l,Q.First)!==nt.Error)return;if(a!=null&&a.current&&(ee(a.current),(t==null?void 0:t.activeElement)===a.current))return;console.warn("There are no focusable elements inside the <FocusTrap />")}o.current=t==null?void 0:t.activeElement})},[a,c,e]),o}function ha(e,{ownerDocument:t,container:r,containers:n,previousActiveElement:a}){let o=mt(),c=!!(e&4);Yt(t==null?void 0:t.defaultView,"focus",u=>{if(!c||!o.current)return;let l=nr(n);pe(r.current)&&l.add(r.current);let d=a.current;if(!d)return;let f=u.target;pe(f)?ar(l,f)?(a.current=f,ee(f)):(u.preventDefault(),u.stopPropagation(),ee(d)):ee(a.current)},!0)}function ar(e,t){for(let r of e)if(r.contains(t))return!0;return!1}function lr(e){var t;return!!(e.enter||e.enterFrom||e.enterTo||e.leave||e.leaveFrom||e.leaveTo)||((t=e.as)!=null?t:or)!==i.Fragment||y.Children.count(e.children)===1}let He=i.createContext(null);He.displayName="TransitionContext";var ga=(e=>(e.Visible="visible",e.Hidden="hidden",e))(ga||{});function va(){let e=i.useContext(He);if(e===null)throw new Error("A <Transition.Child /> is used but it is missing a parent <Transition /> or <Transition.Root />.");return e}function xa(){let e=i.useContext(Be);if(e===null)throw new Error("A <Transition.Child /> is used but it is missing a parent <Transition /> or <Transition.Root />.");return e}let Be=i.createContext(null);Be.displayName="NestingContext";function Ve(e){return"children"in e?Ve(e.children):e.current.filter(({el:t})=>t.current!==null).filter(({state:t})=>t==="visible").length>0}function sr(e,t){let r=he(e),n=i.useRef([]),a=mt(),o=ct(),c=F((p,h=se.Hidden)=>{let x=n.current.findIndex(({el:v})=>v===p);x!==-1&&(te(h,{[se.Unmount](){n.current.splice(x,1)},[se.Hidden](){n.current[x].state="hidden"}}),o.microTask(()=>{var v;!Ve(n)&&a.current&&((v=r.current)==null||v.call(r))}))}),u=F(p=>{let h=n.current.find(({el:x})=>x===p);return h?h.state!=="visible"&&(h.state="visible"):n.current.push({el:p,state:"visible"}),()=>c(p,se.Unmount)}),l=i.useRef([]),d=i.useRef(Promise.resolve()),f=i.useRef({enter:[],leave:[]}),g=F((p,h,x)=>{l.current.splice(0),t&&(t.chains.current[h]=t.chains.current[h].filter(([v])=>v!==p)),t==null||t.chains.current[h].push([p,new Promise(v=>{l.current.push(v)})]),t==null||t.chains.current[h].push([p,new Promise(v=>{Promise.all(f.current[h].map(([j,b])=>b)).then(()=>v())})]),h==="enter"?d.current=d.current.then(()=>t==null?void 0:t.wait.current).then(()=>x(h)):x(h)}),m=F((p,h,x)=>{Promise.all(f.current[h].splice(0).map(([v,j])=>j)).then(()=>{var v;(v=l.current.shift())==null||v()}).then(()=>x(h))});return i.useMemo(()=>({children:n,register:u,unregister:c,onStart:g,onStop:m,wait:d,chains:f}),[u,c,n,g,m,f,d])}let or=i.Fragment,ir=Oe.RenderStrategy;function ba(e,t){var r,n;let{transition:a=!0,beforeEnter:o,afterEnter:c,beforeLeave:u,afterLeave:l,enter:d,enterFrom:f,enterTo:g,entered:m,leave:p,leaveFrom:h,leaveTo:x,...v}=e,[j,b]=i.useState(null),w=i.useRef(null),N=lr(e),C=Y(...N?[w,t,b]:t===null?[]:[t]),O=(r=v.unmount)==null||r?se.Unmount:se.Hidden,{show:k,appear:M,initial:D}=va(),[$,A]=i.useState(k?"visible":"hidden"),V=xa(),{register:_,unregister:R}=V;L(()=>_(w),[_,w]),L(()=>{if(O===se.Hidden&&w.current){if(k&&$!=="visible"){A("visible");return}return te($,{hidden:()=>R(w),visible:()=>_(w)})}},[$,w,_,R,k,O]);let G=Ce();L(()=>{if(N&&G&&$==="visible"&&w.current===null)throw new Error("Did you forget to passthrough the `ref` to the actual DOM node?")},[w,$,G,N]);let ne=D&&!M,Z=M&&k&&D,z=i.useRef(!1),I=sr(()=>{z.current||(A("hidden"),R(w))},V),P=F(E=>{z.current=!0;let ae=E?"enter":"leave";I.onStart(w,ae,J=>{J==="enter"?o==null||o():J==="leave"&&(u==null||u())})}),H=F(E=>{let ae=E?"enter":"leave";z.current=!1,I.onStop(w,ae,J=>{J==="enter"?c==null||c():J==="leave"&&(l==null||l())}),ae==="leave"&&!Ve(I)&&(A("hidden"),R(w))});i.useEffect(()=>{N&&a||(P(k),H(k))},[k,N,a]);let X=!(!a||!N||!G||ne),[,S]=Wn(X,j,k,{start:P,end:H}),ue=de({ref:C,className:((n=et(v.className,Z&&d,Z&&f,S.enter&&d,S.enter&&S.closed&&f,S.enter&&!S.closed&&g,S.leave&&p,S.leave&&!S.closed&&h,S.leave&&S.closed&&x,!S.transition&&k&&m))==null?void 0:n.trim())||void 0,...Un(S)}),ce=0;$==="visible"&&(ce|=B.Open),$==="hidden"&&(ce|=B.Closed),k&&$==="hidden"&&(ce|=B.Opening),!k&&$==="visible"&&(ce|=B.Closing);let ze=W();return y.createElement(Be.Provider,{value:I},y.createElement(Gn,{value:ce},ze({ourProps:ue,theirProps:v,defaultTag:or,features:ir,visible:$==="visible",name:"Transition.Child"})))}function wa(e,t){let{show:r,appear:n=!1,unmount:a=!0,...o}=e,c=i.useRef(null),u=lr(e),l=Y(...u?[c,t]:t===null?[]:[t]);Ce();let d=We();if(r===void 0&&d!==null&&(r=(d&B.Open)===B.Open),r===void 0)throw new Error("A <Transition /> is used but it is missing a `show={true | false}` prop.");let[f,g]=i.useState(r?"visible":"hidden"),m=sr(()=>{r||g("hidden")}),[p,h]=i.useState(!0),x=i.useRef([r]);L(()=>{p!==!1&&x.current[x.current.length-1]!==r&&(x.current.push(r),h(!1))},[x,r]);let v=i.useMemo(()=>({show:r,appear:n,initial:p}),[r,n,p]);L(()=>{r?g("visible"):!Ve(m)&&c.current!==null&&g("hidden")},[r,m]);let j={unmount:a},b=F(()=>{var C;p&&h(!1),(C=e.beforeEnter)==null||C.call(e)}),w=F(()=>{var C;p&&h(!1),(C=e.beforeLeave)==null||C.call(e)}),N=W();return y.createElement(Be.Provider,{value:m},y.createElement(He.Provider,{value:v},N({ourProps:{...j,as:i.Fragment,children:y.createElement(ur,{ref:l,...j,...o,beforeEnter:b,beforeLeave:w})},theirProps:{},defaultTag:i.Fragment,features:ir,visible:f==="visible",name:"Transition"})))}function ya(e,t){let r=i.useContext(He)!==null,n=We()!==null;return y.createElement(y.Fragment,null,!r&&n?y.createElement(lt,{ref:t,...e}):y.createElement(ur,{ref:t,...e}))}let lt=T(wa),ur=T(ba),pt=T(ya),ja=Object.assign(lt,{Child:pt,Root:lt});var Ea=(e=>(e[e.Open=0]="Open",e[e.Closed=1]="Closed",e))(Ea||{}),Na=(e=>(e[e.SetTitleId=0]="SetTitleId",e))(Na||{});let Ca={0(e,t){return e.titleId===t.id?e:{...e,titleId:t.id}}},ht=i.createContext(null);ht.displayName="DialogContext";function Ge(e){let t=i.useContext(ht);if(t===null){let r=new Error(`<${e} /> is missing a parent <Dialog /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(r,Ge),r}return t}function ka(e,t){return te(t.type,Ca,e,t)}let Pt=T(function(e,t){let r=i.useId(),{id:n=`headlessui-dialog-${r}`,open:a,onClose:o,initialFocus:c,role:u="dialog",autoFocus:l=!0,__demoMode:d=!1,unmount:f=!1,...g}=e,m=i.useRef(!1);u=function(){return u==="dialog"||u==="alertdialog"?u:(m.current||(m.current=!0,console.warn(`Invalid role [${u}] passed to <Dialog />. Only \`dialog\` and and \`alertdialog\` are supported. Using \`dialog\` instead.`)),"dialog")}();let p=We();a===void 0&&p!==null&&(a=(p&B.Open)===B.Open);let h=i.useRef(null),x=Y(h,t),v=Ie(h),j=a?0:1,[b,w]=i.useReducer(ka,{titleId:null,descriptionId:null,panelRef:i.createRef()}),N=F(()=>o(!1)),C=F(S=>w({type:0,id:S})),O=Ce()?j===0:!1,[k,M]=ta(),D={get current(){var S;return(S=b.panelRef.current)!=null?S:h.current}},$=rr(),{resolveContainers:A}=sa({mainTreeNode:$,portals:k,defaultContainers:[D]}),V=p!==null?(p&B.Closing)===B.Closing:!1;gn(d||V?!1:O,{allowed:F(()=>{var S,ue;return[(ue=(S=h.current)==null?void 0:S.closest("[data-headlessui-portal]"))!=null?ue:null]}),disallowed:F(()=>{var S;return[(S=$==null?void 0:$.closest("body > *:not(#headlessui-portal-root)"))!=null?S:null]})});let _=Vt.get(null);L(()=>{if(O)return _.actions.push(n),()=>_.actions.pop(n)},[_,n,O]);let R=Gt(_,i.useCallback(S=>_.selectors.isTop(S,n),[_,n]));Sn(R,A,S=>{S.preventDefault(),N()}),aa(R,v==null?void 0:v.defaultView,S=>{S.preventDefault(),S.stopPropagation(),document.activeElement&&"blur"in document.activeElement&&typeof document.activeElement.blur=="function"&&document.activeElement.blur(),N()}),Tn(d||V?!1:O,v,A),vn(O,h,N);let[G,ne]=Yr(),Z=i.useMemo(()=>[{dialogState:j,close:N,setTitleId:C,unmount:f},b],[j,b,N,C,f]),z=i.useMemo(()=>({open:j===0}),[j]),I={ref:x,id:n,role:u,tabIndex:-1,"aria-modal":d?void 0:j===0?!0:void 0,"aria-labelledby":b.titleId,"aria-describedby":G,unmount:f},P=!la(),H=fe.None;O&&!d&&(H|=fe.RestoreFocus,H|=fe.TabLock,l&&(H|=fe.AutoFocus),P&&(H|=fe.InitialFocus));let X=W();return y.createElement(zn,null,y.createElement(Ft,{force:!0},y.createElement(na,null,y.createElement(ht.Provider,{value:Z},y.createElement(er,{target:h},y.createElement(Ft,{force:!1},y.createElement(ne,{slot:z},y.createElement(M,null,y.createElement(da,{initialFocus:c,initialFocusFallback:h,containers:A,features:H},y.createElement(tn,{value:N},X({ourProps:I,theirProps:g,slot:z,defaultTag:$a,features:Sa,visible:j===0,name:"Dialog"})))))))))))}),$a="div",Sa=Oe.RenderStrategy|Oe.Static;function Fa(e,t){let{transition:r=!1,open:n,...a}=e,o=We(),c=e.hasOwnProperty("open")||o!==null,u=e.hasOwnProperty("onClose");if(!c&&!u)throw new Error("You have to provide an `open` and an `onClose` prop to the `Dialog` component.");if(!c)throw new Error("You provided an `onClose` prop to the `Dialog`, but forgot an `open` prop.");if(!u)throw new Error("You provided an `open` prop to the `Dialog`, but forgot an `onClose` prop.");if(!o&&typeof e.open!="boolean")throw new Error(`You provided an \`open\` prop to the \`Dialog\`, but the value is not a boolean. Received: ${e.open}`);if(typeof e.onClose!="function")throw new Error(`You provided an \`onClose\` prop to the \`Dialog\`, but the value is not a function. Received: ${e.onClose}`);return(n!==void 0||r)&&!a.static?y.createElement(Ot,null,y.createElement(ja,{show:n,transition:r,unmount:a.unmount},y.createElement(Pt,{ref:t,...a}))):y.createElement(Ot,null,y.createElement(Pt,{ref:t,open:n,...a}))}let Oa="div";function Pa(e,t){let r=i.useId(),{id:n=`headlessui-dialog-panel-${r}`,transition:a=!1,...o}=e,[{dialogState:c,unmount:u},l]=Ge("Dialog.Panel"),d=Y(t,l.panelRef),f=i.useMemo(()=>({open:c===0}),[c]),g=F(v=>{v.stopPropagation()}),m={ref:d,id:n,onClick:g},p=a?pt:i.Fragment,h=a?{unmount:u}:{},x=W();return y.createElement(p,{...h},x({ourProps:m,theirProps:o,slot:f,defaultTag:Oa,name:"Dialog.Panel"}))}let Aa="div";function _a(e,t){let{transition:r=!1,...n}=e,[{dialogState:a,unmount:o}]=Ge("Dialog.Backdrop"),c=i.useMemo(()=>({open:a===0}),[a]),u={ref:t,"aria-hidden":!0},l=r?pt:i.Fragment,d=r?{unmount:o}:{},f=W();return y.createElement(l,{...d},f({ourProps:u,theirProps:n,slot:c,defaultTag:Aa,name:"Dialog.Backdrop"}))}let La="h2";function Ra(e,t){let r=i.useId(),{id:n=`headlessui-dialog-title-${r}`,...a}=e,[{dialogState:o,setTitleId:c}]=Ge("Dialog.Title"),u=Y(t);i.useEffect(()=>(c(n),()=>c(null)),[n,c]);let l=i.useMemo(()=>({open:o===0}),[o]),d={ref:u,id:n};return W()({ourProps:d,theirProps:a,slot:l,defaultTag:La,name:"Dialog.Title"})}let Ta=T(Fa),Ma=T(Pa);T(_a);let Da=T(Ra),Ia=Object.assign(Ta,{Panel:Ma,Title:Da,Description:Qr});const cr=({attachments:e,onClose:t})=>{const{t:r}=ve("chat",{keyPrefix:"header"});return s.jsxs(Ia,{open:!0,onClose:t,className:"fixed inset-0 z-50 flex items-center justify-center",children:[s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60","aria-hidden":"true"}),s.jsxs("div",{className:"bg-gray-900 rounded-lg shadow-lg max-w-2xl w-full p-4 z-50 overflow-y-auto max-h-[80vh]",children:[s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsx("h2",{className:"text-xl m-auto font-semibold text-white",children:r("buttons.attachments")}),s.jsx("button",{onClick:t,className:"text-white hover:text-red-400 cursor-pointer",children:s.jsx(ge,{className:"h-6 w-6"})})]}),e.length===0?s.jsx("p",{className:"text-gray-400",children:r("buttons.noAttachments")}):s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:e.map(n=>{var a;return s.jsxs("a",{href:n.url,target:"_blank",rel:"noopener noreferrer",className:"block bg-gray-800 rounded p-2 hover:bg-gray-700 transition",children:[(a=n.mime_type)!=null&&a.startsWith("image/")?s.jsx("img",{src:n.url,alt:"Attachment",className:"w-full h-32 object-cover rounded"}):s.jsx("div",{className:"text-white text-sm break-all",children:n.url.split("/").pop()}),s.jsx("div",{className:"text-gray-400 text-xs mt-1",children:new Date(n.created_at).toLocaleString()})]},n.id)})})]})]})};function Ua({participant:e,isSelf:t,isAdmin:r,menuOpen:n,setMenuOpen:a,setConfirmDialog:o,navigate:c,t:u}){var p;const{fetchProfile:l}=Le(),d=(p=l(e.profile_id))==null?void 0:p.data,f=i.useRef(null),[g,m]=i.useState(!1);return i.useEffect(()=>{n===e.profile_id&&f.current&&(f.current.getBoundingClientRect().bottom+140>window.innerHeight?m(!0):m(!1))},[n,e.profile_id]),s.jsxs("li",{className:"flex items-center justify-between py-2",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Qe,{avatar_url:d==null?void 0:d.avatar_url,gender:d==null?void 0:d.gender,className:"!w-8 !h-8"}),s.jsx("span",{className:"text-white font-medium",children:(d==null?void 0:d.username)||e.profile_id}),s.jsx("span",{className:`ml-2 px-2 py-0.5 rounded text-xs ${e.role==="admin"?"bg-sky-700 text-white":"bg-gray-700 text-gray-200"}`,children:u(`groupOverview.role.${e.role}`)})]}),!t&&r&&s.jsxs("div",{className:"relative",children:[s.jsx("button",{ref:f,className:"p-1 rounded-full cursor-pointer hover:bg-gray-800 text-gray-300",onClick:()=>a(n===e.profile_id?null:e.profile_id),"aria-label":u("groupOverview.menu.open"),children:n===e.profile_id?s.jsx(ge,{className:"h-6 w-6"}):s.jsx(Te,{className:"h-6 w-6"})}),n===e.profile_id&&s.jsx("div",{className:`absolute right-0 w-45 bg-gray-800 border border-gray-700 rounded shadow-lg z-10 ${g?"bottom-full mb-2":"mt-2"}`,children:s.jsxs("ul",{className:"py-1",children:[s.jsx("li",{children:s.jsx("button",{className:"w-full cursor-pointer text-left px-4 py-2 text-sm hover:bg-gray-700 text-white",onClick:()=>{c(`/profile/${e.profile_id}`),a(null)},children:u("groupOverview.actions.viewProfile")})}),e.role!=="admin"&&s.jsx("li",{children:s.jsx("button",{className:"w-full cursor-pointer text-left border-t border-gray-700 px-4 py-2 text-sm hover:bg-sky-700 text-white",onClick:()=>o({open:!0,action:"promote",participant:e}),children:u("groupOverview.actions.promote")})}),s.jsx("li",{children:s.jsx("button",{className:"w-full cursor-pointer text-left border-t border-gray-700 px-4 py-2 text-sm hover:bg-rose-700 text-white",onClick:()=>o({open:!0,action:"remove",participant:e}),children:u("groupOverview.actions.remove")})})]})})]})]},e.profile_id)}function Wa({conversation:e,onClose:t}){const{user:r}=Ee(),[n,a]=i.useState(null),{updateConversation:o}=ot(),{fetchParticipants:c,addParticipant:u,removeParticipant:l,updateParticipantRole:d}=_e(),{data:f=[]}=c(e.id),{searchProfiles:g}=Le(),{t:m}=ve("chat"),[p,h]=i.useState(!1),[x,v]=i.useState(e.title||""),[j,b]=i.useState(!1),[w,N]=i.useState(null),C=i.useRef(null),O=it(),[k,M]=i.useState({open:!1,action:null,participant:null}),[D,$]=i.useState(!1),[A,V]=i.useState(!1),[_,R]=i.useState(!1),{register:G,watch:ne}=pr(),Z=ne("searchTerm"),z=f.map(E=>E.profile_id)||[],{data:I,isLoading:P}=g(Z),H=(I==null?void 0:I.filter(E=>!z.includes(E.id)))||[],X=f.some(E=>E.profile_id===(r==null?void 0:r.id)&&E.role==="admin"),S=async E=>{if(!(!(E!=null&&E[0])||!e.id)&&!j){b(!0);try{const ae=E[0];N(URL.createObjectURL(E[0]));const J=await _t(ae,"chat-group-avatars",e.id,e.avatar_url??void 0,!0);J&&J!==e.avatar_url&&(await o({conversation:e,updates:{avatar_url:J}}),N(null))}finally{b(!1)}}},ue=async()=>{h(!1);const E=x.trim();E&&E!==e.title&&await o({conversation:e,updates:{title:E}})},ce=async()=>{k.participant&&(k.action==="promote"?await d({conversation_id:e.id,profile_id:k.participant.profile_id,role:"admin"}):k.action==="remove"&&await l({conversation_id:e.id,profile_id:k.participant.profile_id}),M({open:!1,action:null,participant:null}),a(null))},ze=async()=>{$(!1),!(!e||!(r!=null&&r.id))&&(await l({conversation_id:e.id,profile_id:r.id}),t())};return s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-gray-900 rounded-lg shadow-lg p-6 w-full max-w-md relative",children:[s.jsx("button",{onClick:t,className:"absolute cursor-pointer top-2 right-2 text-3xl text-white","aria-label":"Close group overview",children:s.jsx(ge,{className:"h-8 w-8"})}),s.jsx("div",{className:"flex justify-start mb-4",children:s.jsxs("button",{onClick:()=>$(!0),className:"text-rose-400 cursor-pointer hover:text-rose-700 transition text-sm font-semibold flex items-center gap-1",title:m("header.buttons.leaveGroup"),children:[s.jsx(Or,{className:"h-6 w-6"}),m("header.buttons.leaveGroup")]})}),s.jsx(Se,{isOpen:D,title:m("header.leave.title"),message:m("header.leave.groupMessage"),confirmLabel:m("header.leave.confirm"),cancelLabel:m("header.leave.cancel"),onConfirm:ze,onCancel:()=>$(!1),color:"error"}),s.jsxs("div",{className:"flex flex-col items-center gap-4 mb-6",children:[s.jsxs("div",{className:"relative",children:[s.jsx(Qe,{avatar_url:w||e.avatar_url||void 0,className:"w-20 h-20 bg-amber-600"}),X&&s.jsxs(s.Fragment,{children:[s.jsx("button",{ref:C,className:"absolute bottom-0 right-0 bg-black bg-opacity-50 p-2 rounded-full text-white hover:bg-opacity-80 transition",title:m("groupOverview.avatar.edit"),disabled:j,children:s.jsx(kr,{className:"w-5 h-5 cursor-pointer"})}),s.jsx(hr,{onFilesUpdate:S,amount:1,triggerRef:C})]})]}),s.jsxs("div",{className:"flex items-center gap-2 justify-between w-full",children:[p?s.jsx("input",{type:"text",value:x,onChange:E=>v(E.target.value),onBlur:ue,onKeyDown:E=>E.key==="Enter"&&ue(),autoFocus:!0,className:"bg-transparent border-b border-sky-500 text-lg font-semibold text-white focus:outline-none",disabled:!X}):s.jsxs(s.Fragment,{children:[s.jsx("h2",{className:"text-xl font-bold text-white",children:x||"Untitled Group"}),X&&s.jsx(wr,{onClick:()=>h(!0),className:"text-white w-5 h-5 cursor-pointer hover:text-sky-400 transition text-base",title:m("groupOverview.title.edit")})]}),s.jsxs("div",{className:"ml-auto relative flex items-center",children:[s.jsxs("button",{className:"p-1 w-[32px] h-[32px] rounded-full hover:bg-gray-800 cursor-pointer text-gray-300 relative",onClick:()=>V(E=>!E),"aria-label":m("header.menu.open"),children:[s.jsx("span",{className:`absolute inset-0 flex items-center justify-center transition-all duration-200 ease-in-out ${A?"opacity-0 scale-90":"opacity-100 scale-100"}`,children:s.jsx(Te,{className:"h-6 w-6"})}),s.jsx("span",{className:`absolute inset-0 flex items-center justify-center transition-all duration-200 ease-in-out ${A?"opacity-100 scale-100":"opacity-0 scale-90"}`,children:s.jsx(ge,{className:"h-6 w-6"})})]}),A&&s.jsx("div",{className:"absolute right-8 top-5 w-48 bg-gray-800 border border-gray-700 rounded shadow-lg z-10",children:s.jsx("ul",{className:"py-1",children:s.jsx("li",{children:s.jsx("button",{className:"w-full cursor-pointer text-left px-4 py-2 text-sm border-t border-gray-700 hover:bg-gray-700 text-white",onClick:()=>{R(!0),V(!1)},children:m("header.buttons.attachments")})})})})]})]}),X&&s.jsxs("div",{className:"w-full mt-2",children:[s.jsx("input",{type:"text",...G("searchTerm"),placeholder:m("header.search.placeholder"),className:"w-full p-2 rounded-md bg-neutral-800 text-white text-sm border border-neutral-600"}),P&&s.jsx("span",{className:"text-sm text-gray-400 mt-1 block",children:m("header.search.searching")}),s.jsxs("div",{className:"mt-2 flex flex-col gap-2",children:[H.map(E=>s.jsxs("div",{className:"flex items-center gap-2 bg-gray-800 rounded p-2",children:[s.jsx(Qe,{avatar_url:E.avatar_url,gender:E.gender,className:"!w-8 !h-8"}),s.jsx("span",{className:"text-white font-medium",children:E.username}),s.jsx("button",{className:"ml-auto px-2 py-1 bg-sky-700 text-white rounded hover:bg-sky-800 text-xs font-semibold",onClick:()=>u({conversation_id:e.id,profile_id:E.id,role:"member"}),children:m("header.search.toggle")})]},E.id)),!P&&Z&&H.length===0&&s.jsx("span",{className:"text-sm text-gray-500",children:m("header.search.noResults")})]})]})]}),s.jsxs("div",{children:[s.jsxs("h3",{className:"text-lg font-semibold text-white mb-2 flex items-center gap-2",children:[s.jsx(gr,{className:"h-6 w-6"})," ",m("groupOverview.participants")]}),s.jsx("ul",{className:"divide-y divide-gray-700",children:[...new Map(f.map(E=>[E.profile_id,E])).values()].map(E=>{const ae=(r==null?void 0:r.id)===E.profile_id;return s.jsx(Ua,{participant:E,isSelf:ae,isAdmin:X,menuOpen:n,setMenuOpen:a,setConfirmDialog:M,navigate:O,t:m},E.profile_id)})})]}),s.jsx(Se,{isOpen:k.open,title:k.action==="remove"?`${m("groupOverview.actions.remove")}?`:`${m("groupOverview.actions.promote")}?`,message:"",confirmLabel:m("groupOverview.actions.confirm"),cancelLabel:m("groupOverview.actions.cancel"),onConfirm:ce,onCancel:()=>M({open:!1,action:null,participant:null}),color:k.action==="remove"?"error":"primary"}),_&&(e==null?void 0:e.message_attachments)&&s.jsx(cr,{attachments:e.message_attachments,onClose:()=>R(!1)})]})})}const Ha=({conversationId:e})=>{var I;const{user:t}=Ee(),r=(t==null?void 0:t.id)??"",{t:n}=ve("chat"),{fetchConversation:a,fetchConversations:o,updateConversation:c,deleteConversation:u}=ot(),{data:l,isLoading:d,error:f}=a(e??""),{refetch:g}=o(r),{fetchParticipants:m,removeParticipant:p}=_e(),h=m(e??"").data;function x(P){return P&&typeof P=="object"&&Array.isArray(P.pages)}let v=[];Array.isArray(h)?v=h:x(h)?v=h.pages.flat():h?(console.error("participantsData unexpected shape",h),v=[]):v=[];const j=it(),b=v.find(P=>P.profile_id!==r),w=(l==null?void 0:l.is_group)??!1,[N,C]=i.useState(!1),[O,k]=i.useState(!1),[M,D]=i.useState(!1),[$,A]=i.useState(!1),[V,_]=i.useState(!1),{isConversationListVisible:R,toggleConversationList:G}=ut(),ne=v.find(P=>P.profile_id===r),Z=async()=>{try{if(C(!1),!l||!r)return;if(w){if(!ne){console.error("Current user participant info missing, can't remove");return}await p({conversation_id:l.id,profile_id:r,role:ne.role})}else await u(l);j("/chat"),g()}catch(P){console.error("Failed to leave conversation:",P.message)}};if(!e)return s.jsxs("div",{className:"flex items-center gap-4 px-4 py-2 border-b border-sky-600",children:[s.jsx("h2",{className:"text-lg font-semibold",children:n("header.noConversation.title")}),s.jsx("button",{onClick:G,className:"md:hidden text-white bg-sky-600 text-2xl mr-2 ml-auto rounded-md p-1 cursor-pointer","aria-label":R?"Hide conversation list":"Show conversation list",title:R?"Hide conversation list":"Show conversation list",children:s.jsx(gt,{className:"h-6 w-6"})})]});if(d)return s.jsx(vr,{});if(f)return s.jsx(st,{error:f.message});const z=async()=>{if(l)try{await c({conversation:l,updates:{avatar_url:"/public/group.png",is_group:!0,title:n("header.group.untitled")}})}catch(P){console.error("Failed to convert to group chat:",P.message)}finally{k(!1)}};return s.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-2 bg-gradient-to-l from-gray-900 px-4 py-2 border-b-2 border-sky-600",children:[s.jsxs("div",{className:"flex items-center gap-4 w-full relative",children:[l!=null&&l.avatar_url?s.jsx("div",{className:"relative",children:s.jsx("img",{src:l==null?void 0:l.avatar_url,alt:"Group Avatar",className:"w-10 h-10 bg-amber-600 rounded-full object-cover"})}):s.jsx("div",{className:"w-10 h-10 rounded-full bg-neutral-600 flex items-center justify-center text-white text-sm",children:((I=l==null?void 0:l.title)==null?void 0:I.charAt(0).toUpperCase())??"?"}),s.jsx("h2",{className:"text-lg font-semibold text-white",children:(l==null?void 0:l.title)??n("header.group.untitled")}),w&&s.jsxs("button",{onClick:()=>D(!0),className:"ml-auto px-2 py-1 cursor-pointer bg-sky-700 text-white rounded hover:bg-sky-800 transition text-xs font-semibold items-center gap-1 hidden md:flex",title:n("header.group.info"),children:[s.jsx(vt,{className:"h-6 w-6 inline-block text-base text-gray-300"}),n("header.group.info")]}),!w&&s.jsxs("div",{className:"ml-auto relative flex items-center",children:[s.jsxs("button",{className:"p-1 w-[32px] h-[32px] rounded-full hover:bg-gray-800 cursor-pointer text-gray-300 relative",onClick:()=>A(P=>!P),"aria-label":n("header.menu.open"),children:[s.jsx("span",{className:`absolute inset-0 flex items-center justify-center transition-all duration-200 ease-in-out ${$?"opacity-0 scale-90":"opacity-100 scale-100"}`,children:s.jsx(Te,{className:"h-6 w-6"})}),s.jsx("span",{className:`absolute inset-0 flex items-center justify-center transition-all duration-200 ease-in-out ${$?"opacity-100 scale-100":"opacity-0 scale-90"}`,children:s.jsx(ge,{className:"h-6 w-6"})})]}),$&&s.jsx("div",{className:"absolute right-8 top-5 w-48 bg-gray-800 border border-gray-700 rounded shadow-lg z-10",children:s.jsxs("ul",{className:"py-1",children:[s.jsx("li",{children:s.jsx("button",{className:"w-full cursor-pointer text-left px-4 py-2 text-sm hover:bg-gray-700 text-white",onClick:()=>{b!=null&&b.profile_id&&j(`/profile/${b.profile_id}`),A(!1)},children:n("groupOverview.actions.viewProfile")})}),s.jsx("li",{children:s.jsx("button",{className:"w-full cursor-pointer text-left px-4 py-2 text-sm border-t border-gray-700 hover:bg-gray-700 text-white",onClick:()=>{k(!0),A(!1)},children:n("header.buttons.convertToGroup")})}),s.jsx("li",{children:s.jsx("button",{className:"w-full cursor-pointer text-left px-4 py-2 text-sm border-t border-gray-700 hover:bg-gray-700 text-white",onClick:()=>{_(!0),A(!1)},children:n("header.buttons.attachments")})}),s.jsx("li",{children:s.jsx("button",{className:"w-full cursor-pointer text-left px-4 py-2 text-sm border-t border-gray-700 hover:bg-rose-700 text-white",onClick:()=>{C(!0),A(!1)},children:n("header.buttons.leaveConversation")})})]})})]}),!w&&s.jsx(Se,{isOpen:N,title:n("header.leave.title"),message:n("header.leave.directMessage"),confirmLabel:n("header.leave.confirm"),cancelLabel:n("header.leave.cancel"),onConfirm:Z,onCancel:()=>C(!1),color:"error"}),s.jsx(Se,{isOpen:O,title:n("header.convert.title"),message:n("header.convert.message"),confirmLabel:n("header.convert.confirm"),cancelLabel:n("header.convert.cancel"),onConfirm:z,onCancel:()=>k(!1),className:"!bg-emerald-600 hover:!bg-emerald-700"}),s.jsx("button",{onClick:G,className:"md:hidden text-white bg-sky-600 text-2xl mr-2 ml-auto rounded-md p-1","aria-label":n(R?"header.buttons.hideList":"header.buttons.showList"),title:n(R?"header.buttons.hideList":"header.buttons.showList"),children:s.jsx(gt,{className:"h-6 w-6"})})]}),w&&s.jsxs("button",{onClick:()=>D(!0),className:"mt-2 mr-auto px-2 py-1 bg-sky-700 text-white rounded hover:bg-sky-800 transition text-xs font-semibold flex items-center gap-1 md:hidden",title:n("header.group.info"),children:[s.jsx(vt,{className:"h-6 w-6 inline-block text-base text-gray-300"}),n("header.group.info")]}),M&&l&&s.jsx(Wa,{conversation:l,onClose:()=>D(!1)}),V&&(l==null?void 0:l.message_attachments)&&s.jsx(cr,{attachments:l.message_attachments,onClose:()=>_(!1)})]})},Ba=e=>{const t=["bg-emerald-600","bg-yellow-700","bg-purple-700","bg-green-800","bg-red-800","bg-pink-800","bg-indigo-500","bg-blue-800","bg-orange-700","bg-teal-600","bg-fuchsia-800","bg-cyan-700","bg-lime-700","bg-rose-800","bg-violet-600"];let r=0;for(let a=0;a<e.length;a++)r=e.charCodeAt(a)+((r<<5)-r);const n=Math.abs(r)%t.length;return t[n]},Va=({message:e,isMine:t})=>{var O,k,M,D;const{t:r}=ve("chat"),{deleteMessage:n,updateMessage:a}=Re(),{fetchProfile:o}=Le(),{data:c,isLoading:u}=o(e.sender_profile_id),l=Array.isArray(e.delivered_to)&&e.delivered_to.length>0,d=Array.isArray(e.read_by)&&e.read_by.length>0,f=t?"bg-sky-700 text-white":`${Ba(e.sender_profile_id)} text-white`,[g,m]=i.useState(!1),[p,h]=i.useState(e.content),[x,v]=i.useState(!1),j=i.useRef(null),b=()=>{m(!0),v(!1)},w=()=>{p.trim()&&p!==e.content&&a({id:e.id,conversation_id:e.conversation_id,updatedFields:{content:p,updated_at:new Date().toISOString()}}),m(!1)},N=()=>{h(e.content),m(!1)},C=()=>{var $;xr("message-attachments",(($=e.attachment)==null?void 0:$.url)||""),n({id:e.id,conversation_id:e.conversation_id}),v(!1)};return s.jsxs("div",{className:`flex ${t?"justify-end":"justify-start"} space-x-2`,children:[!t&&s.jsxs("div",{className:"flex flex-col items-start max-w-xs",children:[s.jsx("span",{className:"text-xs font-medium text-sky-300 mb-1",children:u?s.jsx(Fe,{width:80,height:12,baseColor:"#a1a1aa",highlightColor:"#e4e4e7"}):`${(c==null?void 0:c.firstname)||"Unknown"} ${(c==null?void 0:c.lastname)||""}`.trim()}),u?s.jsx(Fe,{height:32,width:200,baseColor:"#a1a1aa",highlightColor:"#e4e4e7"}):s.jsx("div",{className:`${f} p-2 rounded-lg min-w-[80px] text-center`,children:e.attachment?s.jsxs(s.Fragment,{children:[((O=e.attachment.mime_type)==null?void 0:O.startsWith("image/"))&&s.jsx("img",{src:e.attachment.url,alt:"attachment",className:"max-w-full max-h-60 rounded"}),((k=e.attachment.mime_type)==null?void 0:k.startsWith("audio/"))&&s.jsxs("audio",{controls:!0,className:"w-75",children:[s.jsx("source",{src:e.attachment.url,type:e.attachment.mime_type}),r("message.audioNotSupported")]}),e.content&&e.content]}):e.content})]}),t&&s.jsxs("div",{className:"flex flex-col items-end max-w-xs relative",children:[s.jsx("div",{className:"absolute top-2 z-20",children:s.jsxs("button",{className:"w-6 h-6 cursor-pointer text-gray-100 relative",onClick:()=>v($=>!$),"aria-label":r("header.menu.open"),children:[s.jsx("span",{className:`absolute inset-0 flex items-center justify-center transition ${x?"opacity-0 scale-90":"opacity-100 scale-100"}`,children:s.jsx(Te,{})}),s.jsx("span",{className:`absolute inset-0 flex items-center justify-center transition ${x?"opacity-100 scale-100":"opacity-0 scale-90"}`,children:s.jsx(ge,{})})]})}),s.jsxs("div",{className:`${f} p-1 pr-6 rounded-lg min-w-[80px] flex flex-col gap-1`,children:[g?s.jsx("input",{type:"text",value:p,onChange:$=>h($.target.value),onBlur:w,onKeyDown:$=>{$.key==="Enter"&&w(),$.key==="Escape"&&N()},placeholder:r("message.edit.placeholder"),autoFocus:!0,className:"bg-sky-900 text-white border-b border-sky-400 focus:outline-none w-full px-1 rounded"}):s.jsxs(s.Fragment,{children:[e.attachment?s.jsxs(s.Fragment,{children:[((M=e.attachment.mime_type)==null?void 0:M.startsWith("image/"))&&s.jsx("img",{src:e.attachment.url,alt:"attachment",className:"max-w-full max-h-60 rounded"}),((D=e.attachment.mime_type)==null?void 0:D.startsWith("audio/"))&&s.jsxs("audio",{controls:!0,className:"w-75",children:[s.jsx("source",{src:e.attachment.url,type:e.attachment.mime_type}),r("message.audioNotSupported")]}),e.content&&s.jsx("span",{className:"mr-2",children:e.content})]}):s.jsx("span",{className:"mr-2",children:e.content}),s.jsx("span",{className:"flex items-center text-xs",children:d?s.jsx(yr,{className:"text-green-200 w-4",title:"Read"}):l?s.jsx(jr,{className:"text-blue-200 w-4",title:"Delivered"}):null})]}),x&&s.jsxs("div",{ref:j,className:"absolute z-30 right-0 top-10 bg-gray-900 border border-sky-700 rounded shadow-lg py-1 w-37 flex flex-col",children:[s.jsx("button",{className:"cursor-pointer px-4 py-2 text-left hover:bg-gray-800 text-sm text-rose-400",onClick:C,children:r("message.delete.title")}),s.jsx("div",{className:"border-t border-sky-700"}),s.jsx("button",{className:"cursor-pointer px-4 py-2 text-left hover:bg-gray-800 text-sm text-yellow-500",onClick:b,children:r("message.edit.title")})]})]})]})]})},Ga=({messages:e,profileId:t})=>{const r=Array.isArray(e)?e.filter(Boolean):[],n=i.useRef(null);return i.useEffect(()=>{const a=n.current;a&&(a.scrollTop=a.scrollHeight)},[r.length]),s.jsx("div",{ref:n,className:"space-y-4 overflow-y-auto h-full px-2",children:r.map(a=>{const o=a.sender_profile_id===t;return s.jsx(Va,{message:a,isMine:o},a.id||a.tempId||Math.random())})})},za=({conversationId:e,senderId:t})=>{const{t:r}=ve("chat"),[n,a]=i.useState(""),{insertMessage:o}=Re(),{insertMessageAttachment:c}=br(),{fetchParticipants:u}=_e(),{data:l=[]}=u(e),d=i.useRef(null),[f,g]=i.useState(!1),m=async v=>{if(v.preventDefault(),!n.trim())return;const j=(l==null?void 0:l.map(b=>b.profile_id).filter(b=>b!==t))??[];await o({content:n,sender_profile_id:t,conversation_id:e,delivered_to:j}),a("")},p=v=>{v.key==="Enter"&&!v.shiftKey&&(v.preventDefault(),m(v))},h=()=>{var v;(v=d.current)==null||v.click()},x=async v=>{if(!v.target.files||v.target.files.length===0)return;const j=v.target.files[0];g(!0);try{const b=await _t(j,"message-attachments",e);if(!b){alert(r("uploadFailed")),g(!1);return}const w=await c({conversation_id:e,profile_id:t,url:b,mime_type:j.type}),N=(l==null?void 0:l.map(C=>C.profile_id).filter(C=>C!==t))??[];await o({content:"",sender_profile_id:t,conversation_id:e,delivered_to:N,attachment_id:w.id}),a("")}catch(b){console.error("Upload or insert failed:",b),alert(r("uploadFailed"))}finally{g(!1),d.current&&(d.current.value="")}};return s.jsxs("form",{onSubmit:m,className:"flex items-center space-x-2",children:[s.jsx("textarea",{rows:1,value:n,maxLength:3e3,onChange:v=>a(v.target.value),onKeyDown:p,placeholder:r("input.placeholder"),className:"flex-1 resize-none rounded-lg border border-neutral-700 bg-neutral-950 text-white p-2 outline-none focus:ring-1 focus:ring-neutral-500",disabled:f}),s.jsx("button",{type:"button",onClick:h,title:r("input.attachFile"),disabled:f,className:"text-white hover:text-sky-400 transition text-xl p-2",children:s.jsx(Er,{})}),s.jsx("input",{type:"file",ref:d,onChange:x,className:"hidden",accept:"image/jpeg,image/png,image/gif,image/webp,image/svg+xml,audio/mpeg,audio/wav,audio/ogg,audio/webm,audio/aac,audio/flac,audio/mp4,audio/x-wav,audio/x-m4a"}),s.jsx("button",{type:"submit",className:"bg-sky-600 text-white font-semibold px-4 py-2 rounded-lg hover:bg-sky-700 transition",disabled:f,children:r(f?"input.uploading":"input.button")})]})},Ka=()=>{const{conversationId:e}=At(),{user:t}=Ee(),r=!!e&&!!(t!=null&&t.id),{fetchMessages:n,markMessagesAsRead:a,unreadMessages:o,messagesRealtime:c}=Re();c(e??"");const{data:u=[]}=n(e??""),{data:l=[]}=o({conversationId:e??"",profileId:(t==null?void 0:t.id)??""});i.useEffect(()=>{if(r&&l&&l.length>0&&a){const f=l.map(g=>g.id);a({messageIds:f,profileId:t.id,conversationId:e})}},[r,l,a,t==null?void 0:t.id,e]);const d=Array.isArray(u)?u.filter(f=>f&&f.sender_profile_id):[];return s.jsxs("div",{className:"flex flex-col h-full",children:[s.jsx(Ha,{conversationId:e}),s.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:s.jsx(Ga,{messages:r?d:[],profileId:(t==null?void 0:t.id)??""})}),s.jsx("div",{className:"p-4",children:e&&(t==null?void 0:t.id)&&s.jsx(za,{conversationId:e,senderId:t.id})})]})},il=()=>{const{isConversationListVisible:e,setIsConversationListVisible:t}=ut(),r=()=>{t(!1)};return s.jsxs("div",{className:"flex h-screen relative",children:[s.jsx("div",{className:`fixed md:static top-0 left-0 h-full bg-gray-900 z-50 transition-transform duration-300 ease-in-out
          ${e?"translate-x-0 w-3/5":"-translate-x-full"} md:translate-x-0 md:w-1/4`,children:s.jsx(_r,{onSelectConversation:r})}),s.jsx("div",{className:"flex-1 md:w-3/4 w-full h-full overflow-hidden",children:s.jsx(Ka,{})})]})};export{il as default};
