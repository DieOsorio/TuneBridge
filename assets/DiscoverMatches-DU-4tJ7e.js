import{j as e,P as A}from"./mui-O-_7DbpJ.js";import{r}from"./calendar-BpW-aEGs.js";import{u as B,a as h,x as R,y as $,z,h as D,L as E,P as q,b as H,i as F}from"./index-Cf-eeQSk.js";import{b as O,w as g,x as f,y as U,z as G,C as J,D as K}from"./icons-D__VgVoR.js";import{L as Q}from"./LoadingBadge-C9Y5ZXYF.js";import{u as V,h as W}from"./useCanSendDM-B09CymKG.js";import"./reactPlayer-D7fnNHFf.js";import"./lottie-DTlWc_fK.js";import"./gsap-Brfk6Bdo.js";import"./filepond-DcLflJls.js";function b({profile:t,loading:x}){const{t:a}=B("profile"),{user:n}=h(),{addConnection:c,deleteConnection:l,updateConnection:d,userConnections:j}=R(),{findConversation:v,createConversation:_}=$(),{addParticipant:C}=z(),[o,Y]=r.useState(null),[y,w]=r.useState(!1),{canSend:N,loading:P}=V(t.profile_id),S=D(),{data:p}=j(t.profile_id),i=p==null?void 0:p.find(m=>m.follower_profile_id===n.id&&m.following_profile_id===t.profile_id||m.follower_profile_id===t.profile_id&&m.following_profile_id===n.id),s=(i==null?void 0:i.status)??"connect",k=async()=>{s==="connect"?await c({follower_profile_id:n.id,following_profile_id:t.profile_id,status:"pending"}):s==="pending"||s==="accepted"?await l(i):s==="blocked"&&await d({connection:i,updatedConnection:{status:"accepted"}})},I=()=>{y||W({myProfileId:n.id,otherProfile:{id:t.profile_id,username:t.username,avatar_url:t.avatar_url},findConversation:v,createConversation:_,addParticipant:C,navigate:S,setLoading:w})},u=Math.round(t.match_score*100);if(!t||x||P)return e.jsx(Q,{color:"amber",label:"Buscando mÃºsicos compatibles..."});const L=u>=70?"bg-amber-800 text-white":u>=40?"bg-sky-700 text-white":u>=10?"bg-gray-300 text-gray-900":"bg-gray-800 text-gray-100",M=()=>s==="pending"?a("connection.cancelRequest"):s==="accepted"?a("connection.disconnect"):s==="blocked"?a("connection.unblock"):null,T={connect:e.jsx(J,{}),pending:e.jsx(G,{}),accepted:e.jsx(f,{}),blocked:e.jsx(U,{})}[s];return e.jsxs("div",{className:`
      max-w-100 w-full mx-auto border border-gray-400 rounded-xl p-4 
      shadow-sm bg-gray-950 
      hover:shadow-md 
      transition-all duration-150 ease-in-out 
      will-change-transform
    `,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(E,{to:`/profile/${t.profile_id}`,children:e.jsx(q,{avatar_url:t.avatar_url,alt:t.username,className:"!w-13 !h-13"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-100",children:t.name||t.display_name||t.username}),e.jsxs("div",{className:"text-sm text-gray-400",children:["@",t.username]})]})]}),e.jsxs("div",{className:`absolute inline-flex items-center gap-2 cursor-help select-none px-3 py-1 rounded-full text-sm font-semibold ${L}`,title:a("matchScore.cardTitle"),children:[e.jsx(O,{className:"text-amber-500 text-lg"}),e.jsxs("span",{children:["Match: ",u,"%"]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2 text-sm",children:[N&&e.jsx("button",{onClick:I,className:"absolute top-4 right-4 text-amber-700 cursor-pointer hover:text-amber-800 transition",children:e.jsx(K,{size:30})}),e.jsx("button",{onClick:k,title:M()||"",className:"flex cursor-pointer items-center min-w-35 justify-center gap-1 px-3 py-1 rounded bg-gray-700 text-white hover:bg-gray-800 transition text-sm",children:e.jsxs("span",{className:"truncate flex items-center gap-1",children:[o&&s==="accepted"&&e.jsx(g,{}),o&&s==="pending"&&e.jsx(g,{}),o&&s==="blocked"&&e.jsx(f,{}),!o&&T,e.jsx("span",{children:o||a(`connection.${s}`)})]})})]})]})}b.propTypes={profile:A.object.isRequired};const X=r.memo(b);function le(){const{user:t}=h(),{matchAll:x}=H(),[a,n]=r.useState([]),[c,l]=r.useState(!0);return r.useEffect(()=>{l(!0),x({profileId:t.id,limit:9}).then(n).catch(console.error).finally(()=>l(!1))},[t==null?void 0:t.id]),!a.length||c?e.jsx(F,{}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:a.map(d=>e.jsx(X,{profile:d,loading:c},d.profile_id))})}export{le as default};
