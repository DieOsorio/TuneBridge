import{j as e}from"./mui-B-xP7mtj.js";import{r as c}from"./filepond-C4Y8_Bzv.js";import{a as z,t as Q,b as G,A as W,u as H,r as ee,v as oe,d as te,B as se,e as de}from"./index-CRsfiaS_.js";import{E as ae}from"./ErrorMessage-B2u091H8.js";import{S as F}from"./index-cpdcplt_.js";/* empty css                 */import{u as ce}from"./index.esm-B1e87uze.js";import{H as pe,E as ge,G as ve,J as be,K as le,L as ne,N as je,O as ye,P as we,Q as Ne}from"./icons-r1d5ly4y.js";import{C as J}from"./ConfirmDialog-DxIiB_6a.js";import{I as Ce}from"./ImageUploader-Cu2Tp4EI.js";import{P as Z}from"./ProfileAvatar-c1RuMNn7.js";import{u as _e}from"./avatarUtils-DV1apmFs.js";import"./reactPlayer-xbeEqQf7.js";import"./lottie-Qij33HW6.js";function ke({isSelected:t=!1}){return e.jsxs("div",{className:`flex items-center gap-3 px-4 py-2 ${t?"bg-sky-700":"bg-transparent"}`,children:[e.jsx(F,{circle:!0,width:40,height:40}),e.jsxs("div",{className:"flex flex-col grow",children:[e.jsx(F,{height:14,width:"55%"}),e.jsx(F,{height:12,width:"80%",style:{marginTop:4}})]})]})}const Le=({conversation:t,isSelected:i,onClick:s})=>{const{user:l}=z(),{fetchParticipants:x}=Q(),{data:m=[],isLoading:d,error:a}=x(t.id),{fetchProfile:f}=G(),u=m==null?void 0:m.find(O=>O.profile_id!==l.id),{data:n,isLoading:p,error:r}=f(u==null?void 0:u.profile_id),{unreadMessages:g}=W(),{data:h,isLoading:j}=g({conversationId:t.id,profileId:l.id});if(d||p)return e.jsx(ke,{isSelected:i});if(a||r)return e.jsx(ae,{error:(a==null?void 0:a.message)||(r==null?void 0:r.message)});const N=t.is_group?t.avatar_url:n==null?void 0:n.avatar_url,b=t.is_group?t.title:n==null?void 0:n.username;return e.jsxs("div",{onClick:()=>s(t.id),className:`flex items-center gap-3 px-4 py-2 cursor-pointer transition-colors ${i?"bg-sky-700":"hover:bg-sky-950 hover:text-white"}`,children:[e.jsxs("div",{className:"relative",children:[N?e.jsx("img",{src:N,alt:"Avatar",className:"w-10 h-10 rounded-full object-cover"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-neutral-600 flex items-center justify-center text-white text-sm",children:(b==null?void 0:b.charAt(0).toUpperCase())||"?"}),!j&&(h==null?void 0:h.length)>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full px-1.5",children:h.length})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:`font-medium truncate ${i&&"text-white"}`,children:b||"Untitled"}),t.last_message&&e.jsx("span",{className:"text-sm text-neutral-400 truncate max-w-[180px]",children:t.last_message})]})]})},Se=()=>{const{t}=H("chat"),{user:i}=z(),{fetchConversations:s}=ee(),{data:l,isLoading:x,error:m}=s(i.id),{conversationId:d}=oe(),a=te(),[f,u]=c.useState(d),{setIsConversationListVisible:n}=se();c.useEffect(()=>{!d&&l&&l.length>0?u(l[0].id):u(d)},[d,l]);const p=r=>{u(r),a(`/chat/${r}`),n(!1)};return x?e.jsx(de,{size:200}):m?e.jsx(ae,{error:m.message}):e.jsx("div",{className:"w-full overflow-y-auto h-full bg-gradient-to-l from-gray-900 border-r-2 border-sky-700",children:l!=null&&l.length?l.map(r=>e.jsx(Le,{conversation:r,isSelected:f===r.id,onClick:p},r.id)):e.jsx("p",{className:"text-gray-400 p-4",children:t("list")})})};function Oe({participant:t,isSelf:i,isAdmin:s,menuOpen:l,setMenuOpen:x,setConfirmDialog:m,navigate:d,t:a}){var g;const{fetchProfile:f}=G(),u=(g=f(t.profile_id))==null?void 0:g.data,n=c.useRef(),[p,r]=c.useState(!1);return c.useEffect(()=>{l===t.profile_id&&n.current&&(n.current.getBoundingClientRect().bottom+140>window.innerHeight?r(!0):r(!1))},[l,t.profile_id]),e.jsxs("li",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{avatar_url:u==null?void 0:u.avatar_url,gender:u==null?void 0:u.gender,className:"!w-8 !h-8"}),e.jsx("span",{className:"text-white font-medium",children:(u==null?void 0:u.username)||t.profile_id}),e.jsx("span",{className:`ml-2 px-2 py-0.5 rounded text-xs ${t.role==="admin"?"bg-sky-700 text-white":"bg-gray-700 text-gray-200"}`,children:a(`groupOverview.role.${t.role}`)})]}),!i&&s&&e.jsxs("div",{className:"relative",children:[e.jsx("button",{ref:n,className:"p-1 rounded-full cursor-pointer hover:bg-gray-800 text-gray-300",onClick:()=>x(l===t.profile_id?null:t.profile_id),"aria-label":a("groupOverview.menu.open"),children:e.jsxs("svg",{width:"20",height:"20",fill:"currentColor",viewBox:"0 0 20 20",children:[e.jsx("circle",{cx:"4",cy:"10",r:"2"}),e.jsx("circle",{cx:"10",cy:"10",r:"2"}),e.jsx("circle",{cx:"16",cy:"10",r:"2"})]})}),l===t.profile_id&&e.jsx("div",{className:`absolute right-0 w-45 bg-gray-800 border border-gray-700 rounded shadow-lg z-10 ${p?"bottom-full mb-2":"mt-2"}`,children:e.jsxs("ul",{className:"py-1",children:[e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-4 py-2 text-sm hover:bg-gray-700 text-white",onClick:()=>{d(`/profile/${t.profile_id}`),x(null)},children:a("groupOverview.actions.viewProfile")})}),t.role!=="admin"&&e.jsx("li",{children:e.jsx("button",{className:"w-full text-left border-t border-gray-700 px-4 py-2 text-sm hover:bg-sky-700 text-white",onClick:()=>m({open:!0,action:"promote",participant:t}),children:a("groupOverview.actions.promote")})}),e.jsx("li",{children:e.jsx("button",{className:"w-full text-left border-t border-gray-700 px-4 py-2 text-sm hover:bg-red-700 text-white",onClick:()=>m({open:!0,action:"remove",participant:t}),children:a("groupOverview.actions.remove")})})]})})]})]},t.profile_id)}function Ie({conversation:t,onClose:i}){const{user:s}=z(),[l,x]=c.useState(null),{updateConversation:m}=ee(),{fetchParticipants:d,addParticipant:a,removeParticipant:f,updateParticipantRole:u}=Q(),{data:n=[]}=d(t.id),{searchProfiles:p}=G(),{t:r}=H("chat"),[g,h]=c.useState(!1),[j,N]=c.useState(t.title||""),[b,O]=c.useState(!1),[U,T]=c.useState(null),R=c.useRef(),y=te(),[w,D]=c.useState({open:!1,action:null,participant:null}),[re,P]=c.useState(!1),{register:$,watch:q}=ce(),M=q("searchTerm"),X=n.map(o=>o.profile_id)||[],{data:I,isLoading:B}=p(M),E=(I==null?void 0:I.filter(o=>!X.includes(o.id)))||[],C=n.some(o=>o.profile_id===s.id&&o.role==="admin"),V=async o=>{if(!(!(o!=null&&o[0])||!t.id)&&!b){O(!0);try{T(URL.createObjectURL(o[0]));const A=await _e(o[0],"chat-group-avatars",t.id,t.avatar_url,!0);A&&A!==t.avatar_url&&(await m({conversation:t,updates:{avatar_url:A}}),T(null))}finally{O(!1)}}},_=async()=>{h(!1);const o=j.trim();o&&o!==t.title&&await m({conversation:t,updates:{title:o}})},k=async()=>{w.participant&&(w.action==="promote"?await u({conversation_id:t.id,profile_id:w.participant.profile_id,role:"admin"}):w.action==="remove"&&await f({conversation_id:t.id,profile_id:w.participant.profile_id}),typeof d.invalidate=="function"&&d.invalidate(t.id),D({open:!1,action:null,participant:null}),x(null))},S=async()=>{P(!1),!(!t||!(s!=null&&s.id))&&(await f({conversation_id:t.id,profile_id:s.id}),i&&i())};return e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50",children:[e.jsxs("div",{className:"bg-gray-900 rounded-lg shadow-lg p-6 w-full max-w-md relative",children:[e.jsx("button",{onClick:i,className:"absolute top-2 right-2 text-3xl text-white",children:"âœ•"}),e.jsx("div",{className:"flex justify-start mb-4",children:e.jsxs("button",{onClick:()=>P(!0),className:"text-red-400 hover:text-red-600 transition text-sm font-semibold flex items-center gap-1",title:r("header.buttons.leaveGroup"),children:[e.jsx(pe,{size:18}),r("header.buttons.leaveGroup")]})}),e.jsx(J,{isOpen:re,title:r("header.leave.title"),message:r("header.leave.groupMessage"),confirmLabel:r("header.leave.confirm"),cancelLabel:r("header.leave.cancel"),onConfirm:S,onCancel:()=>P(!1),color:"error"}),e.jsxs("div",{className:"flex flex-col items-center gap-4 mb-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Z,{avatar_url:U||t.avatar_url,className:"w-20 h-20 bg-amber-600"}),C&&e.jsxs(e.Fragment,{children:[e.jsx("button",{ref:R,className:"absolute bottom-0 right-0 bg-black bg-opacity-50 p-2 rounded-full text-white hover:bg-opacity-80 transition",title:r("groupOverview.avatar.edit"),disabled:b,children:e.jsx(ge,{className:"w-5 h-5 cursor-pointer"})}),e.jsx(Ce,{onFilesUpdate:V,amount:1,triggerRef:R})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:g?e.jsx("input",{type:"text",value:j,onChange:o=>N(o.target.value),onBlur:_,onKeyDown:o=>o.key==="Enter"&&_(),autoFocus:!0,className:"bg-transparent border-b border-sky-500 text-lg font-semibold text-white focus:outline-none",disabled:!C}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:j||"Untitled Group"}),C&&e.jsx(ve,{onClick:()=>h(!0),className:"text-white cursor-pointer hover:text-sky-400 transition text-base",title:r("groupOverview.title.edit")})]})}),C&&e.jsxs("div",{className:"w-full mt-2",children:[e.jsx("input",{type:"text",...$("searchTerm"),placeholder:r("header.search.placeholder"),className:"w-full p-2 rounded-md bg-neutral-800 text-white text-sm border border-neutral-600"}),B&&e.jsx("span",{className:"text-sm text-gray-400 mt-1 block",children:r("header.search.searching")}),e.jsxs("div",{className:"mt-2 flex flex-col gap-2",children:[E.map(o=>e.jsxs("div",{className:"flex items-center gap-2 bg-gray-800 rounded p-2",children:[e.jsx(Z,{avatar_url:o.avatar_url,gender:o.gender,className:"!w-8 !h-8"}),e.jsx("span",{className:"text-white font-medium",children:o.username}),e.jsx("button",{className:"ml-auto px-2 py-1 bg-sky-700 text-white rounded hover:bg-sky-800 text-xs font-semibold",onClick:()=>a({conversation_id:t.id,profile_id:o.id}),children:r("header.search.toggle")})]},o.id)),!B&&M&&E.length===0&&e.jsx("span",{className:"text-sm text-gray-500",children:r("header.search.noResults")})]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-2 flex items-center gap-2",children:[e.jsx(be,{})," ",r("groupOverview.participants")]}),e.jsx("ul",{className:"divide-y divide-gray-700",children:[...new Map(n.map(o=>[o.profile_id,o])).values()].map(o=>{const A=s.id===o.profile_id;return e.jsx(Oe,{participant:o,isSelf:A,isAdmin:C,menuOpen:l,setMenuOpen:x,setConfirmDialog:D,navigate:y,t:r},o.profile_id)})})]})]}),e.jsx(J,{isOpen:w.open,title:w.action==="remove"?`${r("groupOverview.actions.remove")}?`:`${r("groupOverview.actions.promote")}?`,confirmLabel:r("groupOverview.actions.confirm"),cancelLabel:r("groupOverview.actions.cancel"),onConfirm:k,onCancel:()=>D({open:!1,action:null,participant:null}),color:w.action==="remove"?"error":"success"})]})}const Ee=({conversationId:t})=>{const{user:i}=z(),{t:s}=H("chat"),{fetchConversation:l,fetchConversations:x,updateConversation:m,deleteConversation:d}=ee(),{data:a,isLoading:f,error:u}=l(t),{refetch:n}=x(i.id),{fetchParticipants:p,addParticipant:r,removeParticipant:g}=Q(),{data:h=[],isLoading:j}=p(t),{fetchProfile:N,searchProfiles:b}=G(),[O,U]=c.useState(!1),[T,R]=c.useState(!1),[y,w]=c.useState((a==null?void 0:a.title)||""),[D,re]=c.useState(!1),[P,$]=c.useState(!1),[q,M]=c.useState(!1),[X,I]=c.useState(!1),[B,E]=c.useState(!1),{isConversationListVisible:C,toggleConversationList:V}=se();let _=[];Array.isArray(h)?_=h:h&&Array.isArray(h.pages)&&(_=h.pages.flat()),Array.isArray(_)||(console.error("participants is not an array",h),_=[]);const k=_.find(v=>v.profile_id!==i.id),{data:S}=N(k==null?void 0:k.profile_id),{register:o,watch:A}=ce(),ue=A("searchTerm"),{data:Y,isLoading:Pe}=b(ue),xe=_.map(v=>v.profile_id)||[];Y!=null&&Y.filter(v=>!xe.includes(v.id));const L=a==null?void 0:a.is_group;_.some(v=>v.profile_id===i.id&&v.role==="admin"),c.useRef();const ie=te(),me=async()=>{try{if($(!1),!a||!(i!=null&&i.id))return;L?await g({conversation_id:a.id,profile_id:i.id}):await d(a),ie("/chat"),n()}catch(v){console.error("Failed to leave conversation:",v.message)}};if(c.useEffect(()=>{L&&(U(!0),a!=null&&a.title&&w(a.title))},[L,a==null?void 0:a.title]),!t)return e.jsxs("div",{className:"flex items-center gap-4 px-4 py-2 border-b border-sky-600",children:[e.jsx("h2",{className:"text-lg font-semibold",children:s("header.noConversation.title")}),e.jsx("button",{onClick:V,className:"md:hidden text-white bg-sky-600 text-2xl mr-2 ml-auto rounded-md p-1 cursor-pointer","aria-label":C?"Hide conversation list":"Show conversation list",title:C?"Hide conversation list":"Show conversation list",children:e.jsx(le,{size:30,title:"Show Conversations"})})]});if(f||j)return e.jsx(de,{});if(u)return e.jsx(ae,{error:u.message});const he=async()=>{try{await m({conversation:a,updates:{avatar_url:"/public/group.png",is_group:!0,title:s("header.group.untitled")}})}catch(v){console.error("Failed to convert to group chat:",v.message)}finally{M(!1)}},fe=L?a==null?void 0:a.avatar_url:S==null?void 0:S.avatar_url,K=L?a==null?void 0:a.title:S==null?void 0:S.username;return e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-2 bg-gradient-to-l from-gray-900 px-4 py-2 border-b-2 border-sky-600",children:[e.jsxs("div",{className:"flex items-center gap-4 w-full relative",children:[a!=null&&a.avatar_url?e.jsx("div",{className:"relative",children:e.jsx("img",{src:fe,alt:"Group Avatar",className:"w-10 h-10 bg-amber-600 rounded-full object-cover"})}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-neutral-600 flex items-center justify-center text-white text-sm",children:(K==null?void 0:K.charAt(0).toUpperCase())||"?"}),e.jsx("h2",{className:"text-lg font-semibold text-white",children:K||s("header.group.untitled")}),L&&e.jsxs("button",{onClick:()=>I(!0),className:"ml-auto px-2 py-1 bg-sky-700 text-white rounded hover:bg-sky-800 transition text-xs font-semibold items-center gap-1 hidden md:flex",style:{marginLeft:"auto"},title:s("header.group.info"),children:[e.jsx(ne,{size:18,className:"inline-block text-base text-gray-300"}),s("header.group.info")]}),!L&&e.jsxs("div",{className:"ml-auto relative flex items-center",children:[e.jsx("button",{className:"p-1 rounded-full hover:bg-gray-800 text-gray-300",onClick:()=>E(v=>!v),"aria-label":s("header.menu.open"),children:e.jsx(je,{size:22})}),B&&e.jsx("div",{className:"absolute right-7 mt-28 w-48 bg-gray-800 border border-gray-700 rounded shadow-lg z-10",children:e.jsxs("ul",{className:"py-1",children:[e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-4 py-2 text-sm hover:bg-gray-700 text-white",onClick:()=>{k!=null&&k.profile_id&&ie(`/profile/${k.profile_id}`),E(!1)},children:s("groupOverview.actions.viewProfile")})}),e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-4 py-2 text-sm border-t border-gray-700 hover:bg-sky-700 text-white",onClick:()=>{M(!0),E(!1)},children:s("header.buttons.convertToGroup")})}),e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-4 py-2 text-sm border-t border-gray-700 hover:bg-red-700 text-white",onClick:()=>{$(!0),E(!1)},children:s("header.buttons.leaveConversation")})})]})})]}),!L&&e.jsx(J,{isOpen:P,title:s("header.leave.title"),message:s("header.leave.directMessage"),confirmLabel:s("header.leave.confirm"),cancelLabel:s("header.leave.cancel"),onConfirm:me,onCancel:()=>$(!1),color:"error"}),e.jsx(J,{isOpen:q,title:s("header.convert.title"),message:s("header.convert.message"),confirmLabel:s("header.convert.confirm"),cancelLabel:s("header.convert.cancel"),onConfirm:he,onCancel:()=>M(!1),className:"!bg-emerald-600 hover:!bg-emerald-700"}),e.jsx("button",{onClick:V,className:"md:hidden text-white bg-sky-600 text-2xl mr-2 ml-auto rounded-md p-1","aria-label":s(C?"header.buttons.hideList":"header.buttons.showList"),title:s(C?"header.buttons.hideList":"header.buttons.showList"),children:e.jsx(le,{size:30})})]}),L&&e.jsxs("button",{onClick:()=>I(!0),className:"mt-2 mr-auto px-2 py-1 bg-sky-700 text-white rounded hover:bg-sky-800 transition text-xs font-semibold flex items-center gap-1 md:hidden",title:s("header.group.info"),children:[e.jsx(ne,{size:20,className:"inline-block text-base text-gray-300"}),s("header.group.info")]}),X&&e.jsx(Ie,{conversation:a,onClose:()=>I(!1)})]})},Ae=t=>{const i=["bg-emerald-600","bg-yellow-700","bg-purple-700","bg-green-800","bg-red-800","bg-pink-800","bg-indigo-500","bg-blue-800","bg-orange-700","bg-teal-600","bg-fuchsia-800","bg-cyan-700","bg-lime-700","bg-rose-800","bg-violet-600"];let s=0;for(let x=0;x<t.length;x++)s=t.charCodeAt(x)+((s<<5)-s);const l=Math.abs(s)%i.length;return i[l]},Ue=({message:t,isMine:i})=>{const{t:s}=H("chat"),{deleteMessage:l,updateMessage:x}=W(),{fetchProfile:m}=G(),{data:d,isLoading:a}=m(t.sender_profile_id),f=Array.isArray(t.delivered_to)&&t.delivered_to.length>0,u=Array.isArray(t.read_by)&&t.read_by.length>0,n=i?"bg-sky-700 text-white":Ae(t.sender_profile_id)+" text-white",[p,r]=c.useState(!1),[g,h]=c.useState(t.content),[j,N]=c.useState(!1),b=c.useRef();c.useEffect(()=>{if(!j)return;const y=w=>{b.current&&!b.current.contains(w.target)&&N(!1)};return document.addEventListener("mousedown",y),()=>document.removeEventListener("mousedown",y)},[j]);const O=()=>{r(!0),N(!1)},U=()=>{g.trim()&&g!==t.content&&x({id:t.id,conversation_id:t.conversation_id,updatedFields:{content:g}}),r(!1)},T=()=>{h(t.content),r(!1)},R=()=>{l({id:t.id,conversation_id:t.conversation_id}),N(!1)};return e.jsxs("div",{className:`flex ${i?"justify-end":"justify-start"} space-x-2`,children:[!i&&e.jsxs("div",{className:"flex flex-col items-start max-w-xs",children:[e.jsx("span",{className:"text-xs font-medium text-sky-300 mb-1",children:a?e.jsx(F,{width:80,height:12,baseColor:"#333",highlightColor:"#444"}):`${(d==null?void 0:d.firstname)||"Unknown"} ${(d==null?void 0:d.lastname)||""}`.trim()}),a?e.jsx(F,{height:32,width:200,baseColor:"#333",highlightColor:"#444"}):e.jsx("div",{className:`${n} p-2 rounded-lg min-w-[80px] text-center`,children:t.content})]}),i&&e.jsx("div",{className:"flex flex-col items-end max-w-xs relative",children:e.jsx("div",{className:`${n} p-3 rounded-lg relative pr-6 min-w-[80px]`,children:p?e.jsx("input",{type:"text",value:g,onChange:y=>h(y.target.value),onBlur:U,onKeyDown:y=>{y.key==="Enter"&&U(),y.key==="Escape"&&T()},placeholder:s("message.edit.placeholder"),autoFocus:!0,className:"bg-sky-900 text-white border-b border-sky-400 focus:outline-none w-full px-1 rounded"}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mr-2",children:t.content}),e.jsx("span",{className:"absolute bottom-1 right-1 text-xs text-white",children:u?e.jsx(ye,{className:"text-green-200",title:"Read"}):f?e.jsx(we,{className:"text-blue-200",title:"Delivered"}):null}),e.jsx("button",{className:"absolute top-1/2 -translate-y-1/2 right-1 text-white hover:text-sky-400 p-1",onClick:()=>N(y=>!y),"aria-label":"Message options",children:e.jsx(Ne,{size:18})}),j&&e.jsxs("div",{ref:b,className:"absolute z-10 right-5 top-6 bg-gray-900 border border-sky-700 rounded shadow-lg py-1 w-37 flex flex-col",children:[e.jsx("button",{className:"px-4 py-2 text-left hover:bg-gray-800 text-sm text-red-400",onClick:R,children:s("message.delete.title")}),e.jsx("div",{className:"border-t border-sky-700"}),e.jsx("button",{className:"px-4 py-2 text-left hover:bg-gray-800 text-sm text-yellow-500",onClick:O,children:s("message.edit.title")})]})]})})})]})},Me=({messages:t,profileId:i})=>{const s=Array.isArray(t)?t.filter(Boolean):[];return e.jsx("div",{className:"space-y-4",children:s.length>0&&s.map(l=>{const x=l.sender_profile_id===i;return e.jsx(Ue,{message:l,isMine:x},l.id||l.tempId||Math.random())})})},Te=({conversationId:t,senderId:i})=>{const{t:s}=H("chat"),[l,x]=c.useState(""),{insertMessage:m}=W(),{fetchParticipants:d}=Q(),{data:a=[]}=d(t),f=async n=>{if(n.preventDefault(),!l.trim())return;const p=(a==null?void 0:a.map(r=>r.profile_id).filter(r=>r!==i))||[];await m({content:l,sender_profile_id:i,conversation_id:t,delivered_to:p}),x("")},u=n=>{n.key==="Enter"&&!n.shiftKey&&(n.preventDefault(),f(n))};return e.jsxs("form",{onSubmit:f,className:"flex items-center space-x-2",children:[e.jsx("textarea",{rows:1,value:l,onChange:n=>x(n.target.value),onKeyDown:u,placeholder:s("input.placeholder"),className:"flex-1 resize-none rounded-lg border border-neutral-700 bg-neutral-950 text-white p-2 outline-none focus:ring-1 focus:ring-neutral-500"}),e.jsx("button",{type:"submit",className:"bg-sky-600 text-white font-semibold px-4 py-2 rounded-lg hover:bg-sky-700 transition",children:s("input.button")})]})},Re=()=>{const{conversationId:t}=oe(),{user:i}=z(),{fetchMessages:s,markMessagesAsRead:l,unreadMessages:x,messagesRealtime:m}=W(),d=!!t,{data:a,isLoading:f,error:u}=s(d?t:void 0);m(d?t:void 0);const{data:n}=x({conversationId:d?t:void 0,profileId:i.id});c.useEffect(()=>{if(n&&n.length>0&&l&&i.id){const r=n.map(g=>g.id);l({messageIds:r,profileId:i.id})}},[n,l,i.id]);const p=Array.isArray(a)?a.filter(r=>r&&r.sender_profile_id):[];return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx(Ee,{conversationId:d?t:void 0}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:e.jsx(Me,{messages:d?p:[],profileId:i.id})}),e.jsx("div",{className:"p-4",children:t&&e.jsx(Te,{conversationId:d?t:void 0,senderId:i.id})})]})},Ye=()=>{const{isConversationListVisible:t,setIsConversationListVisible:i}=se(),s=()=>{i(!1)};return e.jsxs("div",{className:"flex h-screen relative",children:[e.jsx("div",{className:`fixed md:static top-0 left-0 h-full bg-gray-900 z-50 transition-transform duration-300 ease-in-out
          ${t?"translate-x-0 w-3/5":"-translate-x-full"} md:translate-x-0 md:w-1/4`,children:e.jsx(Se,{onSelectConversation:s})}),e.jsx("div",{className:"flex-1 md:w-3/4 w-full h-full overflow-hidden",children:e.jsx(Re,{})})]})};export{Ye as default};
