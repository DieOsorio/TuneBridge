import{j as e}from"./mui-O-_7DbpJ.js";import{r as c}from"./calendar-BpW-aEGs.js";import{a as F,z as X,b as z,V as Q,E as ee,u as H,y as te,A as oe,h as se,W as ae,c as de,t as K,P as Z,X as ge,Y as pe,i as be}from"./index-Cf-eeQSk.js";import{S as W}from"./index-CpFbDMuT.js";/* empty css                 */import{O as ve,P as je,Q as ye,H as we,S as le,T as ne,U as Ne,V as Ce,W as _e,X as ke}from"./icons-D__VgVoR.js";import"./reactPlayer-D7fnNHFf.js";import"./lottie-DTlWc_fK.js";import"./gsap-Brfk6Bdo.js";import"./filepond-DcLflJls.js";function ce({isSelected:t=!1}){const r="#a1a1aa",s="#e4e4e7";return e.jsxs("div",{className:`flex items-center gap-3 px-4 py-2 ${t?"bg-sky-700":"bg-transparent"}`,children:[e.jsx(W,{circle:!0,width:40,height:40,baseColor:r,highlightColor:s}),e.jsx("div",{className:"flex flex-col grow",children:e.jsx(W,{height:15,width:"80%",baseColor:r,highlightColor:s})})]})}const Le=({conversation:t,isSelected:r,onClick:s})=>{const{user:l}=F(),{fetchParticipants:x}=X(),{data:h=[],isLoading:d,error:a}=x(t.id),{fetchProfile:m}=z(),u=h==null?void 0:h.find(O=>O.profile_id!==l.id),{data:n,isLoading:g,error:i}=m(u==null?void 0:u.profile_id),{unreadMessages:p}=Q(),{data:f,isLoading:v}=p({conversationId:t.id,profileId:l.id});if(d||g)return e.jsx(ce,{isSelected:r});if(a||i)return e.jsx(ee,{error:(a==null?void 0:a.message)||(i==null?void 0:i.message)});const w=t.is_group?t.avatar_url:n==null?void 0:n.avatar_url,N=t.is_group?t.title:n==null?void 0:n.username;return e.jsxs("div",{onClick:()=>s(t.id),className:`flex items-center gap-3 px-4 py-2 cursor-pointer transition-colors ${r?"bg-sky-700":"hover:bg-sky-950 hover:text-white"}`,children:[e.jsxs("div",{className:"relative",children:[w?e.jsx("img",{src:w,alt:"Avatar",className:"w-10 h-10 rounded-full object-cover"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-neutral-600 flex items-center justify-center text-white text-sm",children:(N==null?void 0:N.charAt(0).toUpperCase())||"?"}),!v&&(f==null?void 0:f.length)>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full px-1.5",children:f.length})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:`font-medium truncate ${r&&"text-white"}`,children:N||"Untitled"}),t.last_message&&e.jsx("span",{className:"text-sm text-neutral-400 truncate max-w-[180px]",children:t.last_message})]})]})},Se=()=>{const{t}=H("chat"),{user:r}=F(),{fetchConversations:s}=te(),{data:l,isLoading:x,error:h}=s(r.id),{conversationId:d}=oe(),a=se(),[m,u]=c.useState(d),{setIsConversationListVisible:n}=ae();c.useEffect(()=>{!d&&l&&l.length>0?u(l[0].id):u(d)},[d,l]);const g=i=>{u(i),a(`/chat/${i}`),n(!1)};return x?[...Array(3)].map((i,p)=>e.jsx(ce,{})):h?e.jsx(ee,{error:h.message}):e.jsx("div",{className:"w-full overflow-y-auto h-full bg-gradient-to-l from-gray-900 border-r-2 border-sky-700",children:l!=null&&l.length?l.map(i=>e.jsx(Le,{conversation:i,isSelected:m===i.id,onClick:g},i.id)):e.jsx("p",{className:"text-gray-400 p-4",children:t("list")})})};function Oe({participant:t,isSelf:r,isAdmin:s,menuOpen:l,setMenuOpen:x,setConfirmDialog:h,navigate:d,t:a}){var p;const{fetchProfile:m}=z(),u=(p=m(t.profile_id))==null?void 0:p.data,n=c.useRef(),[g,i]=c.useState(!1);return c.useEffect(()=>{l===t.profile_id&&n.current&&(n.current.getBoundingClientRect().bottom+140>window.innerHeight?i(!0):i(!1))},[l,t.profile_id]),e.jsxs("li",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{avatar_url:u==null?void 0:u.avatar_url,gender:u==null?void 0:u.gender,className:"!w-8 !h-8"}),e.jsx("span",{className:"text-white font-medium",children:(u==null?void 0:u.username)||t.profile_id}),e.jsx("span",{className:`ml-2 px-2 py-0.5 rounded text-xs ${t.role==="admin"?"bg-sky-700 text-white":"bg-gray-700 text-gray-200"}`,children:a(`groupOverview.role.${t.role}`)})]}),!r&&s&&e.jsxs("div",{className:"relative",children:[e.jsx("button",{ref:n,className:"p-1 rounded-full cursor-pointer hover:bg-gray-800 text-gray-300",onClick:()=>x(l===t.profile_id?null:t.profile_id),"aria-label":a("groupOverview.menu.open"),children:e.jsxs("svg",{width:"20",height:"20",fill:"currentColor",viewBox:"0 0 20 20",children:[e.jsx("circle",{cx:"4",cy:"10",r:"2"}),e.jsx("circle",{cx:"10",cy:"10",r:"2"}),e.jsx("circle",{cx:"16",cy:"10",r:"2"})]})}),l===t.profile_id&&e.jsx("div",{className:`absolute right-0 w-45 bg-gray-800 border border-gray-700 rounded shadow-lg z-10 ${g?"bottom-full mb-2":"mt-2"}`,children:e.jsxs("ul",{className:"py-1",children:[e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-4 py-2 text-sm hover:bg-gray-700 text-white",onClick:()=>{d(`/profile/${t.profile_id}`),x(null)},children:a("groupOverview.actions.viewProfile")})}),t.role!=="admin"&&e.jsx("li",{children:e.jsx("button",{className:"w-full text-left border-t border-gray-700 px-4 py-2 text-sm hover:bg-sky-700 text-white",onClick:()=>h({open:!0,action:"promote",participant:t}),children:a("groupOverview.actions.promote")})}),e.jsx("li",{children:e.jsx("button",{className:"w-full text-left border-t border-gray-700 px-4 py-2 text-sm hover:bg-red-700 text-white",onClick:()=>h({open:!0,action:"remove",participant:t}),children:a("groupOverview.actions.remove")})})]})})]})]},t.profile_id)}function Ie({conversation:t,onClose:r}){const{user:s}=F(),[l,x]=c.useState(null),{updateConversation:h}=te(),{fetchParticipants:d,addParticipant:a,removeParticipant:m,updateParticipantRole:u}=X(),{data:n=[]}=d(t.id),{searchProfiles:g}=z(),{t:i}=H("chat"),[p,f]=c.useState(!1),[v,k]=c.useState(t.title||""),[w,N]=c.useState(!1),[O,T]=c.useState(null),R=c.useRef(),j=se(),[y,G]=c.useState({open:!1,action:null,participant:null}),[re,P]=c.useState(!1),{register:$,watch:Y}=de(),M=Y("searchTerm"),q=n.map(o=>o.profile_id)||[],{data:E,isLoading:D}=g(M),A=(E==null?void 0:E.filter(o=>!q.includes(o.id)))||[],C=n.some(o=>o.profile_id===s.id&&o.role==="admin"),V=async o=>{if(!(!(o!=null&&o[0])||!t.id)&&!w){N(!0);try{T(URL.createObjectURL(o[0]));const U=await pe(o[0],"chat-group-avatars",t.id,t.avatar_url,!0);U&&U!==t.avatar_url&&(await h({conversation:t,updates:{avatar_url:U}}),T(null))}finally{N(!1)}}},_=async()=>{f(!1);const o=v.trim();o&&o!==t.title&&await h({conversation:t,updates:{title:o}})},L=async()=>{y.participant&&(y.action==="promote"?await u({conversation_id:t.id,profile_id:y.participant.profile_id,role:"admin"}):y.action==="remove"&&await m({conversation_id:t.id,profile_id:y.participant.profile_id}),typeof d.invalidate=="function"&&d.invalidate(t.id),G({open:!1,action:null,participant:null}),x(null))},I=async()=>{P(!1),!(!t||!(s!=null&&s.id))&&(await m({conversation_id:t.id,profile_id:s.id}),r&&r())};return e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50",children:[e.jsxs("div",{className:"bg-gray-900 rounded-lg shadow-lg p-6 w-full max-w-md relative",children:[e.jsx("button",{onClick:r,className:"absolute top-2 right-2 text-3xl text-white",children:"âœ•"}),e.jsx("div",{className:"flex justify-start mb-4",children:e.jsxs("button",{onClick:()=>P(!0),className:"text-red-400 hover:text-red-600 transition text-sm font-semibold flex items-center gap-1",title:i("header.buttons.leaveGroup"),children:[e.jsx(ve,{size:18}),i("header.buttons.leaveGroup")]})}),e.jsx(K,{isOpen:re,title:i("header.leave.title"),message:i("header.leave.groupMessage"),confirmLabel:i("header.leave.confirm"),cancelLabel:i("header.leave.cancel"),onConfirm:I,onCancel:()=>P(!1),color:"error"}),e.jsxs("div",{className:"flex flex-col items-center gap-4 mb-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Z,{avatar_url:O||t.avatar_url,className:"w-20 h-20 bg-amber-600"}),C&&e.jsxs(e.Fragment,{children:[e.jsx("button",{ref:R,className:"absolute bottom-0 right-0 bg-black bg-opacity-50 p-2 rounded-full text-white hover:bg-opacity-80 transition",title:i("groupOverview.avatar.edit"),disabled:w,children:e.jsx(je,{className:"w-5 h-5 cursor-pointer"})}),e.jsx(ge,{onFilesUpdate:V,amount:1,triggerRef:R})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:p?e.jsx("input",{type:"text",value:v,onChange:o=>k(o.target.value),onBlur:_,onKeyDown:o=>o.key==="Enter"&&_(),autoFocus:!0,className:"bg-transparent border-b border-sky-500 text-lg font-semibold text-white focus:outline-none",disabled:!C}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:v||"Untitled Group"}),C&&e.jsx(ye,{onClick:()=>f(!0),className:"text-white cursor-pointer hover:text-sky-400 transition text-base",title:i("groupOverview.title.edit")})]})}),C&&e.jsxs("div",{className:"w-full mt-2",children:[e.jsx("input",{type:"text",...$("searchTerm"),placeholder:i("header.search.placeholder"),className:"w-full p-2 rounded-md bg-neutral-800 text-white text-sm border border-neutral-600"}),D&&e.jsx("span",{className:"text-sm text-gray-400 mt-1 block",children:i("header.search.searching")}),e.jsxs("div",{className:"mt-2 flex flex-col gap-2",children:[A.map(o=>e.jsxs("div",{className:"flex items-center gap-2 bg-gray-800 rounded p-2",children:[e.jsx(Z,{avatar_url:o.avatar_url,gender:o.gender,className:"!w-8 !h-8"}),e.jsx("span",{className:"text-white font-medium",children:o.username}),e.jsx("button",{className:"ml-auto px-2 py-1 bg-sky-700 text-white rounded hover:bg-sky-800 text-xs font-semibold",onClick:()=>a({conversation_id:t.id,profile_id:o.id}),children:i("header.search.toggle")})]},o.id)),!D&&M&&A.length===0&&e.jsx("span",{className:"text-sm text-gray-500",children:i("header.search.noResults")})]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-2 flex items-center gap-2",children:[e.jsx(we,{})," ",i("groupOverview.participants")]}),e.jsx("ul",{className:"divide-y divide-gray-700",children:[...new Map(n.map(o=>[o.profile_id,o])).values()].map(o=>{const U=s.id===o.profile_id;return e.jsx(Oe,{participant:o,isSelf:U,isAdmin:C,menuOpen:l,setMenuOpen:x,setConfirmDialog:G,navigate:j,t:i},o.profile_id)})})]})]}),e.jsx(K,{isOpen:y.open,title:y.action==="remove"?`${i("groupOverview.actions.remove")}?`:`${i("groupOverview.actions.promote")}?`,confirmLabel:i("groupOverview.actions.confirm"),cancelLabel:i("groupOverview.actions.cancel"),onConfirm:L,onCancel:()=>G({open:!1,action:null,participant:null}),color:y.action==="remove"?"error":"success"})]})}const Ee=({conversationId:t})=>{const{user:r}=F(),{t:s}=H("chat"),{fetchConversation:l,fetchConversations:x,updateConversation:h,deleteConversation:d}=te(),{data:a,isLoading:m,error:u}=l(t),{refetch:n}=x(r.id),{fetchParticipants:g,addParticipant:i,removeParticipant:p}=X(),{data:f=[],isLoading:v}=g(t),{fetchProfile:k,searchProfiles:w}=z(),[N,O]=c.useState(!1),[T,R]=c.useState(!1),[j,y]=c.useState((a==null?void 0:a.title)||""),[G,re]=c.useState(!1),[P,$]=c.useState(!1),[Y,M]=c.useState(!1),[q,E]=c.useState(!1),[D,A]=c.useState(!1),{isConversationListVisible:C,toggleConversationList:V}=ae();let _=[];Array.isArray(f)?_=f:f&&Array.isArray(f.pages)&&(_=f.pages.flat()),Array.isArray(_)||(console.error("participants is not an array",f),_=[]);const L=_.find(b=>b.profile_id!==r.id),{data:I}=k(L==null?void 0:L.profile_id),{register:o,watch:U}=de(),ue=U("searchTerm"),{data:J,isLoading:Pe}=w(ue),xe=_.map(b=>b.profile_id)||[];J!=null&&J.filter(b=>!xe.includes(b.id));const S=a==null?void 0:a.is_group;_.some(b=>b.profile_id===r.id&&b.role==="admin"),c.useRef();const ie=se(),he=async()=>{try{if($(!1),!a||!(r!=null&&r.id))return;S?await p({conversation_id:a.id,profile_id:r.id}):await d(a),ie("/chat"),n()}catch(b){console.error("Failed to leave conversation:",b.message)}};if(c.useEffect(()=>{S&&(O(!0),a!=null&&a.title&&y(a.title))},[S,a==null?void 0:a.title]),!t)return e.jsxs("div",{className:"flex items-center gap-4 px-4 py-2 border-b border-sky-600",children:[e.jsx("h2",{className:"text-lg font-semibold",children:s("header.noConversation.title")}),e.jsx("button",{onClick:V,className:"md:hidden text-white bg-sky-600 text-2xl mr-2 ml-auto rounded-md p-1 cursor-pointer","aria-label":C?"Hide conversation list":"Show conversation list",title:C?"Hide conversation list":"Show conversation list",children:e.jsx(le,{size:30,title:"Show Conversations"})})]});if(m||v)return e.jsx(be,{});if(u)return e.jsx(ee,{error:u.message});const me=async()=>{try{await h({conversation:a,updates:{avatar_url:"/public/group.png",is_group:!0,title:s("header.group.untitled")}})}catch(b){console.error("Failed to convert to group chat:",b.message)}finally{M(!1)}},fe=S?a==null?void 0:a.avatar_url:I==null?void 0:I.avatar_url,B=S?a==null?void 0:a.title:I==null?void 0:I.username;return e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-2 bg-gradient-to-l from-gray-900 px-4 py-2 border-b-2 border-sky-600",children:[e.jsxs("div",{className:"flex items-center gap-4 w-full relative",children:[a!=null&&a.avatar_url?e.jsx("div",{className:"relative",children:e.jsx("img",{src:fe,alt:"Group Avatar",className:"w-10 h-10 bg-amber-600 rounded-full object-cover"})}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-neutral-600 flex items-center justify-center text-white text-sm",children:(B==null?void 0:B.charAt(0).toUpperCase())||"?"}),e.jsx("h2",{className:"text-lg font-semibold text-white",children:B||s("header.group.untitled")}),S&&e.jsxs("button",{onClick:()=>E(!0),className:"ml-auto px-2 py-1 bg-sky-700 text-white rounded hover:bg-sky-800 transition text-xs font-semibold items-center gap-1 hidden md:flex",style:{marginLeft:"auto"},title:s("header.group.info"),children:[e.jsx(ne,{size:18,className:"inline-block text-base text-gray-300"}),s("header.group.info")]}),!S&&e.jsxs("div",{className:"ml-auto relative flex items-center",children:[e.jsx("button",{className:"p-1 rounded-full hover:bg-gray-800 text-gray-300",onClick:()=>A(b=>!b),"aria-label":s("header.menu.open"),children:e.jsx(Ne,{size:22})}),D&&e.jsx("div",{className:"absolute right-7 mt-28 w-48 bg-gray-800 border border-gray-700 rounded shadow-lg z-10",children:e.jsxs("ul",{className:"py-1",children:[e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-4 py-2 text-sm hover:bg-gray-700 text-white",onClick:()=>{L!=null&&L.profile_id&&ie(`/profile/${L.profile_id}`),A(!1)},children:s("groupOverview.actions.viewProfile")})}),e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-4 py-2 text-sm border-t border-gray-700 hover:bg-sky-700 text-white",onClick:()=>{M(!0),A(!1)},children:s("header.buttons.convertToGroup")})}),e.jsx("li",{children:e.jsx("button",{className:"w-full text-left px-4 py-2 text-sm border-t border-gray-700 hover:bg-red-700 text-white",onClick:()=>{$(!0),A(!1)},children:s("header.buttons.leaveConversation")})})]})})]}),!S&&e.jsx(K,{isOpen:P,title:s("header.leave.title"),message:s("header.leave.directMessage"),confirmLabel:s("header.leave.confirm"),cancelLabel:s("header.leave.cancel"),onConfirm:he,onCancel:()=>$(!1),color:"error"}),e.jsx(K,{isOpen:Y,title:s("header.convert.title"),message:s("header.convert.message"),confirmLabel:s("header.convert.confirm"),cancelLabel:s("header.convert.cancel"),onConfirm:me,onCancel:()=>M(!1),className:"!bg-emerald-600 hover:!bg-emerald-700"}),e.jsx("button",{onClick:V,className:"md:hidden text-white bg-sky-600 text-2xl mr-2 ml-auto rounded-md p-1","aria-label":s(C?"header.buttons.hideList":"header.buttons.showList"),title:s(C?"header.buttons.hideList":"header.buttons.showList"),children:e.jsx(le,{size:30})})]}),S&&e.jsxs("button",{onClick:()=>E(!0),className:"mt-2 mr-auto px-2 py-1 bg-sky-700 text-white rounded hover:bg-sky-800 transition text-xs font-semibold flex items-center gap-1 md:hidden",title:s("header.group.info"),children:[e.jsx(ne,{size:20,className:"inline-block text-base text-gray-300"}),s("header.group.info")]}),q&&e.jsx(Ie,{conversation:a,onClose:()=>E(!1)})]})},Ae=t=>{const r=["bg-emerald-600","bg-yellow-700","bg-purple-700","bg-green-800","bg-red-800","bg-pink-800","bg-indigo-500","bg-blue-800","bg-orange-700","bg-teal-600","bg-fuchsia-800","bg-cyan-700","bg-lime-700","bg-rose-800","bg-violet-600"];let s=0;for(let x=0;x<t.length;x++)s=t.charCodeAt(x)+((s<<5)-s);const l=Math.abs(s)%r.length;return r[l]},Ue=({message:t,isMine:r})=>{const{t:s}=H("chat"),{deleteMessage:l,updateMessage:x}=Q(),{fetchProfile:h}=z(),{data:d,isLoading:a}=h(t.sender_profile_id),m=Array.isArray(t.delivered_to)&&t.delivered_to.length>0,u=Array.isArray(t.read_by)&&t.read_by.length>0,n=r?"bg-sky-700 text-white":Ae(t.sender_profile_id)+" text-white",[g,i]=c.useState(!1),[p,f]=c.useState(t.content),[v,k]=c.useState(!1),w=c.useRef();c.useEffect(()=>{if(!v)return;const j=y=>{w.current&&!w.current.contains(y.target)&&k(!1)};return document.addEventListener("mousedown",j),()=>document.removeEventListener("mousedown",j)},[v]);const N=()=>{i(!0),k(!1)},O=()=>{p.trim()&&p!==t.content&&x({id:t.id,conversation_id:t.conversation_id,updatedFields:{content:p}}),i(!1)},T=()=>{f(t.content),i(!1)},R=()=>{l({id:t.id,conversation_id:t.conversation_id}),k(!1)};return e.jsxs("div",{className:`flex ${r?"justify-end":"justify-start"} space-x-2`,children:[!r&&e.jsxs("div",{className:"flex flex-col items-start max-w-xs",children:[e.jsx("span",{className:"text-xs font-medium text-sky-300 mb-1",children:a?e.jsx(W,{width:80,height:12,baseColor:"#a1a1aa",highlightColor:"#e4e4e7"}):`${(d==null?void 0:d.firstname)||"Unknown"} ${(d==null?void 0:d.lastname)||""}`.trim()}),a?e.jsx(W,{height:32,width:200,baseColor:"#a1a1aa",highlightColor:"#e4e4e7"}):e.jsx("div",{className:`${n} p-2 rounded-lg min-w-[80px] text-center`,children:t.content})]}),r&&e.jsx("div",{className:"flex flex-col items-end max-w-xs relative",children:e.jsx("div",{className:`${n} p-3 rounded-lg relative pr-6 min-w-[80px]`,children:g?e.jsx("input",{type:"text",value:p,onChange:j=>f(j.target.value),onBlur:O,onKeyDown:j=>{j.key==="Enter"&&O(),j.key==="Escape"&&T()},placeholder:s("message.edit.placeholder"),autoFocus:!0,className:"bg-sky-900 text-white border-b border-sky-400 focus:outline-none w-full px-1 rounded"}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mr-2",children:t.content}),e.jsx("span",{className:"absolute bottom-1 right-1 text-xs text-white",children:u?e.jsx(Ce,{className:"text-green-200",title:"Read"}):m?e.jsx(_e,{className:"text-blue-200",title:"Delivered"}):null}),e.jsx("button",{className:"absolute top-1/2 -translate-y-1/2 right-1 text-white hover:text-sky-400 p-1",onClick:()=>k(j=>!j),"aria-label":"Message options",children:e.jsx(ke,{size:18})}),v&&e.jsxs("div",{ref:w,className:"absolute z-10 right-5 top-6 bg-gray-900 border border-sky-700 rounded shadow-lg py-1 w-37 flex flex-col",children:[e.jsx("button",{className:"px-4 py-2 text-left hover:bg-gray-800 text-sm text-red-400",onClick:R,children:s("message.delete.title")}),e.jsx("div",{className:"border-t border-sky-700"}),e.jsx("button",{className:"px-4 py-2 text-left hover:bg-gray-800 text-sm text-yellow-500",onClick:N,children:s("message.edit.title")})]})]})})})]})},Me=({messages:t,profileId:r})=>{const s=Array.isArray(t)?t.filter(Boolean):[];return e.jsx("div",{className:"space-y-4",children:s.length>0&&s.map(l=>{const x=l.sender_profile_id===r;return e.jsx(Ue,{message:l,isMine:x},l.id||l.tempId||Math.random())})})},Te=({conversationId:t,senderId:r})=>{const{t:s}=H("chat"),[l,x]=c.useState(""),{insertMessage:h}=Q(),{fetchParticipants:d}=X(),{data:a=[]}=d(t),m=async n=>{if(n.preventDefault(),!l.trim())return;const g=(a==null?void 0:a.map(i=>i.profile_id).filter(i=>i!==r))||[];await h({content:l,sender_profile_id:r,conversation_id:t,delivered_to:g}),x("")},u=n=>{n.key==="Enter"&&!n.shiftKey&&(n.preventDefault(),m(n))};return e.jsxs("form",{onSubmit:m,className:"flex items-center space-x-2",children:[e.jsx("textarea",{rows:1,value:l,onChange:n=>x(n.target.value),onKeyDown:u,placeholder:s("input.placeholder"),className:"flex-1 resize-none rounded-lg border border-neutral-700 bg-neutral-950 text-white p-2 outline-none focus:ring-1 focus:ring-neutral-500"}),e.jsx("button",{type:"submit",className:"bg-sky-600 text-white font-semibold px-4 py-2 rounded-lg hover:bg-sky-700 transition",children:s("input.button")})]})},Re=()=>{const{conversationId:t}=oe(),{user:r}=F(),{fetchMessages:s,markMessagesAsRead:l,unreadMessages:x,messagesRealtime:h}=Q(),d=!!t,{data:a}=s(d?t:void 0);h(d?t:void 0);const{data:m}=x({conversationId:d?t:void 0,profileId:r.id});c.useEffect(()=>{if(m&&m.length>0&&l&&r.id){const n=m.map(g=>g.id);l({messageIds:n,profileId:r.id})}},[m,l,r.id]);const u=Array.isArray(a)?a.filter(n=>n&&n.sender_profile_id):[];return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx(Ee,{conversationId:d?t:void 0}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:e.jsx(Me,{messages:d?u:[],profileId:r.id})}),e.jsx("div",{className:"p-4",children:t&&e.jsx(Te,{conversationId:d?t:void 0,senderId:r.id})})]})},Xe=()=>{const{isConversationListVisible:t,setIsConversationListVisible:r}=ae(),s=()=>{r(!1)};return e.jsxs("div",{className:"flex h-screen relative",children:[e.jsx("div",{className:`fixed md:static top-0 left-0 h-full bg-gray-900 z-50 transition-transform duration-300 ease-in-out
          ${t?"translate-x-0 w-3/5":"-translate-x-full"} md:translate-x-0 md:w-1/4`,children:e.jsx(Se,{onSelectConversation:s})}),e.jsx("div",{className:"flex-1 md:w-3/4 w-full h-full overflow-hidden",children:e.jsx(Re,{})})]})};export{Xe as default};
