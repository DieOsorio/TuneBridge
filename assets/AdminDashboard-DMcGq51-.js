import{j as e,f as D}from"./mui-DntPDMdt.js";import{u as b,N as G,E as C,x as B,c as E,I as z,S as M,B as g,an as U,L as S,U as $,ai as J,am as W,ao as X,ap as Y,a as ee,R as se,i as k,z as te}from"./index-DUDycYqK.js";import{r as h}from"./calendar-DXWKnWXk.js";import{S as L}from"./index-BXOMkYts.js";/* empty css                 */import{T as ae}from"./Toggle-DG4h0YaY.js";import{M as R}from"./Modal-Bz-ouz36.js";import"./reactPlayer-CBmCIXQE.js";import"./icons-Cf_ygVw3.js";import"./lottie-FCmafNqs.js";import"./gsap-CH_iu5NA.js";import"./filepond-DvarZm2e.js";function le({title:s,titleId:n,...a},t){return h.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},a),s?h.createElement("title",{id:n},s):null,h.createElement("path",{fillRule:"evenodd",d:"M12.97 3.97a.75.75 0 0 1 1.06 0l7.5 7.5a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 1 1-1.06-1.06l6.22-6.22H3a.75.75 0 0 1 0-1.5h16.19l-6.22-6.22a.75.75 0 0 1 0-1.06Z",clipRule:"evenodd"}))}const re=h.forwardRef(le);function ne({title:s,titleId:n,...a},t){return h.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},a),s?h.createElement("title",{id:n},s):null,h.createElement("path",{fillRule:"evenodd",d:"M16.5 4.478v.227a48.816 48.816 0 0 1 3.878.512.75.75 0 1 1-.256 1.478l-.209-.035-1.005 13.07a3 3 0 0 1-2.991 2.77H8.084a3 3 0 0 1-2.991-2.77L4.087 6.66l-.209.035a.75.75 0 0 1-.256-1.478A48.567 48.567 0 0 1 7.5 4.705v-.227c0-1.564 1.213-2.9 2.816-2.951a52.662 52.662 0 0 1 3.369 0c1.603.051 2.815 1.387 2.815 2.951Zm-6.136-1.452a51.196 51.196 0 0 1 3.273 0C14.39 3.05 15 3.684 15 4.478v.113a49.488 49.488 0 0 0-6 0v-.113c0-.794.609-1.428 1.364-1.452Zm-.355 5.945a.75.75 0 1 0-1.5.058l.347 9a.75.75 0 1 0 1.499-.058l-.346-9Zm5.48.058a.75.75 0 1 0-1.498-.058l-.347 9a.75.75 0 0 0 1.5.058l.345-9Z",clipRule:"evenodd"}))}const T=h.forwardRef(ne),ie=[{key:"roles",to:"/admin/roles"},{key:"reports",to:"/admin/reports"},{key:"feedback",to:"/admin/feedback"},{key:"bans",to:"/admin/bans"},{key:"logs",to:"/admin/logs"}];function oe(){const{t:s}=b("admin",{keyPrefix:"nav"});return e.jsx("nav",{className:"w-full lg:w-64 bg-gradient-to-b from-gray-800 text-white p-4 rounded-md",children:e.jsx("ul",{className:"space-y-2",children:ie.map(({key:n,to:a})=>e.jsx("li",{children:e.jsx(G,{to:a,className:({isActive:t})=>`block px-2 py-3 text-center rounded-md border-b border-gray-600 hover:bg-gray-700 transition-all ${t?"bg-gray-700 font-semibold":""}`,end:!0,children:s(n)})},a))})})}const F=({count:s=5})=>{const n="#a1a1aa",a="#e4e4e7";return e.jsx("ul",{className:"divide-y divide-gray-700 max-h-[400px] overflow-y-auto",children:Array.from({length:s}).map((t,l)=>e.jsxs("li",{className:"flex justify-between items-center p-3 bg-zinc-700/20 rounded",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(L,{height:20,width:"40%",baseColor:n,highlightColor:a}),e.jsx(L,{height:16,width:"60%",baseColor:n,highlightColor:a,style:{marginTop:6}})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(L,{circle:!0,height:24,width:24,baseColor:n,highlightColor:a}),e.jsx(L,{circle:!0,height:24,width:24,baseColor:n,highlightColor:a})]})]},l))})},de=({roles:s,isLoading:n,error:a,onEdit:t,onDelete:l,isAdmin:o})=>{const{t:r}=b("admin",{keyPrefix:"roles.list"}),[d,p]=h.useState(!1),[m,c]=h.useState(null);if(n)return e.jsx(F,{count:3});if(a&&a instanceof Error)return e.jsx(C,{error:a.message});if(!s.length)return e.jsx("p",{className:"text-sm text-muted",children:r("noRoles")});const u=()=>{m&&(l({profile_id:m.profile_id}),p(!1),c(null))};return e.jsxs(e.Fragment,{children:[e.jsx("ul",{className:"divide-y divide-gray-700 max-h-[400px] overflow-y-auto",children:s.map(i=>e.jsxs("li",{className:`flex justify-between bg-zinc-700/10 items-center p-3 rounded transition-all 
              ${o?"cursor-pointer hover:bg-zinc-700/20":"cursor-default"}`,onClick:o?()=>t(i.profile_id):void 0,role:o?"button":void 0,tabIndex:o?0:-1,onKeyDown:o?x=>{(x.key==="Enter"||x.key===" ")&&t(i.profile_id)}:void 0,children:[e.jsxs("div",{className:"w-full",children:[e.jsx("p",{className:"font-medium p-1 uppercase",children:i.role}),e.jsxs("div",{className:"flex items-center gap-4 w-full max-w-169 bg-gray-700 p-2 rounded-md",children:[e.jsx("p",{className:"uppercase",children:r("permissions")}),e.jsx("span",{className:"text-sm text-gray-300 truncate",children:i.permissions.join(", ")||r("noPermissions")})]})]}),o&&e.jsx("div",{className:"mb-auto",children:e.jsx("button",{onClick:x=>{x.stopPropagation(),c(i),p(!0)},className:"p-1 cursor-pointer text-rose-500 hover:text-rose-700",title:r("buttons.delete"),children:e.jsx(T,{className:"w-5 h-5"})})})]},i.profile_id))}),e.jsx(B,{isOpen:d,title:r("danger.title"),message:r("danger.confirm"),onConfirm:u,onCancel:()=>{p(!1),c(null)},confirmLabel:r("danger.yesDelete"),cancelLabel:r("danger.cancel"),color:"error"})]})},ce=["manage_users","ban_users","review_reports","view_feedback","access_logs","edit_roles"],me=[{value:"admin",label:"Admin"},{value:"moderator",label:"Moderator"},{value:"auditor",label:"Auditor"}],xe=({profileId:s,onClose:n,onSubmit:a,initialData:t})=>{const{t:l}=b("admin",{keyPrefix:"roles.form"}),{register:o,handleSubmit:r,setValue:d,control:p,formState:{errors:m,isSubmitting:c}}=E();h.useEffect(()=>{if(t){d("profile_id",t.profile_id),d("role",t.role);const i=t.permissions.reduce((x,j)=>(x[j]=!0,x),{});d("permissions",i)}else s&&d("profile_id",s)},[t,s,d]);const u=async i=>{const x=Object.entries(i.permissions||{}).filter(([,j])=>j===!0).map(([j])=>j);await a({profile_id:i.profile_id,role:i.role,permissions:x}),n()};return e.jsxs("form",{onSubmit:r(u),className:"space-y-6 bg-zinc-800 p-6 rounded-lg shadow max-w-lg mx-auto overflow-y-auto max-h-130",children:[e.jsx("h2",{className:"text-lg font-semibold text-white text-center mb-2",children:l(s?"title.edit":"title.add")}),e.jsx(z,{id:"profile_id",label:l("fields.profile_id.label"),placeholder:l("fields.profile_id.placeholder"),register:o,validation:{required:l("fields.profile_id.required")},error:m.profile_id,classForLabel:"text-gray-300",disabled:!!s}),e.jsx(M,{id:"role",label:l("fields.role.label"),options:me.map(i=>({...i,label:l(`fields.role.options.${i.value}`)})),control:p,validation:{required:l("fields.role.required")},error:m.role,search:!1}),e.jsxs("fieldset",{className:"space-y-2",children:[e.jsx("legend",{className:"text-gray-300 font-medium mb-2",children:l("fields.permissions.label")}),ce.map(i=>e.jsx(ae,{id:`permissions.${i}`,label:l(`fields.permissions.options.${i}`),register:o},i))]}),e.jsxs("div",{className:"flex gap-4 justify-center",children:[e.jsx(g,{type:"button",onClick:n,className:"!bg-gray-600 hover:!bg-gray-700",children:l("buttons.cancel")}),e.jsx(g,{type:"submit",disabled:c,className:"!bg-emerald-600 hover:!bg-emerald-700",children:l(c?"buttons.saving":"buttons.save")})]})]})},q=({isAdmin:s,isModerator:n})=>{const{t:a}=b("admin",{keyPrefix:"roles.section"}),{allAdminRolesQuery:t,upsertAdminRole:l,deleteAdminRole:o}=U(),[r,d]=h.useState(null),[p,m]=h.useState(!1),{data:c,isLoading:u,error:i}=t(),x=r?(c==null?void 0:c.find(f=>f.profile_id===r))??null:null,j=()=>{d(null),m(!0)},v=f=>{d(f),m(!0)},w=()=>{d(null),m(!1)};return e.jsxs("section",{className:"p-4 space-y-4",children:[e.jsxs("header",{className:"flex p-4 rounded-l-md justify-between items-center space-x-2 bg-gradient-to-r from-gray-800",children:[e.jsx("h2",{className:"text-xl font-semibold",children:a("title")}),s&&e.jsx(g,{onClick:j,className:"!bg-emerald-600 hover:!bg-emerald-700",children:a("buttons.add")})]}),e.jsx(de,{roles:c??[],isLoading:u,error:i,onEdit:v,onDelete:o,isAdmin:s}),p&&s&&e.jsx(R,{onClose:w,children:e.jsx(xe,{profileId:r,initialData:x,onClose:w,onSubmit:async f=>{await l(f)}})})]})},ue=({reports:s,hasAccess:n,onSelect:a,onDelete:t,isLoading:l,error:o})=>{const{t:r}=b("admin",{keyPrefix:"reports.list"}),[d,p]=h.useState(!1),[m,c]=h.useState(null);if(l)return e.jsx(F,{count:3});if(o&&o instanceof Error)return e.jsx(C,{error:o.message});if(s.length===0)return e.jsx("p",{className:"text-sm text-muted",children:r("empty")});const u=()=>{m&&(t(m.id),p(!1),c(null))};return e.jsxs(e.Fragment,{children:[e.jsx("ul",{className:"divide-y divide-gray-700 max-h-[400px] overflow-y-auto",children:s.map(i=>e.jsxs("li",{className:`flex justify-between bg-zinc-700/10 items-center p-3 rounded transition-all 
                ${n?"cursor-pointer hover:bg-zinc-700/20":"cursor-default"}`,onClick:n?()=>a(i.id):void 0,role:n?"button":void 0,tabIndex:n?0:-1,onKeyDown:n?x=>{(x.key==="Enter"||x.key===" ")&&a(i.id)}:void 0,children:[e.jsxs("div",{className:"flex flex-col flex-grow gap-1",children:[e.jsx("p",{className:"font-semibold text-gray-300 text-sm truncate w-full bg-gray-700 px-2 py-3 rounded-md max-w-169",children:i.reason}),e.jsxs("div",{className:"flex items-center gap-4 w-full bg-gray-700 p-2 rounded-md max-w-169",children:[e.jsx("p",{className:"uppercase",children:r("target")}),e.jsx("span",{className:"text-sm text-gray-300",children:i.target_type})]}),e.jsxs("div",{className:"flex items-center gap-4 w-full bg-gray-700 p-2 rounded-md max-w-169",children:[e.jsx("p",{className:"uppercase",children:r("status")}),e.jsx("span",{className:"text-sm text-gray-300",children:i.status})]})]}),n&&e.jsx("button",{onClick:x=>{x.stopPropagation(),c(i),p(!0)},"aria-label":r("deleteAria"),title:r("deleteTitle"),className:"p-1 mb-auto text-rose-600 hover:text-rose-700 cursor-pointer",children:e.jsx(T,{className:"w-5 h-5"})})]},i.id))}),e.jsx(B,{isOpen:d,title:r("danger.title"),message:r("danger.confirm"),onConfirm:u,onCancel:()=>{p(!1),c(null)},confirmLabel:r("danger.yesDelete"),cancelLabel:r("danger.cancel"),color:"error"})]})},pe=({report:s,onClose:n,onUpdate:a})=>{const{t}=b("admin",{keyPrefix:"reports.reportDetail"}),{register:l,control:o,handleSubmit:r,watch:d,formState:{errors:p}}=E({defaultValues:{status:s.status,notes:s.notes??""}}),[m,c]=h.useState(!1),u=async i=>{c(!0);try{await a({id:s.id,...i}),n()}catch(x){console.error("Failed to update report:",x)}finally{c(!1)}};return e.jsxs("form",{onSubmit:r(u),className:"bg-zinc-900 p-6 rounded-lg max-w-lg w-full space-y-4 overflow-y-auto max-h-130",children:[e.jsx("h3",{className:"text-xl text-center font-semibold text-white",children:t("title")}),e.jsxs("div",{className:"text-gray-300 space-y-4 text-sm mb-10 border border-gray-600 bg-gray-800 p-4 rounded-lg",children:[e.jsxs("p",{children:[e.jsxs("strong",{className:"mr-2",children:[t("fields.reporterId"),":"]}),e.jsx(S,{to:`/profile/${s.reporter_id}`,className:"hover:text-blue-400 hover:underline transition-all",children:s.reporter_id})]}),e.jsxs("p",{children:[e.jsxs("strong",{className:"mr-2",children:[t("fields.target"),":"]}),s.target_type," â€” ",s.target_id]}),e.jsxs("p",{children:[e.jsxs("strong",{className:"mr-2",children:[t("fields.targetOwner"),":"]}),e.jsx(S,{to:`/profile/${s.target_owner_id}`,className:"hover:text-blue-400 hover:underline transition-all",children:s.target_owner_id})]}),e.jsxs("p",{children:[e.jsxs("strong",{className:"mr-2",children:[t("fields.reason"),":"]})," ",s.reason]}),e.jsxs("p",{children:[e.jsxs("strong",{className:"mr-2",children:[t("fields.createdAt"),":"]})," ",new Date(s.created_at).toLocaleString()]})]}),e.jsx(M,{id:"status",label:t("fields.status"),control:o,options:[{value:"pending",label:t("statusOptions.pending")},{value:"reviewing",label:t("statusOptions.reviewing")},{value:"resolved",label:t("statusOptions.resolved")}],search:!1}),e.jsx($,{id:"notes",label:t("fields.notes"),placeholder:t("placeholders.notes"),maxLength:1e3,watchValue:d("notes")??void 0,register:l,error:p.notes}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx(g,{type:"button",onClick:n,className:"!bg-gray-600 hover:!bg-gray-700",disabled:m,children:t("buttons.cancel")}),e.jsx(g,{type:"submit",disabled:m,children:t(m?"buttons.saving":"buttons.save")})]})]})},he=({isAdmin:s,isModerator:n})=>{const{t:a}=b("admin",{keyPrefix:"reports.section"}),{allReports:t,updateUserReport:l,deleteUserReport:o}=J(),[r,d]=h.useState(null),{data:p=[],isLoading:m,error:c,refetch:u}=t(),i=f=>d(f),x=()=>d(null),j=s||n,v=async f=>{if(f.id)try{await l(f),await u(),x()}catch(y){console.error("Failed to update report:",y)}},w=async f=>{try{const y=p.find(_=>_.id===f);if(!y)return;await o({id:f,reporter_id:y.reporter_id}),await u(),r===f&&x()}catch(y){console.error("Failed to delete report:",y)}};return e.jsxs("section",{className:"p-4 space-y-4",children:[e.jsxs("header",{className:"flex p-4 rounded-l-md justify-between items-center space-x-2 bg-gradient-to-r from-gray-800",children:[e.jsx("h2",{className:"text-xl font-semibold",children:a("title")}),e.jsx(g,{onClick:()=>u(),children:a("refresh")})]}),e.jsx(ue,{reports:p,isLoading:m,error:c,hasAccess:j,onSelect:i,onDelete:w}),r&&j&&e.jsx(R,{onClose:x,children:e.jsx(pe,{report:p.find(f=>f.id===r),onClose:x,onUpdate:v})})]})},fe=({feedbacks:s,isLoading:n,error:a,hasAccess:t,onReply:l,onDelete:o})=>{const{t:r}=b("admin",{keyPrefix:"feedback.list"}),[d,p]=h.useState(!1),[m,c]=h.useState(null);if(n)return e.jsx(F,{count:3});if(a&&a instanceof Error)return e.jsx(C,{error:a.message});if(s.length===0)return e.jsx("p",{className:"text-sm text-muted",children:r("empty")});const u=()=>{m&&(o(m.id,m.profile_id),p(!1),c(null))};return e.jsxs(e.Fragment,{children:[e.jsx("ul",{className:"space-y-4",children:s.map(i=>e.jsxs("li",{className:`flex justify-between bg-zinc-700/10 items-center p-3 rounded transition-all 
                    ${t?"cursor-pointer hover:bg-zinc-700/20":"cursor-default"}`,onClick:t?()=>l(i.id):void 0,role:t?"button":void 0,tabIndex:t?0:-1,onKeyDown:t?x=>{(x.key==="Enter"||x.key===" ")&&l(i.id)}:void 0,children:[e.jsxs("div",{className:"flex-1 flex-grow gap-1",children:[e.jsx("p",{className:"font-semibold uppercase text-white mb-1",children:i.type}),e.jsx("p",{className:"font-semibold text-gray-300 text-sm truncate w-full bg-gray-700 px-2 py-3 rounded-md max-w-169",children:i.message}),e.jsxs("div",{className:"flex items-center gap-4 w-full bg-gray-700 p-2 rounded-md max-w-169 mt-1",children:[e.jsx("p",{className:"uppercase",children:r("fields.status")}),e.jsx("span",{className:"text-sm text-gray-300",children:i.status})]})]}),t&&e.jsx("button",{onClick:x=>{x.stopPropagation(),c(i),p(!0)},"aria-label":r("deleteAria"),title:r("deleteTitle"),className:"p-1 mb-auto text-rose-600 hover:text-rose-700 cursor-pointer",children:e.jsx(T,{className:"w-5 h-5"})})]},i.id))}),e.jsx(B,{isOpen:d,title:r("danger.title"),message:r("danger.confirm"),onConfirm:u,onCancel:()=>{p(!1),c(null)},confirmLabel:r("danger.yesDelete"),cancelLabel:r("danger.cancel"),color:"error"})]})},ge=({feedback:s,onClose:n,onUpdate:a})=>{const{t}=b("admin",{keyPrefix:"feedback.form"}),[l,o]=h.useState(null),{register:r,handleSubmit:d,reset:p,watch:m,formState:{errors:c,isSubmitting:u}}=E({defaultValues:{response:s.response??""}});h.useEffect(()=>{p({response:s.response??""})},[s,p]);const i=async x=>{o(null);try{await a({id:s.id,response:x.response,status:"responded"}),n()}catch{o("Failed to save response. Please try again.")}};return e.jsxs("div",{className:"space-y-6 bg-zinc-900 p-6 rounded-lg shadow full-width mx-auto",children:[e.jsx("h2",{className:"text-lg font-semibold text-white text-center mb-4",children:t("title")}),e.jsx("p",{className:"text-lg bg-black/20 p-2 rounded-lg mb-2 font-semibold text-center uppercase",children:s.type}),e.jsx("p",{className:"text-sm break-all text-center text-gray-300",children:s.message}),e.jsxs("div",{className:"flex justify-between gap-2 text-center p-2",children:[s.feedback_topic&&e.jsxs("div",{className:"w-1/2",children:[e.jsx("h2",{className:"text-sm bg-black/20 p-2 rounded-lg mb-2 font-medium text-muted-foreground",children:t("fields.topic")}),e.jsx("p",{className:"text-sm break-all text-gray-300",children:s.feedback_topic})]}),e.jsxs("div",{className:"w-1/2",children:[e.jsx("h2",{className:"text-sm bg-black/20 p-2 rounded-lg mb-2 font-medium text-muted-foreground",children:t("fields.status")}),e.jsx("p",{className:"text-sm break-all text-gray-300",children:s.status})]})]}),e.jsx($,{id:"response",placeholder:t("placeholders.response"),register:r,maxLength:1e3,watchValue:m("response"),validation:{required:t("validations.response")},error:c.response}),e.jsxs("div",{className:"mt-6 flex justify-center gap-4",children:[e.jsx(g,{type:"button",onClick:n,className:"!bg-gray-600 hover:!bg-gray-700",disabled:u,children:t("buttons.cancel")}),e.jsx(g,{type:"button",onClick:d(i),disabled:u,children:t(u?"buttons.saving":"buttons.save")})]})]})},be=({isAdmin:s,isModerator:n})=>{const{t:a}=b("admin",{keyPrefix:"feedback.section"}),{allFeedbacks:t,updateUserFeedback:l,deleteUserFeedback:o}=W(),{data:r=[],isLoading:d,error:p,refetch:m}=t(),[c,u]=h.useState(null),i=f=>u(f),x=()=>u(null),j=s||n,v=async f=>{if(f.id)try{await l(f),await m(),x()}catch(y){console.error("Failed to update feedback:",y)}},w=async(f,y)=>{try{await o({id:f,profile_id:y}),await m(),c===f&&x()}catch(_){console.error("Failed to delete feedback:",_)}};return e.jsxs("section",{className:"p-4 space-y-4",children:[e.jsxs("header",{className:"flex p-4 rounded-l-md justify-between items-center space-x-2 bg-gradient-to-r from-gray-800",children:[e.jsx("h2",{className:"text-xl font-semibold",children:a("title")}),e.jsx(g,{onClick:()=>m(),children:a("buttons.refresh")})]}),e.jsx(fe,{feedbacks:r,onReply:i,onDelete:w,isLoading:d,error:p,hasAccess:j}),c&&j&&e.jsx(R,{onClose:x,children:e.jsx(ge,{feedback:r.find(f=>f.id===c),onClose:x,onUpdate:v})})]})},je=({bannedUsers:s,isLoading:n,hasAccess:a,error:t,onSelect:l})=>{const{t:o}=b("admin",{keyPrefix:"bans.list"});return n?e.jsx(F,{count:3}):t&&t instanceof Error?e.jsx(C,{error:t.message}):s.length===0?e.jsx("p",{className:"text-sm text-muted",children:o("empty")}):e.jsx("div",{className:"space-y-4",children:s.map(r=>e.jsxs("div",{className:`flex justify-between bg-zinc-700/10 items-center p-3 rounded transition-all 
              ${a?"cursor-pointer hover:bg-zinc-700/20":"cursor-default"}`,onClick:a?()=>l(r.profile_id):void 0,role:a?"button":void 0,tabIndex:a?0:-1,onKeyDown:a?d=>{(d.key==="Enter"||d.key===" ")&&l(r.profile_id)}:void 0,children:[e.jsxs("div",{className:"flex flex-col gap-1 items-start flex-grow min-w-0",children:[e.jsxs("div",{className:"space-x-2 w-full bg-gray-700 p-2 rounded-md",children:[e.jsx("span",{className:"uppercase",children:o("profileId")}),e.jsx("span",{className:"text-sm text-gray-300",children:r.profile_id})]}),e.jsxs("div",{className:"space-x-2 w-full bg-gray-700 p-2 rounded-md",children:[e.jsx("span",{className:"uppercase",children:o("until")}),e.jsx("span",{className:"text-sm text-gray-300",children:r.banned_until?D(new Date(r.banned_until),"PPpp"):o("permanent")})]})]}),e.jsx(re,{className:"w-4 h-4 text-muted-foreground"})]},r.profile_id))})},ye=({bannedUser:s,onEdit:n,onDelete:a,hasAccess:t})=>{const{t:l}=b("admin",{keyPrefix:"bans.details"}),[o,r]=h.useState(!1);if(!s)return e.jsx("div",{className:"text-center text-muted text-sm",children:l("selectBan","Select a ban from the list to see details")});const d=()=>{a(s.profile_id),r(!1)};return e.jsxs("div",{className:"space-y-8 bg-zinc-800 p-6 rounded-lg shadow max-w-lg mx-auto overflow-y-auto max-h-200",children:[e.jsxs("div",{className:"text-center p-2",children:[e.jsx("h2",{className:"text-lg bg-black/20 p-2 rounded-lg mb-2 font-semibold",children:l("profileId")}),e.jsx("p",{className:"break-all text-sm text-foreground text-gray-300 hover:text-sky-500 hover:underline transition-all",children:e.jsx(S,{to:`/profile/${s.profile_id}`,children:s.profile_id})})]}),e.jsxs("div",{className:"text-center p-2",children:[e.jsx("h2",{className:"text-lg bg-black/20 p-2 rounded-lg mb-2 font-semibold",children:l("reason")}),e.jsx("p",{className:"text-sm text-gray-300 text-foreground whitespace-pre-wrap",children:s.reason||l("noReason")})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex justify-between gap-2 text-center p-2",children:[e.jsxs("div",{className:"w-1/2",children:[e.jsx("h2",{className:"text-sm bg-black/20 p-2 rounded-lg mb-2 font-medium text-muted-foreground",children:l("bannedAt")}),e.jsx("p",{className:"text-sm text-gray-300",children:D(new Date(s.created_at),"PPpp")})]}),e.jsxs("div",{className:"w-1/2",children:[e.jsx("h2",{className:"text-sm bg-black/20 p-2 rounded-lg mb-2 font-medium text-muted-foreground",children:l("bannedUntil")}),e.jsx("p",{className:"text-sm text-gray-300",children:s.banned_until?D(new Date(s.banned_until),"PPpp"):l("permanent")})]})]}),e.jsxs("div",{className:"flex justify-between gap-2 text-center p-2",children:[e.jsxs("div",{className:"w-1/2",children:[e.jsx("h2",{className:"text-sm bg-black/20 p-2 rounded-lg mb-2 font-medium text-muted-foreground",children:l("bannedBy")}),e.jsx("p",{className:"text-sm break-all text-gray-300 hover:text-sky-500 hover:underline transition-all",children:e.jsx(S,{to:`/profile/${s.banned_by}`,children:s.banned_by})})]}),e.jsxs("div",{className:"w-1/2",children:[e.jsx("h2",{className:"text-sm bg-black/20 p-2 rounded-lg mb-2 font-medium text-muted-foreground",children:l("handledBy")}),e.jsx("p",{className:"text-sm break-all text-gray-300",children:s.handled_by||l("notHandled")})]})]})]}),t&&e.jsxs("div",{className:"flex gap-4 justify-center",children:[e.jsx(g,{className:"!bg-yellow-600 hover:!bg-yellow-700",onClick:()=>n(s.profile_id),children:l("buttons.edit")}),e.jsx(g,{className:"!bg-rose-600 hover:!bg-rose-700",onClick:p=>{r(!0)},children:l("buttons.delete")})]}),e.jsx(B,{isOpen:o,title:l("danger.title"),message:l("danger.confirm"),onConfirm:d,onCancel:()=>{r(!1)},confirmLabel:l("danger.yesDelete"),cancelLabel:l("danger.cancel"),color:"error"})]})},Ne=[{value:"full",label:"Full"},{value:"posting",label:"Posting"},{value:"messaging",label:"Messaging"}],ve=({profileId:s,onClose:n,onSubmit:a,initialData:t,currentAdminId:l})=>{const{register:o,handleSubmit:r,setValue:d,control:p,formState:{errors:m,isSubmitting:c}}=E({defaultValues:{profile_id:"",reason:"",banned_until:"",type:"full"}});h.useEffect(()=>{t?(d("profile_id",t.profile_id),d("reason",t.reason),d("banned_until",t.banned_until?t.banned_until.substring(0,16):""),d("type",t.type)):s&&d("profile_id",s)},[t,s,d]);const u=async i=>{await a({profile_id:i.profile_id,reason:i.reason,banned_until:i.banned_until?new Date(i.banned_until).toISOString():null,type:i.type,banned_by:l}),n()};return e.jsxs("form",{onSubmit:r(u),className:"space-y-6 bg-zinc-800 p-6 rounded-lg shadow max-w-lg mx-auto overflow-y-auto max-h-130",children:[e.jsx("h2",{className:"text-lg font-semibold text-white text-center mb-2",children:s?"Edit Ban":"Add Ban"}),e.jsx(z,{id:"profile_id",label:"Profile ID",placeholder:"UUID of the user",register:o,validation:{required:"Profile ID is required"},error:m.profile_id,disabled:!!s}),e.jsx($,{id:"reason",label:"Reason",placeholder:"Reason for the ban",register:o,validation:{required:"Reason is required"},error:m.reason}),e.jsx(z,{id:"banned_until",label:"Banned Until (optional)",type:"datetime-local",register:o,error:m.banned_until}),e.jsx(M,{id:"type",label:"Ban Type",options:Ne,control:p,error:m.type,search:!1}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx(g,{type:"button",onClick:n,className:"!bg-gray-600 hover:!bg-gray-700",disabled:c,children:"Cancel"}),e.jsx(g,{type:"submit",disabled:c,children:c?"Saving...":"Save"})]})]})},we=({isAdmin:s,isModerator:n,currentAdminId:a})=>{const{t}=b("admin",{keyPrefix:"bans.section"}),{allBannedUsers:l,upsertBannedUser:o,deleteBannedUser:r}=X(),{data:d=[],isLoading:p,error:m,refetch:c}=l(),u=s||n,[i,x]=h.useState(null),[j,v]=h.useState(!1),[w,f]=h.useState(!1),[y,_]=h.useState(null),A=N=>{_(N),v(!0)},P=()=>{_(null),v(!1)},V=()=>{f(!1),x(null)},Z=N=>{x(N),f(!0)},H=async N=>{try{await o(N),await c(),P()}catch(O){console.error("Failed to save ban:",O)}},K=async N=>{try{await r({profile_id:N}),await c(),y===N&&P(),i===N&&x(null),V()}catch(O){console.error("Failed to delete ban:",O)}},Q=d.find(N=>N.profile_id===i)??null;return e.jsxs("section",{className:"p-4 space-y-4",children:[e.jsxs("header",{className:"flex p-4 rounded-l-md justify-between items-center space-x-2 bg-gradient-to-r from-gray-800",children:[e.jsx("h2",{className:"text-xl font-semibold",children:t("title")}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(g,{className:"!bg-emerald-600 hover:!bg-emerald-700",onClick:()=>A(null),children:t("buttons.add")}),e.jsx(g,{onClick:()=>c(),children:t("buttons.refresh")})]})]}),e.jsx(je,{bannedUsers:d,onSelect:Z,hasAccess:u,isLoading:p,error:m}),w&&e.jsx(R,{onClose:V,children:e.jsx(ye,{bannedUser:Q,onEdit:A,onDelete:K,hasAccess:u})}),u&&j&&e.jsx(R,{onClose:P,children:e.jsx(ve,{profileId:y,initialData:y?d.find(N=>N.profile_id===y)??null:null,onClose:P,onSubmit:H,currentAdminId:a})})]})},I=s=>{if(typeof s=="string"||typeof s=="number"){const n=new Date(s);if(!isNaN(n.getTime()))return D(n,"PPpp")}return"-"},ke=({log:s,hasAccess:n})=>{const{t:a}=b("admin",{keyPrefix:"logs.details"});if(!s)return e.jsx("div",{className:"text-center text-muted text-sm",children:a("selectLog","Select a log from the list to see details")});const t=s.details;return e.jsxs("div",{className:"space-y-6 text-center bg-zinc-800 p-6 rounded-lg shadow max-w-lg mx-auto overflow-y-auto max-h-[400px] text-white",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg bg-black/20 p-2 rounded-lg mb-2 font-semibold",children:a("logId")}),e.jsx("p",{className:"text-sm break-all text-gray-300",children:s.id})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg bg-black/20 p-2 rounded-lg mb-2 font-semibold",children:a("profileId")}),e.jsx("p",{className:"text-sm break-all text-gray-300 hover:text-sky-500 hover:underline transition-all",children:e.jsx(S,{to:`/profile/${s.profile_id}`,children:s.profile_id})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm bg-black/20 p-2 rounded-lg mb-2 font-medium text-muted-foreground",children:a("actionType")}),e.jsx("p",{className:"text-sm break-all text-gray-300",children:s.action_type})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm bg-black/20 p-2 rounded-lg mb-2 font-medium text-muted-foreground",children:a("targetTable")}),e.jsx("p",{className:"text-sm break-all text-gray-300",children:s.target_table??"-"})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm bg-black/20 p-2 rounded-lg mb-2 font-medium text-muted-foreground",children:a("targetId")}),e.jsx("p",{className:"text-sm break-all text-gray-300",children:s.target_id??"-"})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm bg-black/20 p-2 rounded-lg mb-2 font-medium text-muted-foreground",children:a("createdAt")}),e.jsx("p",{className:"text-sm break-all text-gray-300",children:I(s.created_at)})]})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg bg-black/20 p-2 rounded-lg mb-2 font-semibold",children:a("details")}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:["type"in t&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm bg-black/20 p-2 rounded-lg mb-2 font-medium text-muted-foreground",children:a("details.type")}),e.jsx("p",{className:"text-sm break-all text-gray-300",children:t.type})]}),"reason"in t&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm bg-black/20 p-2 rounded-lg mb-2 font-medium text-muted-foreground",children:a("details.reason")}),e.jsx("p",{className:"text-sm break-all text-gray-300",children:t.reason})]}),"banned_by"in t&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm bg-black/20 p-2 rounded-lg mb-2 font-medium text-muted-foreground",children:a("details.bannedBy")}),e.jsx(S,{to:`/profile/${t.banned_by}`,className:"text-sm break-all text-gray-300 hover:text-sky-500 hover:underline transition-all",children:t.banned_by})]}),"handled_by"in t&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm bg-black/20 p-2 rounded-lg mb-2 font-medium text-muted-foreground",children:a("details.handledBy")}),e.jsx("p",{className:"text-sm break-all text-gray-300",children:t.handled_by??a("details.notHandled")})]}),"created_at"in t&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm bg-black/20 p-2 rounded-lg mb-2 font-medium text-muted-foreground",children:a("details.createdAt")}),e.jsx("p",{className:"text-sm break-all text-gray-300",children:I(t.created_at)})]}),"banned_until"in t&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm bg-black/20 p-2 rounded-lg mb-2 font-medium text-muted-foreground",children:a("details.bannedUntil")}),e.jsx("p",{className:"text-sm break-all text-gray-300",children:t.banned_until?I(t.banned_until):a("details.permanent")})]})]})]})]})},_e=({logs:s,hasAccess:n,isLoading:a,error:t})=>{const{t:l}=b("admin",{keyPrefix:"logs.list"}),[o,r]=h.useState(null),[d,p]=h.useState(!1),m=u=>{r(u)};if(s.length===0)return e.jsx("p",{className:"text-sm text-muted",children:l("empty")});if(a)return e.jsx(F,{count:3});if(t&&t instanceof Error)return e.jsx(C,{error:t.message});const c=()=>{r(null),p(!1)};return e.jsxs("div",{className:"overflow-x-auto rounded-md border border-gray-700 bg-zinc-900 p-4 max-h-[400px] overflow-y-auto",children:[e.jsxs("table",{className:"w-full text-center text-sm text-gray-300 border-separate border-spacing-0",children:[e.jsx("thead",{className:"text-gray-400 bg-gray-700",children:e.jsxs("tr",{className:"text-white uppercase",children:[e.jsx("th",{className:"px-3 py-2 border border-gray-600",children:l("fields.date")}),e.jsx("th",{className:"px-3 py-2 border border-gray-600",children:l("fields.adminId")}),e.jsx("th",{className:"px-3 py-2 border border-gray-600",children:l("fields.action")}),e.jsx("th",{className:"px-3 py-2 border border-gray-600",children:l("fields.target")}),e.jsx("th",{className:"px-3 py-2 border border-gray-600",children:l("fields.targetId")})]})}),e.jsx("tbody",{children:s.map(u=>e.jsxs("tr",{className:"hover:bg-gray-800 cursor-pointer transition-all",onClick:()=>m(u),children:[e.jsx("td",{className:"px-3 py-2 border border-gray-600 whitespace-nowrap",children:new Date(u.created_at).toLocaleString()}),e.jsx("td",{className:"px-3 py-2 border border-gray-600 break-words max-w-xs",children:u.profile_id}),e.jsx("td",{className:"px-3 py-2 border border-gray-600",children:u.action_type}),e.jsx("td",{className:"px-3 py-2 border border-gray-600",children:u.target_table??"-"}),e.jsx("td",{className:"px-3 py-2 border border-gray-600 break-words max-w-xs",children:u.target_id??"-"})]},u.id))})]}),o&&e.jsx(R,{onClose:c,children:e.jsx(ke,{log:o,hasAccess:n})})]})},Se=({isAdmin:s,isModerator:n})=>{const{t:a}=b("admin",{keyPrefix:"logs.section"}),{allAdminLogs:t}=Y(),{data:l=[],isLoading:o,error:r,refetch:d}=t(),p=s||n,m=()=>{d()};return e.jsxs("section",{className:"p-4 space-y-4",children:[e.jsxs("header",{className:"flex p-4 rounded-l-md justify-between items-center space-x-2 bg-gradient-to-r from-gray-800",children:[e.jsx("h2",{className:"text-xl font-semibold",children:a("title")}),e.jsx(g,{onClick:m,disabled:o,children:a(o?"buttons.loading":"buttons.refresh")})]}),e.jsx(_e,{logs:l,hasAccess:p,error:r,isLoading:o})]})};function $e(){const{user:s}=ee(),{adminRolesQuery:n}=U(),{data:a}=n((s==null?void 0:s.id)??""),t=(a==null?void 0:a.role)==="admin",l=(a==null?void 0:a.role)==="moderator";return e.jsxs("div",{className:"flex flex-col lg:flex-row h-screen",children:[e.jsx(oe,{}),e.jsx("div",{className:"flex-1 overflow-auto p-4 space-y-8",children:e.jsxs(se,{children:[e.jsx(k,{index:!0,element:e.jsx(q,{isAdmin:t,isModerator:l})}),e.jsx(k,{path:"roles",element:e.jsx(q,{isAdmin:t,isModerator:l})}),e.jsx(k,{path:"reports",element:e.jsx(he,{isAdmin:t,isModerator:l})}),e.jsx(k,{path:"feedback",element:e.jsx(be,{isAdmin:t,isModerator:l})}),e.jsx(k,{path:"bans",element:e.jsx(we,{currentAdminId:(s==null?void 0:s.id)??"",isAdmin:t,isModerator:l})}),e.jsx(k,{path:"logs",element:e.jsx(Se,{isAdmin:t,isModerator:l})}),e.jsx(k,{path:"*",element:e.jsx(te,{to:"/admin",replace:!0})})]})})]})}export{$e as default};
